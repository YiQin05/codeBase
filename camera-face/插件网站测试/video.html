
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>jQuery webcam plugin &bull; Code is poetry</title><!-- 1544574449 -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <style>
    *,::before,::after{box-sizing:border-box}
    body{font-family:'Libre Baskerville',serif;margin:0;padding:0}
    a{color:#c00;font-weight:700;text-decoration:none}
    ol a,ul a{font-weight:400}
    img{border:0 none}
    a:hover{text-decoration:underline}
    .icons{text-align:right;padding-right:10px}
    .icons svg{outline:5px solid #bbb;background:#bbb;margin:6px;border:0}
    nav{border-bottom:1px solid #bbb;font-size:13px;margin-bottom:20px;padding-bottom:5px}
    nav ul{list-style:none;margin:0;padding:0}
    nav li{margin:0;padding:0;display:inline;margin-right:20px;padding-bottom:5px}
    nav li a{color:#bbb;text-decoration:none;text-transform:uppercase}
    .conti{text-align:center;border-bottom:1px solid #bbb}
    .conti a{color:#666;text-transform:uppercase;font-size:12px;display:block;padding:5px}
    nav li.active{border-bottom:1px solid #333}
    nav li.active a{color:#333}
    main{display:block;margin-left:0;flex:1;padding:20px}
    main h1{font-weight:400;font-size:37px;margin:0}
    main h1 a,main h2 a,main h3 a{color:#333}
    article{margin-top:60px;max-width:820px}
    article time{color:#bbb;display:block;margin-top:3px;margin-bottom:8px;font-size:15px;padding-bottom:10px;line-height:1.2;font-family:Arial}
    article time a{color:#666}article p,article li{color:#333;line-height:1.75;font-size:19px}
    aside{padding-top:20px;text-align:center;background:#000;color:#fff}
    #sidebar{padding-bottom:15px}
    #sidebar p{font-weight:700;margin:0;font-size:13px;margin-bottom:12px;text-shadow:0 1px 3px rgba(0,0,0,0.3)}
    #sidebar a{font-size:37px;color:#fff;text-decoration:none}
    textarea{resize:vertical;width:100%}
    input{width:60%;padding:4px}#comments img{border:0 none;padding:0}
    #comments h3,form h3{font-size:23px;margin-top:40px}
    #comments .comments{margin-top:30px}
    #comments time{display:inline;padding:0;margin:0}
    main h2{font-size:28px;margin-top:20px;margin-bottom:10px}
    main h3{font-size:26px;margin-top:20px;margin-bottom:10px}
    main h4{font-size:24px;margin-top:20px;margin-bottom:10px}
    main img{padding:10px;border:1px solid #ccc}
    main ul{list-style-type:square}
    main pre{color:#fff;background:#211;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px;padding:10px 20px;font-size:13px}main .button{text-align:center;margin:30px}main .button a{color:#fff;padding:10px 30px;text-decoration:none;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px;-webkit-box-shadow:0 1px 3px #666;-moz-box-shadow:0 1px 3px #666;text-shadow:0 1px 3px #666;border:solid #c00 2px;background:#c00;background:-webkit-gradient(linear,0 0,0 100%,from(#f00),to(#811));background:-moz-linear-gradient(top,#f00,#811);font-size:13px}@media (min-width: 50em){aside{top:0;left:0;position:fixed;width:17em;height:100%}main{margin-left:17em}#sidebar{position:absolute;bottom:30px}}@media (min-width: 68em){main h1{font-size:47px}main{padding:20px 100px}}.unicode{font-family:'Code2000','Sun-ExtA','Arial Unicode MS','NSimSun',sans-serif}pre .str,code .str{color:#65B042}pre .kwd,code .kwd{color:#E28964}pre .com,code .com{color:#AEAEAE;font-style:italic}pre .typ,code .typ{color:#89bdff}pre .lit,code .lit{color:#3387CC}pre .pun,code .pun{color:#fff}pre .pln,code .pln{color:#fff}pre .tag,code .tag{color:#89bdff}pre .atn,code .atn{color:#bdb76b}pre .atv,code .atv{color:#65B042}pre .dec,code .dec{color:#3387CC}pre.prettyprint,code.prettyprint{background-color:#000;-moz-border-radius:8px;-webkit-border-radius:8px;-o-border-radius:8px;-ms-border-radius:8px;-khtml-border-radius:8px;border-radius:8px}pre.prettyprint{width:100%;padding:1em;white-space:pre-wrap}
    </style>
    <link rel="pingback" href="/pingback/">
    <meta name="robots" content="index,follow">
    <meta name="ICBM" content="50.93793,14.84811">
    <meta property="fb:admins" content="1522308563">
    <meta name="author" content="Robert Eisele">
    <meta name="msapplication-config" content="none"
    ><meta name="description" content=""><meta name="keywords" content=""><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternate" type="application/rss+xml" title="Code is poetry" href="http://feeds.feedburner.com/exarg">
    <link rel="canonical" href="https://www.xarg.org/project/jquery-webcam-plugin/"><link href="https://fonts.googleapis.com/css?family=Libre+Baskerville" rel="stylesheet">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1101037-2"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag("js",new Date());gtag("config","UA-1101037-2");</script>
    </head>
    <body>
      <aside>
        <div class="icons"><a href="https://github.com/infusion" rel="nofollow me"><svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="25" height="25"><path d="M12.5 0.6c-6.9 0-12.5 5.6-12.5 12.5 0 5.5 3.6 10.2 8.5 11.9 0.6 0.1 0.9-0.3 0.9-0.6 0-0.3 0-1.1 0-2.2-3.5 0.8-4.2-1.7-4.2-1.6-0.6-1.4-1.4-1.8-1.4-1.9-1.1-0.8 0.1-0.8 0.1-0.7 1.3 0.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.4 3.6 1 0.1-0.8 0.4-1.4 0.8-1.7-2.8-0.3-5.7-1.4-5.7-6.1 0-1.4 0.5-2.5 1.3-3.4-0.1-0.3-0.6-1.6 0.1-3.3 0 0 1-0.3 3.5 1.3 1-0.3 2.1-0.4 3.1-0.4 1.1 0 2.1 0.1 3.1 0.4 2.4-1.6 3.4-1.3 3.5-1.3 0.7 1.7 0.3 3 0.1 3.3 0.8 0.9 1.3 2 1.3 3.4 0 4.8-2.9 5.9-5.7 6.1 0.4 0.4 0.8 1.1 0.8 2.3 0 1.7 0 3 0 3.5 0 0.3 0.2 0.7 0.9 0.6 5-1.7 8.5-6.3 8.5-11.9 0-6.9-5.6-12.5-12.5-12.5" fill="#000" stroke="none" /></svg></a><a href="https://www.facebook.com/xarg.org" rel="nofollow me"><svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" width="25" height="25"><path d="M17.2 25l0-9.7 3.2 0 0.5-3.8-3.7 0 0-2.4c0-1.1 0.3-1.8 1.8-1.8l2 0 0-3.4c-0.3 0-1.5-0.1-2.9-0.1-2.9 0-4.9 1.8-4.8 5l0 2.7-3.3 0 0 3.8 3.3 0 0 9.7 3.9 0z" fill="#000" /> </svg></a><a href="https://twitter.com/roberteisele" rel="nofollow me"><svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" height="25" width="25"><path d="M7.9 22.7c9.4 0 14.6-7.8 14.6-14.6 0-0.2 0-0.4-0.1-0.7 1-0.7 1.9-1.6 2.6-2.7-0.9 0.4-1.9 0.7-2.9 0.9 1.1-0.6 1.9-1.6 2.2-2.9-1 0.6-2.1 1-3.2 1.3-0.9-1-2.3-1.6-3.8-1.7-2.8 0-5.1 2.3-5.1 5.2 0 0.4 0 0.8 0.1 1.1-4.3-0.2-8-2.3-10.6-5.3-0.4 0.8-0.7 1.6-0.7 2.6 0 1.8 0.9 3.4 2.3 4.2-0.8 0-1.6-0.3-2.3-0.6 0 0 0 0 0 0.1 0 2.5 1.8 4.6 4.1 5-0.4 0.1-0.9 0.2-1.3 0.2-0.3 0-0.7 0-1-0.1 0.7 2 2.5 3.5 4.8 3.5-1.8 1.4-4 2.2-6.4 2.2-0.4 0-0.8 0-1.2 0 2.3 1.5 5 2.3 7.9 2.3" fill="#000" stroke="none" /></svg> </a></div><div id="sidebar"><p><a href="https://www.xarg.org/" rel="top">Robert Eisele</a></p><p>Computer Science &amp; Machine Learning</p></div></aside><main><nav><ul><li><a href="/">Home</a></li><li><a href="/about/" rel="author">About</a></li><li><a href="/archive/" rel="archive">Archive</a></li><li class="active"><a href="/projects/" rel="contents">Projects</a></li></ul></nav><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><article><h1><a href="/project/jquery-webcam-plugin/" rel="bookmark">jQuery webcam plugin</a></h1><style type="text/css">

  #webcam, #canvas {
   width: 320px;
   border:20px solid #333;
   background:#eee;
   -webkit-border-radius: 20px;
   -moz-border-radius: 20px;
   border-radius: 20px;
  }
  
  #webcam {
   position:relative;
   margin-top:50px;
   margin-bottom:50px;
  }
  
  #webcam > span {
   z-index:2;
   position:absolute;
   color:#eee;
   font-size:10px;
   bottom: -16px;
   left:152px;
  }
  
  #webcam > img {
   z-index:1;
   position:absolute;
   border:0px none;
   padding:0px;
   bottom:-40px;
   left:89px;
  }
  
  #webcam > div {
   border:5px solid #333;
   position:absolute;
   right:-90px;
   padding:5px;
   -webkit-border-radius: 8px;
   -moz-border-radius: 8px;
   border-radius: 8px;
   cursor:pointer;
  }
  
  #webcam a {
   background:#fff;
   font-weight:bold;
  }
  
  #webcam a > img {
   border:0px none;
  }
  
  #canvas {
   border:20px solid #ccc;
   background:#eee;
  }
  
  #flash {
   position:absolute;
   top:0px;
   left:0px;
   z-index:5000;
   width:100%;
   height:500px;
   background-color:#c00;
   display:none;
  }
  
  object {
   display:block; /* HTML5 fix */
   position:relative;
   z-index:1000;
  }
  
  </style><script type="text/javascript" src="/download/jquery.webcam.min.js"></script><p>The jQuery webcam plugin is a transparent layer to communicate with a camera directly in JavaScript.</p><p style="background:yellow">As there is native support for webcams in modern browsers, it would be great if you could add this feature to the project and use the flash-version as a fallback for older ones. I don't have time for this project at the moment, so a pull request would be great!</p><h2>Overview</h2><p>This plugin provides three different modes to access a webcam through a small <abbr title="Application Programming Interface">API</abbr> directly with JavaScript - or more precisely jQuery. Thus, it is possible to bring the image on a Canvas (callback mode), to store the image on the server (save mode) and to stream the live image of the Flash element on a Canvas (stream mode). If you just want to download the plugin, click here:</p><div class="button"><a href="https://github.com/infusion/jQuery-webcam" class="view">Download the jQuery webcam plugin</a></div><h2>jQuery webcam example</h2><p id="status" style="height:22px; color:#c00;font-weight:bold;"></p><div id="webcam"><img src="/image/antenna.png" alt="" /><span>jQuery</span><div><a onClick="toggleFilter(this);"><img src="/image/icon_filter.png" alt="" /></a></div></div><p style="width:360px;text-align:center;font-size:12px"><a href="javascript:webcam.capture(3);changeFilter();void(0);">Take a picture after 3 seconds</a> | <a href="javascript:webcam.capture();changeFilter();void(0);">Take a picture instantly</a></p><p><canvas id="canvas" height="240" width="320"></canvas></p><h3>Available Cameras</h3><ul id="cams"></ul><script type="text/javascript">
  
  var pos = 0;
  var ctx = null;
  var cam = null;
  var image = null;
  
  var filter_on = false;
  var filter_id = 0;
  
  function changeFilter() {
   if (filter_on) {
   filter_id = (filter_id + 1) & 7;
   }
  }
  
  function toggleFilter(obj) {
   if (filter_on =!filter_on) {
   obj.parentNode.style.borderColor = "#c00";
   } else {
   obj.parentNode.style.borderColor = "#333";
   }
  }
  
  jQuery("#webcam").webcam({
  
   width: 320,
   height: 240,
   mode: "callback",
   swffile: "/download/jscam_canvas_only.swf",
  
   onTick: function(remain) {
  
   if (0 == remain) {
   jQuery("#status").text("Cheese!");
   } else {
   jQuery("#status").text(remain + " seconds remaining...");
   }
   },
  
   onSave: function(data) {
  
   var col = data.split(";");
   var img = image;
  
   if (false == filter_on) {
  
   for(var i = 0; i < 320; i++) {
   var tmp = parseInt(col[i]);
   img.data[pos + 0] = (tmp >> 16) & 0xff;
   img.data[pos + 1] = (tmp >> 8) & 0xff;
   img.data[pos + 2] = tmp & 0xff;
   img.data[pos + 3] = 0xff;
   pos+= 4;
   }
  
   } else {
  
   var id = filter_id;
   var r,g,b;
   var r1 = Math.floor(Math.random() * 255);
   var r2 = Math.floor(Math.random() * 255);
   var r3 = Math.floor(Math.random() * 255);
  
   for(var i = 0; i < 320; i++) {
   var tmp = parseInt(col[i]);
  
   /* Copied some xcolor methods here to be faster than calling all methods inside of xcolor and to not serve complete library with every req */
  
   if (id == 0) {
   r = (tmp >> 16) & 0xff;
   g = 0xff;
   b = 0xff;
   } else if (id == 1) {
   r = 0xff;
   g = (tmp >> 8) & 0xff;
   b = 0xff;
   } else if (id == 2) {
   r = 0xff;
   g = 0xff;
   b = tmp & 0xff;
   } else if (id == 3) {
   r = 0xff ^ ((tmp >> 16) & 0xff);
   g = 0xff ^ ((tmp >> 8) & 0xff);
   b = 0xff ^ (tmp & 0xff);
   } else if (id == 4) {
  
   r = (tmp >> 16) & 0xff;
   g = (tmp >> 8) & 0xff;
   b = tmp & 0xff;
   var v = Math.min(Math.floor(.35 + 13 * (r + g + b) / 60), 255);
   r = v;
   g = v;
   b = v;
   } else if (id == 5) {
   r = (tmp >> 16) & 0xff;
   g = (tmp >> 8) & 0xff;
   b = tmp & 0xff;
   if ((r+= 32) < 0) r = 0;
   if ((g+= 32) < 0) g = 0;
   if ((b+= 32) < 0) b = 0;
   } else if (id == 6) {
   r = (tmp >> 16) & 0xff;
   g = (tmp >> 8) & 0xff;
   b = tmp & 0xff;
   if ((r-= 32) < 0) r = 0;
   if ((g-= 32) < 0) g = 0;
   if ((b-= 32) < 0) b = 0;
   } else if (id == 7) {
   r = (tmp >> 16) & 0xff;
   g = (tmp >> 8) & 0xff;
   b = tmp & 0xff;
   r = Math.floor(r / 255 * r1);
   g = Math.floor(g / 255 * r2);
   b = Math.floor(b / 255 * r3);
   }
  
   img.data[pos + 0] = r;
   img.data[pos + 1] = g;
   img.data[pos + 2] = b;
   img.data[pos + 3] = 0xff;
   pos+= 4;
   }
   }
  
   if (pos >= 0x4B000) {
   ctx.putImageData(img, 0, 0);
   pos = 0;
   }
   },
  
   onCapture: function () {
   webcam.save();
  
   jQuery("#flash").css("display", "block");
   jQuery("#flash").fadeOut(100, function () {
   jQuery("#flash").css("opacity", 1);
   });
   },
  
   debug: function (type, string) {
   jQuery("#status").html(type + ": " + string);
   },
  
   onLoad: function () {
  
   var cams = webcam.getCameraList();
   for(var i in cams) {
   jQuery("#cams").append("<li>" + cams[i] + "</li>");
   }
   }
  });
  
  function getPageSize() {
  
   var xScroll, yScroll;
  
   if (window.innerHeight && window.scrollMaxY) {
   xScroll = window.innerWidth + window.scrollMaxX;
   yScroll = window.innerHeight + window.scrollMaxY;
   } else if (document.body.scrollHeight > document.body.offsetHeight){ // all but Explorer Mac
   xScroll = document.body.scrollWidth;
   yScroll = document.body.scrollHeight;
   } else { // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari
   xScroll = document.body.offsetWidth;
   yScroll = document.body.offsetHeight;
   }
  
   var windowWidth, windowHeight;
  
   if (self.innerHeight) { // all except Explorer
   if(document.documentElement.clientWidth){
   windowWidth = document.documentElement.clientWidth;
   } else {
   windowWidth = self.innerWidth;
   }
   windowHeight = self.innerHeight;
   } else if (document.documentElement && document.documentElement.clientHeight) { // Explorer 6 Strict Mode
   windowWidth = document.documentElement.clientWidth;
   windowHeight = document.documentElement.clientHeight;
   } else if (document.body) { // other Explorers
   windowWidth = document.body.clientWidth;
   windowHeight = document.body.clientHeight;
   }
  
   // for small pages with total height less then height of the viewport
   if(yScroll < windowHeight){
   pageHeight = windowHeight;
   } else {
   pageHeight = yScroll;
   }
  
   // for small pages with total width less then width of the viewport
   if(xScroll < windowWidth){
   pageWidth = xScroll;
   } else {
   pageWidth = windowWidth;
   }
  
   return [pageWidth, pageHeight];
  }
  
  window.addEventListener("load", function() {
  
   jQuery("body").append("<div id=\"flash\"></div>");
  
   var canvas = document.getElementById("canvas");
  
   if (canvas.getContext) {
   ctx = document.getElementById("canvas").getContext("2d");
   ctx.clearRect(0, 0, 320, 240);
  
   var img = new Image();
   img.src = "/image/logo.gif";
   img.onload = function() {
   ctx.drawImage(img, 129, 89);
   }
   image = ctx.getImageData(0, 0, 320, 240);
   }
   
   var pageSize = getPageSize();
   jQuery("#flash").css({ height: pageSize[1] + "px" });
  
  }, false);
  
  window.addEventListener("resize", function() {
  
   var pageSize = getPageSize();
   jQuery("#flash").css({ height: pageSize[1] + "px" });
  
  }, false);
  
  </script><p>If you activate the filter with the button on the right side of the picture, methods of my already published <a href="/project/jquery-color-plugin-xcolor/">jQuery plugin xcolor</a> will be used to distort the colors of the Canvas.</p><h2>General information about the interface</h2><p>The following snippet describes the interface of the webcam API:</p><pre class="prettyprint">$(&quot;#camera&quot;).webcam({
    width: 320,
    height: 240,
    mode: &quot;callback&quot;,
    swffile: &quot;/download/jscam_canvas_only.swf&quot;,
    onTick: function() {},
    onSave: function() {},
    onCapture: function() {},
    debug: function() {},
    onLoad: function() {}
  });</pre><h3>Config Parameter</h3><p><strong>width</strong><br />The width of the flash movie.</p><p><strong>height</strong><br />The height of the flash movie. Both parameters have to be changed in the Flash file as well. Follow the instructions below to recompile the swf after the size change.</p><p><strong>mode</strong><br />The storage mode can be one of the following: <em>callback</em>, <em>save</em>, <em>stream</em>. Details about the usage of each parameter can be found under the according heading below.</p><p><strong>swffile</strong><br />Points to the swf file of the Flash movie, which provides the webcam API. There are two swf files provided via the download archive: <strong>jscam.swf</strong>, which provides the full API and <strong>jscam_canvas_only.swf</strong> which have no embedded JPEG library (I embedded an adjusted JPGEncoder of the <a href="http://code.google.com/p/as3corelib/">AS 3 corelib</a>). Thereby, the file is only one third as large as the original.</p><p><strong>onTick</strong>, <strong>onSave</strong>, <strong>onCapture</strong><br />These callbacks are described in detail below, since they change with each mode.</p><p><strong>onLoad</strong><br />The <em>onLoad</em> callback is called as soon as the registration of the interface is done. In the example above, I use the callback to get a list of all cameras available:</p><pre class="prettyprint">onLoad: function() {
  
      var cams = webcam.getCameraList();
      for(var i in cams) {
          jQuery(&quot;#cams&quot;).append(&quot;&lt;li&gt;&quot; + cams[i] + &quot;&lt;/li&gt;&quot;);
      }
  }</pre><p>Once the <em>onLoad</em> callback is called, a global object <strong>window.webcam</strong> is available, which provides the following methods:</p><ul><li><strong>capture(<em>[delay]</em>)</strong><br />Captures an image internally.</li><li><strong>save(<em>[file]</em>)</strong><br />Saves the captured image accordingly to the storage mode.</li><li><strong>getCameraList()</strong><br />Get's an array of available cameras. If no camera is installed, an error is thrown and an empty array is returned.</li><li><strong>setCamera(<em>[index]</em>)</strong><br />Switches to a different camera. The parameter is the index of the element in the resulting array of <em>getCameraList()</em></li></ul><p><strong>debug</strong><br />The <em>debug</em> callback is called whenever there is a note or an error you should be notified. In the example above, I just replace the html content of the output container:</p><pre class="prettyprint">debug: function (type, string) {
    $("#status").html(type + ": " + string);
  }</pre><h2>Callback Interface</h2><p>The callback mode is used to get the raw data via a callback method to write it on a canvas element for example. The example above uses the callback mode.</p><p>As for the processing, one can imagine how it works as follows: Once the user has completely loaded the entire page and has accepted the security setting of Flash, she should be able to see herself. Then, the user triggers the method <em>window.capture()</em>. This may optionally receive a parameter that specifies the time to wait until the image is shot. To view the passage of time, the method <em>onTick()</em> is called after every second. The received parameter of this method is the amount of seconds remaining. In the example above, I simply change the status message like this:</p><pre class="prettyprint">onTick: function(remain) {
  
      if (0 == remain) {
          jQuery(&quot;#status&quot;).text(&quot;Cheese!&quot;);
      } else {
          jQuery(&quot;#status&quot;).text(remain + &quot; seconds remaining...&quot;);
      }
  }</pre><p>Is copying finished, the <em>onCapture</em> callback is called, which in the example of above immediately calls the method <em>webcam.save()</em> to ultimately write the image to the canvas. The sample code also contains a small gimmick to <strong>simulate a flash</strong> using a lightbox and jQuery's <em>fadeOut()</em> fx method.</p><pre class="prettyprint">onCapture: function () {
  
    jQuery(&quot;#flash&quot;).css(&quot;display&quot;, &quot;block&quot;);
    jQuery(&quot;#flash&quot;).fadeOut(&quot;fast&quot;, function () {
      jQuery(&quot;#flash&quot;).css(&quot;opacity&quot;, 1);
    });
  
    webcam.save();
  }</pre><p>In callback mode, for every line the callback <em>onSave()</em> is invoked, which gets an integer CSV of color values (separator is the semicolon). To write the data on the canvas, I use the following method in the example above:</p><pre class="prettyprint">onSave: function(data) {
  
      var col = data.split(&quot;;&quot;);
      var img = image;
  
      for(var i = 0; i < 320; i++) {
          var tmp = parseInt(col[i]);
          img.data[pos + 0] = (tmp &gt;&gt; 16) &amp; 0xff;
          img.data[pos + 1] = (tmp &gt;&gt; 8) &amp; 0xff;
          img.data[pos + 2] = tmp &amp; 0xff;
          img.data[pos + 3] = 0xff;
          pos+= 4;
      }
  
      if (pos &gt;= 4 * 320 * 240) {
          ctx.putImageData(img, 0, 0);
          pos = 0;
      }
  }</pre><h2>Save Interface</h2><p>From the view of processing, the save mode is almost identical to the callback mode. The only difference is that the <em>webcam.save()</em> method get's the file name passed as parameter. Then the shot photo is sent via <strong>HTTP_RAW_POST_DATA</strong> to the server and can be read for example with the following snippet to store or further process it in any way (Warning, input validation is not considered here!).</p><pre class="prettyprint">webcam.save('/upload.php');</pre><p>And on the server side, you get the image like this:</p><pre class="prettyprint">&lt;?php
  
  $str = file_get_contents(&quot;php://input&quot;);
  file_put_contents(&quot;/tmp/upload.jpg&quot;, pack(&quot;H*&quot;, $str));
  
  ?&gt;</pre><h3>Alternative method to the upload via Flash</h3><p>The Flash method has several problems. The implementation can lock the entire Flash movie and in the worst case the whole browser until the picture was uploaded sucessfully. A better approach is Ajax to upload the image asynchronously. Take a look at this example. It uploads a simple picture CSV if canvas elements are not implemented in the browser and sends a data url formatted string otherwise:</p><pre class="prettyprint">$(function() {
  
    var pos = 0, ctx = null, saveCB, image = [];
  
    var canvas = document.createElement("canvas");
    canvas.setAttribute('width', 320);
    canvas.setAttribute('height', 240);
    
    if (canvas.toDataURL) {
  
      ctx = canvas.getContext("2d");
      
      image = ctx.getImageData(0, 0, 320, 240);
    
      saveCB = function(data) {
        
        var col = data.split(";");
        var img = image;
  
        for(var i = 0; i &lt; 320; i++) {
          var tmp = parseInt(col[i]);
          img.data[pos + 0] = (tmp &gt;&gt; 16) & 0xff;
          img.data[pos + 1] = (tmp &gt;&gt; 8) & 0xff;
          img.data[pos + 2] = tmp & 0xff;
          img.data[pos + 3] = 0xff;
          pos+= 4;
        }
  
        if (pos &gt;= 4 * 320 * 240) {
          ctx.putImageData(img, 0, 0);
          $.post("/upload.php", {type: "data", image: canvas.toDataURL("image/png")});
          pos = 0;
        }
      };
  
    } else {
  
      saveCB = function(data) {
        image.push(data);
        
        pos+= 4 * 320;
        
        if (pos &gt;= 4 * 320 * 240) {
          $.post("/upload.php", {type: "pixel", image: image.join('|')});
          pos = 0;
        }
      };
    }
  
    $("#webcam").webcam({
  
      width: 320,
      height: 240,
      mode: "callback",
      swffile: "/download/jscam_canvas_only.swf",
  
      onSave: saveCB,
  
      onCapture: function () {
        webcam.save();
      },
  
      debug: function (type, string) {
        console.log(type + ": " + string);
      }
    });
  
  });
  </pre><p>The server could then do something like this:</p><pre class="prettyprint">&lt;?php
  
  if ($_POST['type'] == "pixel") {
    // input is in format 1,2,3...|1,2,3...|...
    $im = imagecreatetruecolor(320, 240);
  
    foreach (explode("|", $_POST['image']) as $y => $csv) {
      foreach (explode(";", $csv) as $x => $color) {
        imagesetpixel($im, $x, $y, $color);
      }
    }
  } else {
    // input is in format: data:image/png;base64,...
    $im = imagecreatefrompng($_POST['image']);
  }
  
  // do something with $im
  
  ?&gt;</pre><h2>Stream interface</h2><p>The stream mode is also quite the same procedure as the callback mode, with the difference that the <em>onSave</em> callback is called non-stop. The streaming starts with the method <em>webcam.capture()</em>. The <em>webcam.save()</em> method has no further effect.</p><h2>Recompile the Flash binary</h2><p>If you've made changes to the code or did just adjust the size of the video in the XML specification file, you can easily recompile the swf file from Linux console with the provided Makefile. You are required to install the two open source projects <strong>swfmill</strong> and <strong>mtasc</strong> that can be easily installed using apt-get under Debian/Ubuntu:</p><pre>apt-get install swfmill mtasc
  vim src/jscam.xml
  make</pre><h3>Hint about empty screens after recompilation</h3><p>There is a bug in the current version of swfmill. Please try to downgrade swfmill to <strong>2.0.12</strong>, which fixes the issue!</p></article><script type="text/javascript" src="/js/prettify.js"></script><script>
  
   window.onload = function() {
   prettyPrint();
   }
   </script><footer style="border-top: 1px solid #F2F2F0; font-size:14px;padding: 10px 0 25px; width:100%">&copy; 2008 &dash; 2018 Robert Eisele All rights reserved. <a href="/privacy-policy/" style="color:black">Privacy Policy</a>, <a href="/contact/" style="color:black">Contact</a></footer></main></body></html>