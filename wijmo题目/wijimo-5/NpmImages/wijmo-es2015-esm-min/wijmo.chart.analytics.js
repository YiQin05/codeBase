/*
    *
    * Wijmo Library 5.20183.550
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
import*as wjcChart from"wijmo/wijmo.chart";import*as wjcCore from"wijmo/wijmo";var __glob="undefined"!=typeof window?window:self;import*as wjcSelfRef from"wijmo/wijmo.chart.analytics";var wjcSelf=wjcSelfRef||exports;__glob.wijmo=__glob.wijmo||{},__glob.wijmo.chart=__glob.wijmo.chart||{},__glob.wijmo.chart.analytics=wjcSelf;export class TrendLineBase extends wjcChart.SeriesBase{constructor(t){super(),this._chartType=wjcChart.ChartType.Line,this._sampleCount=100,this.initialize(t)}get sampleCount(){return this._sampleCount}set sampleCount(t){(t=wjcCore.asNumber(t,!1,!0))!=this._sampleCount&&(this._sampleCount=t,this._invalidate())}approximate(t){return 0}getValues(t){var e=this,i=e.binding,r=e.bindingX;return i!==e._bind&&(e._bind=i,e.binding=i),r!==e._bindX&&(e._bindX=r,e.bindingX=r),null==e._originYValues&&(e._originYValues=super.getValues(0)),null==e._originXValues&&(e._originXValues=super.getValues(1)),null==e._originXValues||null==e._originYValues?null:(super.getValues(t),null!=e._xValues&&null!=e._yValues||e._calculateValues(),0===t?e._yValues||null:1===t?e._xValues||null:void 0)}_calculateValues(){}_invalidate(){super._invalidate(),this._clearCalculatedValues()}_clearValues(){super._clearValues(),this._originXValues=null,this._originYValues=null,this._clearCalculatedValues()}_clearCalculatedValues(){this._xValues=null,this._yValues=null}};class MathHelper{static round(t,e){if(!t)return 0;var i=Math.pow(10,e||2);return Math.round(t*i)/i}static avg(t){return MathHelper.sum(t)/t.length}static sum(t){return(t=wjcCore.asArray(t,!1)).reduce((t,e)=>t+e,0)}static sumOfPow(t,e){return t=wjcCore.asArray(t,!1),e=wjcCore.asNumber(e,!1),t.reduce((t,i)=>t+Math.pow(i,e),0)}static sumProduct(...t){t.length;var e,i,r=0,a=[];for((t=wjcCore.asArray(t,!1)).forEach((t,e)=>{t=wjcCore.asArray(t,!1),0===e?r=t.length:wjcCore.assert(t.length===r,"The length of the arrays must be equal")}),e=0;e<r;e++)i=1,t.some((t,r)=>{var a=t[e];if(!a||!wjcCore.isNumber(a))return i=0,!0;i*=a}),a.push(i);return MathHelper.sum(a)}static variance(t){t=wjcCore.asArray(t,!1);var e,i=MathHelper.avg(t);return e=t.map(t=>t-i),MathHelper.sumOfSquares(e)/(t.length-1)}static covariance(t,e){t=wjcCore.asArray(t,!1),e=wjcCore.asArray(e,!1),wjcCore.assert(t.length===e.length,"Length of arrays must be equal");var i,r=MathHelper.avg(t),a=MathHelper.avg(e),s=t.length,n=0;for(i=0;i<s;i++)n+=(t[i]-r)*(e[i]-a)/s;return n}}MathHelper.min=(t=>Math.min.apply(Math,wjcCore.asArray(t,!1))),MathHelper.max=(t=>Math.max.apply(Math,wjcCore.asArray(t,!1))),MathHelper.square=(t=>Math.pow(wjcCore.asNumber(t,!1),2)),MathHelper.sumOfSquares=(t=>MathHelper.sumOfPow(t,2)),MathHelper.stdDev=(t=>Math.sqrt(MathHelper.variance(t)));export var TrendLineFitType;!function(t){t[t.Linear=0]="Linear",t[t.Exponential=1]="Exponential",t[t.Logarithmic=2]="Logarithmic",t[t.Power=3]="Power",t[t.Fourier=4]="Fourier",t[t.Polynomial=5]="Polynomial",t[t.MinX=6]="MinX",t[t.MinY=7]="MinY",t[t.MaxX=8]="MaxX",t[t.MaxY=9]="MaxY",t[t.AverageX=10]="AverageX",t[t.AverageY=11]="AverageY"}(TrendLineFitType||(TrendLineFitType={}));export class TrendLine extends TrendLineBase{constructor(t){super(),this._fitType=TrendLineFitType.Linear,this._order=2,this.initialize(t)}get fitType(){return this._fitType}set fitType(t){(t=wjcCore.asEnum(t,TrendLineFitType,!1))!=this._fitType&&(this._fitType=t,this._invalidate())}get order(){return this._order}set order(t){t!=this._order&&(this._order=wjcCore.asNumber(t,!1,!0),this._invalidate())}get coefficients(){return this._helper?this._helper.coefficients:null}approximate(t){return this._helper?this._helper.approximate(t):NaN}getEquation(t){return(this._helper?this._helper.getEquation(t):"").replace(/\S(\+|\-)\d/g,function(t){return t[0]+" "+t[1]+" "+t[2]})}_calculateValues(){var t=TrendLineFitType[this._fitType];if(TrendLineHelper[t]){var e=!1,i=this._originXValues;0==this._chart._xvals.length&&this._chart._xlabels.length>0&&(i=this._originXValues.map(t=>t+1),e=!0);var r=new TrendLineHelper[t](this._originYValues,i,this.sampleCount,this.order);r._isXString=e;var a=r.calculateValues();this._yValues=a[0],this._xValues=a[1],this._helper=r}}};class Calculator{constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}get minX(){return null==this._minX&&(this._minX=MathHelper.min(this._x)),this._minX}get minY(){return null==this._minY&&(this._minY=MathHelper.min(this._y)),this._minY}get maxX(){return null==this._maxX&&(this._maxX=MathHelper.max(this._x)),this._maxX}get maxY(){return null==this._maxY&&(this._maxY=MathHelper.max(this._y)),this._maxY}get averageX(){return null==this._averageX&&(this._averageX=MathHelper.avg(this._x)),this._averageX}get averageY(){return null==this._averageY&&(this._averageY=MathHelper.avg(this._y)),this._averageY}get sumX(){return null==this._sumX&&(this._sumX=MathHelper.sum(this._x)),this._sumX}get sumY(){return null==this._sumY&&(this._sumY=MathHelper.sum(this._y)),this._sumY}get LogX(){return null==this._logX&&(this._logX=this._x.map(t=>Math.log(t))),this._logX}get LogY(){return null==this._logY&&(this._logY=this._y.map(t=>Math.log(t))),this._logY}get sumLogX(){return null==this._sumLogX&&(this._sumLogX=MathHelper.sum(this.LogX)),this._sumLogX}get sumLogY(){return null==this._sumLogY&&(this._sumLogY=MathHelper.sum(this.LogY)),this._sumLogY}get sumOfSquareX(){return null==this._sumOfSquareX&&(this._sumOfSquareX=MathHelper.sumOfSquares(this._x)),this._sumOfSquareX}get sumOfSquareY(){return null==this._sumOfSquareY&&(this._sumOfSquareY=MathHelper.sumOfSquares(this._y)),this._sumOfSquareY}get sumOfSquareLogX(){return null==this._sumOfSquareLogX&&(this._sumOfSquareLogX=MathHelper.sumOfSquares(this.LogX)),this._sumOfSquareLogX}get sumOfSquareLogY(){return null==this._sumOfSquareLogY&&(this._sumOfSquareLogY=MathHelper.sumOfSquares(this.LogY)),this._sumOfSquareLogY}sumProduct(t,e){return null==this._sumProduct&&(this._sumProduct=MathHelper.sumProduct(t,e)),this._sumProduct}}class TrendHelperBase{constructor(t,e,i){this._coefficients=[],this.y=wjcCore.asArray(t),this.x=wjcCore.asArray(e),wjcCore.assert(t.length===e.length,"Length of X and Y arrays are not equal"),this.count=i||t.length,this._calculator=new Calculator(e,t),this.xMin=this._calculator.minX,this.xMax=this._calculator.maxX}get calculator(){return this._calculator}get y(){return this._y}set y(t){t!==this.y&&(this._y=wjcCore.asArray(t,!1))}get x(){return this._x}set x(t){t!==this.x&&(this._x=wjcCore.asArray(t,!1))}get count(){return this._count}set count(t){t!==this.count&&(this._count=wjcCore.asInt(t,!1,!0))}get xMin(){return this._xMin}set xMin(t){t!==this.xMin&&(this._xMin=wjcCore.asNumber(t,!1))}get xMax(){return this._xMax}set xMax(t){t!==this.xMax&&(this._xMax=wjcCore.asNumber(t,!1))}get coefficients(){return this._coefficients}_calculateCoefficients(){var t=this.calcB(),e=this.calcA(t);this._coefficients.push(e,t)}calculateValues(){for(var t=(this.xMax-this.xMin)/(this.count-1),e=[[],[]],i=0;i<this.count;i++){var r=this.xMin+t*i,a=this.calcY(r);e[0].push(a),this._isXString?e[1].push(r-1):e[1].push(r)}return e}calcA(t){var e=this.y.length,i=this.calculator.sumX;return(this.calculator.sumY-(t=t||this.calcB())*i)/e}calcB(){var t=this.y.length,e=this.calculator,i=e.sumProduct(e.x,e.y),r=e.sumX;return(t*i-r*e.sumY)/(t*e.sumOfSquareX-MathHelper.square(r))}calcY(t){var e=this.coefficients;return e[0]+e[1]*t}approximate(t){return this.calcY(t)}getEquation(t){var t=t||this._defaultEquationFmt;return this._getEquation(t)}_getEquation(t){var e=[];return this.coefficients.forEach(i=>{e.push(t(i))}),this._concatEquation(e)}_concatEquation(t){return""}_defaultEquationFmt(t){var e,i=Math.abs(t),r=String(i),a=0;return i>=1e5?(e=String(Math.round(i)).length-1,Math.round(t/Number("1e"+e))+"e"+e):i<1e-4?(e=r.indexOf("e")>-1?Math.abs(+r.substring(r.indexOf("e")+1)):r.match(/\.0+/)[0].length,Math.round(t*Number("1e"+e))+"e-"+e):(a=t>0?6:7,i>=1e4&&a--,String(+String(t).substring(0,a)))}}class LinearHelper extends TrendHelperBase{get yOffset(){return this._yOffset}set yOffset(t){t!==this.yOffset&&(this._yOffset=wjcCore.asNumber(t,!0))}constructor(t,e,i,r){super(t,e,i),this._calculateCoefficients(),this.yOffset=r}calcA(t){return null!=this.yOffset?this.yOffset:super.calcA(t)}calcB(){return null!=this.yOffset?this._calculateBSimple():super.calcB()}_calculateBSimple(){var t=this.calculator,e=t.sumProduct(t.x,t.y),i=t.sumX,r=t.sumOfSquareX;return(e-this.yOffset*i)/r}_calculateCoefficients(){var t=this.calcB(),e=this.calcA(t);this.coefficients.push(t,e)}calcY(t){var e=this.coefficients;return e[0]*t+e[1]}_concatEquation(t){return"y = "+t[0]+"x"+(this.coefficients[1]>=0?"+":"")+t[1]}}class LogHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}calcA(t){var e=this.y.length,i=this.calculator,r=i.sumY,a=i.sumLogX;return(r-(t=t||this.calcB())*a)/e}calcB(){var t=this.y.length,e=this.calculator,i=e.sumProduct(e.y,e.LogX),r=e.sumY,a=e.sumLogX;return(t*i-r*a)/(t*e.sumOfSquareLogX-MathHelper.square(a))}_calculateCoefficients(){var t=this.calcB(),e=this.calcA(t);this.coefficients.push(t,e)}calcY(t){var e=this.coefficients;return Math.log(t)*e[0]+e[1]}_concatEquation(t){return"y = "+t[0]+"ln(x)"+(this.coefficients[1]>=0?"+":"")+t[1]}}class ExpHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}calcA(){var t=this.y.length,e=this.calculator,i=e.sumLogY,r=e.sumOfSquareX,a=e.sumX,s=e.sumProduct(e.x,e.LogY);return Math.exp((i*r-a*s)/(t*r-MathHelper.square(a)))}calcB(){var t=this.y.length,e=this.calculator,i=e.sumLogY,r=e.sumOfSquareX,a=e.sumX;return(t*e.sumProduct(e.x,e.LogY)-a*i)/(t*r-MathHelper.square(a))}calcY(t){var e=this.coefficients;return e[0]*Math.exp(e[1]*t)}_concatEquation(t){return"y = "+t[0]+"e<sup>"+t[1]+"x</sup>"}}class PowerHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}calcA(t){var e=this.calculator,i=this.y.length,r=e.sumLogX,a=e.sumLogY,t=t||this.calcB();return Math.exp((a-t*r)/i)}calcB(){var t=this.y.length,e=this.calculator,i=e.sumProduct(e.LogX,e.LogY),r=e.sumLogX;return(t*i-r*e.sumLogY)/(t*e.sumOfSquareLogX-MathHelper.square(r))}calcY(t){var e=this.coefficients;return e[0]*Math.pow(t,e[1])}_concatEquation(t){return"y = "+t[0]+"x<sup>"+t[1]+"</sup>"}}class LeastSquaresHelper extends TrendHelperBase{constructor(t,e,i,r){super(t,e,i),this._order=null==r?2:r,this._basis=[],this._calculateCoefficients()}get basis(){return this._basis}get order(){return this._order}set order(t){this._order=wjcCore.asNumber(t,!0)}_calculateCoefficients(){this._coefficients.length=this.order,this._createBasis(),this._normalizeAndSolveGauss()}_createBasis(){var t=this.x.length,e=this.order;if(t<2)throw"Incompatible data: Less than 2 data points.";if(e<1)throw"Incompatible data: Less than 1 coefficient in the fit";if(e>t)throw"Incompatible data: Number of data points less than number of terms"}_normalizeAndSolveGauss(){var t=[];if(this._computeNormalEquations(t),this._genDefValForArray(t,0),!this._solveGauss(t))throw"Incompatible data: No solution."}_genDefValForArray(t,e){var i=t.length+1;t.forEach(t=>{for(var r=0;r<i;r++)null==t[r]&&(t[r]=e)})}_computeNormalEquations(t){var e,i,r,a,s=this.y,n=this.basis,l=this.order,h=s.length;for(e=0;e<l;e++)for(r=0,null==t[e]&&(t[e]=[]),s.forEach((t,i)=>{r+=t*n[i][e]}),t[e][l]=r,i=e;i<l;i++){for(r=0,a=0;a<h;a++)r+=n[a][i]*n[a][e];null==t[i]&&(t[i]=[]),t[i][e]=r,t[e][i]=r}}_solveGauss(t){var e,i,r=t.length,a=this._coefficients,s=!0;if(a.length<r||t[0].length<r+1)throw"Dimension of matrix is not correct.";if(t.some((e,a)=>{var n,l,h=a,o=Math.abs(e[a]);for(i=a+1;i<r;i++)o<(n=Math.abs(t[i][a]))&&(o=n,h=i);if(!(o>0))return s=!1,!0;for(i=a;i<=r;i++)l=t[a][i],t[a][i]=t[h][i],t[h][i]=l;for(h=a+1;h<r;h++)for(l=t[h][a]/e[a],t[h][a]=0,i=a+1;i<=r;i++)t[h][i]-=l*e[i]}),s)for(e=r-1;e>=0;e--){for(a[e]=t[e][r],i=e+1;i<r;i++)a[e]-=t[e][i]*a[i];a[e]=a[e]/t[e][e]}return s}}class PolyHelper extends LeastSquaresHelper{constructor(t,e,i,r){super(t,e,i,r)}get coefficients(){return this._coefficients.slice(0).reverse()}calcY(t){var e=0,i=1;return this._coefficients.forEach((r,a)=>{a>0&&(i*=t),e+=r*i}),e}_calculateCoefficients(){this._coefficients;this.order++,super._calculateCoefficients(),this.order--}_createBasis(){super._createBasis();var t=this.x,e=this.basis,i=this.order;t.forEach((t,r)=>{e[r]=[1];for(var a=1;a<=i;a++)e[r][a]=t*e[r][a-1]})}_concatEquation(t){var e="y = ",i=t.length,r=this.coefficients;return t.forEach(function(t,a){var s,n=i-1-a;0===n?e+=t:1===n?(s=r[a+1]>=0?"+":"",e+=t+"x"+s):(s=r[a+1]>=0?"+":"",e+=t+"x<sup>"+n+"</sup>"+s)}),e}}class FourierHelper extends LeastSquaresHelper{constructor(t,e,i,r){super(t,e,i,r=null==r?e.length:r)}_createBasis(){super._createBasis();var t=this.x,e=this.basis,i=this.order;t.forEach((t,r)=>{var a,s;for(e[r]=[1],a=1;a<i;a++)s=Math.floor((a+1)/2),a%2==1?e[r].push(Math.cos(s*t)):e[r].push(Math.sin(s*t))})}calcY(t){var e;return this._coefficients.forEach((i,r)=>{var a,s=Math.floor((r+1)/2);0===r?e=i:(a=s*t,e+=r%2==1?i*Math.cos(a):i*Math.sin(a))}),e}_concatEquation(t){var e="y = ",i=t.length,r=this.coefficients;return t.forEach(function(t,a){var s=a===i-1?"":r[a+1]>=0?"+":"",n="",l=Math.ceil(a/2);if(0===a)e+=t+s;else{n=a%2==1?"cos":"sin";n+="("+(1===l?"":String(l))+"x)",e+=t+n+s}}),e}}class SimpleTrendHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}_setVal(t){this._val=t}calcY(t){return this._val}}class MinXHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMin,r=MathHelper.min(this.y),a=MathHelper.max(this.y);return this._isXString&&(i-=1),t=[i,i],e=[r,a],this._setVal(i),[e,t]}getEquation(t){var e=this.xMin;return this._isXString&&(e-=1),t&&(e=t(e)),"x = "+e}}class MinYHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMin,r=this.xMax,a=MathHelper.min(this.y);return this._isXString&&(i-=1,r-=1),t=[i,r],e=[a,a],this._setVal(a),[e,t]}getEquation(t){var e=MathHelper.min(this.y);return t&&(e=t(e)),"y = "+e}}class MaxXHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMax,r=MathHelper.min(this.y),a=MathHelper.max(this.y);return this._isXString&&(i-=1),t=[i,i],e=[r,a],this._setVal(i),[e,t]}getEquation(t){var e=this.xMax;return this._isXString&&(e-=1),t&&(e=t(e)),"x = "+e}}class MaxYHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMin,r=this.xMax,a=MathHelper.max(this.y);return this._isXString&&(i-=1,r-=1),t=[i,r],e=[a,a],this._setVal(a),[e,t]}getEquation(t){var e=MathHelper.max(this.y);return t&&(e=t(e)),"y = "+e}}class AverageXHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=MathHelper.avg(this.x),r=MathHelper.min(this.y),a=MathHelper.max(this.y);return this._isXString&&(i-=1),t=[i,i],e=[r,a],this._setVal(i),[e,t]}_getEquation(t){var e=MathHelper.avg(this.x);return this._isXString&&(e-=1),t&&(e=t(e))," x ="+e}_defaultEquationFmt(t){return Math.abs(t)<1e5?super._defaultEquationFmt(t):""+MathHelper.round(t,2)}}class AverageYHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=MathHelper.avg(this.y),r=this.xMin,a=this.xMax;return this._isXString&&(r-=1,a-=1),t=[r,a],e=[i,i],this._setVal(i),[e,t]}_getEquation(t){return"y = "+t(MathHelper.avg(this.y))}_defaultEquationFmt(t){return Math.abs(t)<1e5?super._defaultEquationFmt(t):""+MathHelper.round(t,2)}}var TrendLineHelper={TrendHelperBase:TrendHelperBase,Linear:LinearHelper,Exponential:ExpHelper,Logarithmic:LogHelper,Power:PowerHelper,Polynomial:PolyHelper,Fourier:FourierHelper,MinX:MinXHelper,MinY:MinYHelper,MaxX:MaxXHelper,MaxY:MaxYHelper,AverageX:AverageXHelper,AverageY:AverageYHelper};export class FunctionSeries extends TrendLineBase{constructor(t){super(),this._min=0,this._max=1,this.initialize(t),null==this.itemsSource&&(this.itemsSource=[new wjcCore.Point(0,0)])}get min(){return this._min}set min(t){this._min!==t&&(this._min=wjcCore.asNumber(t,!1),this._invalidate())}get max(){return this._max}set max(t){this._max!==t&&(this._max=wjcCore.asNumber(t,!1),this._invalidate())}getValues(t){var e=this;return null!=e._xValues&&null!=e._yValues||e._calculateValues(),0===t?e._yValues||null:1===t?e._xValues||null:void 0}_calculateValues(){for(var t,e=this,i=e.sampleCount,r=[],a=[],s=(e.max-e.min)/(i-1),n=0;n<i;n++)t=n===i-1?this.max:this.min+s*n,r[n]=e._calculateX(t),a[n]=e._calculateY(t);e._yValues=a,e._xValues=r}_validateValue(t){return isFinite(t)?t:Number.NaN}_calculateValue(t,e){var i;try{i=t(e)}catch(t){i=Number.NaN}return this._validateValue(i)}_calculateX(t){return 0}_calculateY(t){return 0}};export class YFunctionSeries extends FunctionSeries{constructor(t){super(t)}get func(){return this._func}set func(t){t&&this._func!==t&&(this._func=wjcCore.asFunction(t,!1),this._invalidate())}_calculateX(t){return t}_calculateY(t){return this._calculateValue(this.func,t)}approximate(t){return this._calculateValue(this.func,t)}};export class ParametricFunctionSeries extends FunctionSeries{constructor(t){super(t)}get xFunc(){return this._xFunc}set xFunc(t){t&&this._xFunc!==t&&(this._xFunc=wjcCore.asFunction(t,!1),this._invalidate())}get yFunc(){return this._yFunc}set yFunc(t){t&&this._yFunc!==t&&(this._yFunc=wjcCore.asFunction(t,!1),this._invalidate())}_calculateX(t){return this._calculateValue(this.xFunc,t)}_calculateY(t){return this._calculateValue(this.yFunc,t)}approximate(t){var e=this._calculateValue(this.xFunc,t),i=this._calculateValue(this.yFunc,t);return new wjcCore.Point(e,i)}};export var MovingAverageType;!function(t){t[t.Simple=0]="Simple",t[t.Weighted=1]="Weighted",t[t.Exponential=2]="Exponential",t[t.Triangular=3]="Triangular"}(MovingAverageType||(MovingAverageType={}));export class MovingAverage extends TrendLineBase{constructor(t){super(),this._chartType=wjcChart.ChartType.Line,this._type=MovingAverageType.Simple,this._period=2,this.initialize(t)}get type(){return this._type}set type(t){(t=wjcCore.asEnum(t,MovingAverageType,!1))!=this._type&&(this._type=t,this._invalidate())}get period(){return this._period}set period(t){(t=wjcCore.asNumber(t,!1,!0))!=this._period&&(this._period=wjcCore.asNumber(t,!1,!0),this._invalidate())}_checkPeriod(){var t=this.period,e=this._originXValues;t<=1&&wjcCore.assert(!1,"period must be greater than 1."),e&&e.length&&t>=e.length&&wjcCore.assert(!1,"period must be less than itemSource's length.")}_calculateValues(){this._type;var t="_calculate"+MovingAverageType[this._type],e=[],i=[];this._checkPeriod(),this[t]&&this[t].call(this,e,i),this._yValues=i,this._xValues=e}_calculateSimple(t,e,i=!1){for(var r=this._originXValues,a=this._originYValues,s=r.length,n=this._period,l=0,h=0;h<s;h++)l+=a[h]||0,h>=n&&(l-=a[h-n]||0),h>=n-1?(t.push(r[h]),e.push(l/n)):i&&(t.push(r[h]),e.push(l/(h+1)))}_calculateWeighted(t,e){for(var i=this._originXValues,r=this._originYValues,a=i.length,s=this._period,n=s*(s+1)/2,l=0,h=0,o=0;o<a;o++)o>0&&(l+=r[o-1]||0),o>s&&(l-=r[o-s-1]||0),o<s-1?h+=(r[o]||0)*(o+1):(h+=(r[o]||0)*s,o>s-1&&(h-=l),t.push(i[o]),e.push(h/n))}_calculateExponential(t,e){for(var i=this._originXValues,r=this._originYValues,a=i.length,s=this._period,n=0,l=0;l<a;l++)l<=s-2?(n+=r[l]||0,l===s-2&&(n/=s-1)):(n+=2/(s+1)*((r[l]||0)-n),t.push(i[l]),e.push(n))}_calculateTriangular(t,e){var i=this._period,r=[],a=[],s=0;this._calculateSimple(r,a,!0);for(var n=0,l=r.length;n<l;n++)s+=a[n]||0,n>=i&&(s-=a[n-i]||0),n>=i-1&&(t.push(r[n]),e.push(s/i))}};export class Waterfall extends wjcChart.SeriesBase{constructor(t){super(),this._startLabel="Start",this._relativeData=!0,this._connectorLines=!1,this._showTotal=!1,this._totalLabel="Total",this._getXValues=!1,this._showIntermediateTotal=!1,this._intermediateTotalPos=[],this._chartType=wjcChart.ChartType.Bar,this.rendering.addHandler(this._rendering,this),this.initialize(t)}get relativeData(){return this._relativeData}set relativeData(t){t!=this._relativeData&&(this._relativeData=wjcCore.asBoolean(t,!0),this._invalidate())}get start(){return this._start}set start(t){t!=this._start&&(this._start=wjcCore.asNumber(t,!0),this._invalidate())}get startLabel(){return this._startLabel}set startLabel(t){t!=this._startLabel&&(this._startLabel=wjcCore.asString(t,!1),this._invalidate())}get showTotal(){return this._showTotal}set showTotal(t){t!=this._showTotal&&(this._showTotal=wjcCore.asBoolean(t,!0),this._invalidate())}get totalLabel(){return this._totalLabel}set totalLabel(t){t!=this._totalLabel&&(this._totalLabel=wjcCore.asString(t,!1),this._invalidate())}get showIntermediateTotal(){return this._showIntermediateTotal}set showIntermediateTotal(t){t!=this._showIntermediateTotal&&(this._showIntermediateTotal=wjcCore.asBoolean(t,!1),this._invalidate())}get intermediateTotalPositions(){return this._intermediateTotalPositions}set intermediateTotalPositions(t){t!=this._intermediateTotalPositions&&(this._intermediateTotalPositions=wjcCore.asArray(t,!0),this._invalidate())}get intermediateTotalLabels(){return this._intermediateTotalLabels}set intermediateTotalLabels(t){t!=this._intermediateTotalLabels&&(wjcCore.assert(null==t||wjcCore.isArray(t)||wjcCore.isString(t),"Array or string expected."),this._intermediateTotalLabels=t,this._invalidate())}get connectorLines(){return this._connectorLines}set connectorLines(t){t!=this._connectorLines&&(this._connectorLines=wjcCore.asBoolean(t,!0),this._invalidate())}get styles(){return this._styles}set styles(t){t!=this._styles&&(this._styles=t,this._invalidate())}getValues(t){var e,i,r,a,s=[],n=0;if(e=super.getValues(t),0===t){if(!this._yValues){var s=[],l=0,h=0,o=e&&e.length||0;if(this.relativeData){for(;h<o;h++)l+=isNaN(e[h])?0:e[h],s.push(l);this._yValues=s}else{for(;h<o;h++)l=isNaN(e[h])?0:e[h],s.push(l);this._yValues=s}(i=this._yValues)&&i.length>0&&(this.showIntermediateTotal&&this.intermediateTotalPositions&&this.intermediateTotalPositions.length>0&&(this._intermediateTotalPos=i.slice(),this.intermediateTotalPositions.reduceRight((t,e)=>{var r=0===e?i[0]:i[e-1];return i.length>e?(i.splice(e,0,r),this._intermediateTotalPos.splice(e,0,!0)):i.length===e&&(i.push(r),this._intermediateTotalPos.push(!0)),0},0)),null!=this.start&&(i.splice(0,0,this.start),this._intermediateTotalPos.splice(0,0,!1)),this.showTotal&&i&&i.push(i[i.length-1]))}return this._yValues}if(!this._xValues&&this._getXValues&&(this._xValues=e&&e.slice(),this._getXValues=!1,this._xValues&&this._xValues.length>1&&(o=this._xValues.length,a=this._xValues[o-1],n=Math.abs(this._xValues[o-1]-this._xValues[o-2])),this.chart&&this.chart._xlabels&&this.chart._xlabels.length)){if(r=this.chart._xlabels,this.showIntermediateTotal&&this.intermediateTotalPositions&&this.intermediateTotalPositions.length>0){var u=this.intermediateTotalLabels;u&&this.intermediateTotalPositions.reduceRight((t,e,i)=>{var s="";return s=wjcCore.isString(u)?u:u[i]||"",r.length>e?r.splice(e,0,s):r.length===e&&r.push(s),n&&(a+=n,this._xValues.push(a)),0},0)}null!=this.start&&(r.splice(0,0,this.startLabel),n&&(a+=n,this._xValues.push(a))),this.showTotal&&(r.push(this.totalLabel),n&&(a+=n,this._xValues.push(a)))}return this._xValues}legendItemLength(){return this.showTotal?3:2}measureLegendItem(t,e){var i=this._getName(e);return i?this._measureLegendItem(t,i):new wjcCore.Size(0,0)}drawLegendItem(t,e,i){var r=this._getLegendStyles(i);this._getName(i)&&this._drawLegendItem(t,e,wjcChart.ChartType.Bar,this._getName(i),r,this.symbolStyle)}_clearValues(){super._clearValues(),this._xValues=null,this._yValues=null,this._wfstyle=null,this._getXValues=!0,this._intermediateTotalPos=[],this.chart&&this.chart._performBind()}_invalidate(){super._invalidate(),this._clearValues()}_rendering(t,e){e.cancel=!0,this._wfstyle=null;var i,r,a,s,n,l,h=this.chart,o=this._getAxisY(),u=this._getAxisX(),c=o.origin||0,_=e.engine;if(this._barPlotter=h._getPlotter(this),a=this._barPlotter.rotated,this._barPlotter._getSymbolOrigin||(this._barPlotter._getSymbolOrigin=((t,e,i)=>0===e?t:!0===this._intermediateTotalPos[e]?t:e===i-1&&this.showTotal?t:this._yValues[e-1])),this._barPlotter._getSymbolStyles||(this._barPlotter._getSymbolStyles=((t,e)=>{var i=this._getStyles();return 0===t&&null!=this.start?i.start:!0===this._intermediateTotalPos[t]?i.intermediateTotal:t===e-1&&this.showTotal?i.total:this._yValues[t]<this._yValues[t-1]?i.falling:i.rising})),this._barPlotter.plotSeries(_,u,o,t,h,0,1),this.connectorLines){for(_.startGroup(Waterfall.CSS_CONNECTOR_LINE_GROUP),s=this._barPlotter.hitTester._map[0],l=this._yValues[0]<c,n=s[0].rect,i=1,r=s.length;i<r;i++)!0===this._intermediateTotalPos[i]&&i!==r-1||(this._drawConnectorLine(_,a,n,s[i].rect,l),n=s[i].rect,l=this._yValues[i]<this._yValues[i-1]);_.endGroup()}}_getStyles(){if(this._wfstyle)return this._wfstyle;var t=this._chart.series.indexOf(this),e=this._getSymbolFill(t),i=this._getSymbolStroke(t),r=this.styles||{};return this._wfstyle={start:this._getStyleByKey(r,"start",e,i),intermediateTotal:this._getStyleByKey(r,"intermediateTotal",e,i),total:this._getStyleByKey(r,"total",e,i),falling:this._getStyleByKey(r,"falling","red","red"),rising:this._getStyleByKey(r,"rising","green","green")},this._wfstyle}_getStyleByKey(t,e,i,r){return{fill:t[e]&&t[e].fill?t[e].fill:i,stroke:t[e]&&t[e].stroke?t[e].stroke:r}}_drawConnectorLine(t,e,i,r,a){var s=new wjcCore.Point,n=new wjcCore.Point,l=this.chart.axisY.reversed,h=this.chart.axisX.reversed;l^=a,e?(l?(s.x=i.left,n.x=i.left):(s.x=i.left+i.width,n.x=i.left+i.width),h?(s.y=i.top,n.y=r.top+r.height):(s.y=i.top+i.height,n.y=r.top)):(l?(s.y=i.top+i.height,n.y=i.top+i.height):(s.y=i.top,n.y=i.top),h?(s.x=i.left+i.width,n.x=r.left):(s.x=i.left,n.x=r.left+r.width)),t.drawLine(s.x,s.y,n.x,n.y,Waterfall.CSS_CONNECTOR_LINE,this.styles&&this.styles.connectorLines||{stroke:"black"})}_getLegendStyles(t){if(t<0||null===this.styles)return null;var e=this._getStyles();return 0===t?e.rising:1===t?e.falling:e.total}_getName(t){var e=void 0;if(this.name)if(this.name.indexOf(",")){var i=this.name.split(",");i&&i.length-1>=t&&(e=i[t].trim())}else e=this.name;return e}};Waterfall.CSS_CONNECTOR_LINE_GROUP="water-fall-connector-lines",Waterfall.CSS_CONNECTOR_LINE="water-fall-connector-line",Waterfall.CSS_ENDLABEL="water-fall-end-label";export var QuartileCalculation;!function(t){t[t.InclusiveMedian=0]="InclusiveMedian",t[t.ExclusiveMedian=1]="ExclusiveMedian"}(QuartileCalculation||(QuartileCalculation={}));export class BoxWhisker extends wjcChart.SeriesBase{constructor(t){super(),this._groupWidth=.8,this._gapWidth=.1,this._showInnerPoints=!1,this._showOutliers=!1,this._quartileCalculation=QuartileCalculation.InclusiveMedian,this._chartType=wjcChart.ChartType.Bar,this.rendering.addHandler(this._rendering,this),this.initialize(t)}_initProperties(t){t&&wjcCore.copy(this,t)}_clearValues(){super._clearValues()}get quartileCalculation(){return this._quartileCalculation}set quartileCalculation(t){(t=wjcCore.asEnum(t,QuartileCalculation,!0))!=this._quartileCalculation&&(this._quartileCalculation=t,this._invalidate())}get groupWidth(){return this._groupWidth}set groupWidth(t){t!=this._groupWidth&&t>=0&&t<=1&&(this._groupWidth=wjcCore.asNumber(t,!0),this._invalidate())}get gapWidth(){return this._gapWidth}set gapWidth(t){t!=this._gapWidth&&t>=0&&t<=1&&(this._gapWidth=wjcCore.asNumber(t,!0),this._invalidate())}get showMeanLine(){return this._showMeanLine}set showMeanLine(t){t!=this._showMeanLine&&(this._showMeanLine=wjcCore.asBoolean(t,!0),this._invalidate())}get meanLineStyle(){return this._meanLineStyle}set meanLineStyle(t){t!=this._meanLineStyle&&(this._meanLineStyle=t,this._invalidate())}get showMeanMarker(){return this._showMeanMarker}set showMeanMarker(t){t!=this._showMeanMarker&&(this._showMeanMarker=wjcCore.asBoolean(t,!0),this._invalidate())}get meanMarkerStyle(){return this._meanMarkerStyle}set meanMarkerStyle(t){t!=this._meanMarkerStyle&&(this._meanMarkerStyle=t,this._invalidate())}get showInnerPoints(){return this._showInnerPoints}set showInnerPoints(t){t!=this._showInnerPoints&&(this._showInnerPoints=wjcCore.asBoolean(t,!0),this._invalidate())}get showOutliers(){return this._showOutliers}set showOutliers(t){t!=this._showOutliers&&(this._showOutliers=wjcCore.asBoolean(t,!0),this._invalidate())}_rendering(t,e){e.cancel=!0;var i,r,a=this,s=a.chart,n=(a.chart,a._getAxisX()),l=a._getAxisY(),h=e.index,o=e.count,u=e.engine,c=this._plotter,_=s.series.indexOf(a),m=wjcCore.asType(a,wjcChart.SeriesBase),d=this.quartileCalculation,g=this.showOutliers,p=this.groupWidth,f=(null==this.gapWidth?.2:this.gapWidth)/2;h=h||0;var x=p/(o=o||1),y=a.getValues(0),v=a.getValues(1);if(y){if(v||(v=c.dataInfo.getXVals()),v){var w=c.dataInfo.getDeltaX();w>0&&(p*=w,x*=w)}var M=m._getSymbolFill(_),S=m._getAltSymbolFill(_)||M,C=m._getSymbolStroke(_),V=m._getAltSymbolStroke(_)||C,b=y.length;null!=v&&(b=Math.min(b,v.length));var L,P,E=0,j=0;if(c.rotated){(E=n.origin||E)<n.actualMin?E=n.actualMin:E>n.actualMax&&(E=n.actualMax);n.convert(E);for(var T=l.actualMin,B=l.actualMax,X=0;X<b;X++){var H=v?v[X]:X,A=y[X];if(null==A||0===A.length)return;if(c._getSymbolOrigin&&l.convert(c._getSymbolOrigin(E,X)),c._getSymbolStyles){var q=c._getSymbolStyles(X);M=q&&q.fill?q.fill:M,S=q&&q.fill?q.fill:S,C=q&&q.stroke?q.fill:C,V=q&&q.stroke?q.fill:V}if(L=A[0]>0?M:S,P=A[0]>0?C:V,u.fill=L,u.stroke=P,wjcChart._DataInfo.isValid(H)&&wjcCore.isArray(A)&&A.length>0&&wjcChart._DataInfo.isValid(A[0])){var Y=H-.5*p+h*x,O=H-.5*p+(h+1)*x,N=(O-Y)*f;if(Y+=N,O-=N,Y<T&&O<T||Y>B&&O>B)continue;Y=l.convert(Y),O=l.convert(O);var F=new _BoxPlot(A,d,g),I={min:n.convert(F.min),max:n.convert(F.max),firstQuartile:n.convert(F.firstQuartile),median:n.convert(F.median),thirdQuartile:n.convert(F.thirdQuartile),mean:n.convert(F.mean),outlierPoints:this._convertPoints(F.outlierPoints,n),innerPoints:this._convertPoints(F.innerPoints,n)},k=new wjcCore.Rect(Math.min(I.min,I.max),Math.min(Y,O),Math.abs(I.max-I.min),Math.abs(O-Y)),Q=new wjcChart._RectArea(k),D={min:Math.min(Y,O),median:(Y+O)/2,max:Math.max(O,Y)};if(s.itemFormatter){u.startGroup();var W=new wjcChart.HitTestInfo(s,new wjcCore.Point((I.min+I.max)/2,D.median),wjcChart.ChartElement.SeriesSymbol);W._setData(a,X),s.itemFormatter(u,W,()=>{this._drawBoxWhisker(u,I,D,i,r,a),i=I,r=D}),u.endGroup()}else this._drawBoxWhisker(u,I,D,i,r,a),i=I,r=D;a._setPointIndex(X,j),j++;var R=new wjcChart._DataPoint(_,X,A,H);R.item=F,Q.tag=R,c.hitTester.add(Q,_),F.outlierPoints&&F.outlierPoints.length&&F.outlierPoints.forEach((t,e)=>{let i=I.outlierPoints[e],r=new wjcChart._CircleArea(new wjcCore.Point(i,k.top+k.height/2),2);r.tag=R,c.hitTester.add(r,_)})}}}else{(E=l.origin||E)<l.actualMin?E=l.actualMin:E>l.actualMax&&(E=l.actualMax);l.convert(E);for(var G=n.actualMin,z=n.actualMax,X=0;X<b;X++){H=v?v[X]:X;if(null==(A=y[X])||0===A.length)return;if(c._getSymbolOrigin&&l.convert(c._getSymbolOrigin(E,X,b)),c._getSymbolStyles&&(M=(q=c._getSymbolStyles(X,b))&&q.fill?q.fill:M,S=q&&q.fill?q.fill:S,C=q&&q.stroke?q.stroke:C,V=q&&q.stroke?q.stroke:V),L=A[0]>0?M:S,P=A[0]>0?C:V,u.fill=L,u.stroke=P,wjcChart._DataInfo.isValid(H)&&wjcCore.isArray(A)&&A.length>0&&wjcChart._DataInfo.isValid(A[0])){var K=H-.5*p+h*x,U=H-.5*p+(h+1)*x;if(K+=N=(U-K)*f,U-=N,K<G&&U<G||K>z&&U>z)continue;if(K=n.convert(K),U=n.convert(U),!wjcChart._DataInfo.isValid(K)||!wjcChart._DataInfo.isValid(U))continue;var F=new _BoxPlot(A,d,g),I={min:l.convert(F.min),max:l.convert(F.max),firstQuartile:l.convert(F.firstQuartile),median:l.convert(F.median),thirdQuartile:l.convert(F.thirdQuartile),mean:l.convert(F.mean),outlierPoints:this._convertPoints(F.outlierPoints,l),innerPoints:this._convertPoints(F.innerPoints,l)},k=new wjcCore.Rect(Math.min(K,U),Math.min(I.min,I.max),Math.abs(U-K),Math.abs(I.max-I.min)),Q=new wjcChart._RectArea(k),J={min:Math.min(K,U),median:(K+U)/2,max:Math.max(K,U)};s.itemFormatter?(u.startGroup(),(W=new wjcChart.HitTestInfo(s,new wjcCore.Point(J.median,(I.min+I.max)/2),wjcChart.ChartElement.SeriesSymbol))._setData(a,X),s.itemFormatter(u,W,()=>{this._drawBoxWhisker(u,J,I,i,r,a),i=J,r=I}),u.endGroup()):(this._drawBoxWhisker(u,J,I,i,r,a),i=J,r=I),a._setPointIndex(X,j),j++,(R=new wjcChart._DataPoint(_,X,H,A)).item=F,Q.tag=R,c.hitTester.add(Q,_),F.outlierPoints&&F.outlierPoints.length&&F.outlierPoints.forEach((t,e)=>{let i=I.outlierPoints[e],r=new wjcChart._CircleArea(new wjcCore.Point(k.left+k.width/2,i),2);r.tag=R,c.hitTester.add(r,_)})}}}}}_convertPoints(t,e){return t.map(t=>e.convert(t))}_drawBoxWhisker(t,e,i,r,a,s){var n=s.symbolStyle,l=this.showInnerPoints,h=this.showOutliers,o=this.showMeanLine,u=this.meanLineStyle,c=this.showMeanMarker,_=this.meanMarkerStyle,m=this._plotter;if(t.startGroup("box-plot"),m.rotated){if(t.drawLine(e.min,(i.min+i.median)/2,e.min,(i.max+i.median)/2,null,n),t.drawLine(e.min,i.median,e.firstQuartile,i.median,null,n),t.drawRect(Math.min(e.firstQuartile,e.thirdQuartile),Math.min(i.min,i.max),Math.abs(e.thirdQuartile-e.firstQuartile),Math.abs(i.max-i.min),null,n),t.drawLine(e.median,i.min,e.median,i.max,null,n),t.drawLine(e.max,i.median,e.thirdQuartile,i.median,null,n),t.drawLine(e.max,(i.min+i.median)/2,e.max,(i.max+i.median)/2,null,n),o&&r&&a&&t.drawLine(e.mean,i.median,r.mean,a.median,"box-whisker-mean-line",u||n),c){d=Math.abs(i.median-i.min)/2;t.drawLine(e.mean-d,i.median-d,e.mean+d,i.median+d,null,_||n),t.drawLine(e.mean+d,i.median-d,e.mean-d,i.median+d,null,_||n)}h&&e.outlierPoints.forEach(e=>{t.drawPieSegment(e,i.median,2,0,2*Math.PI,null,n)}),l&&e.innerPoints.forEach(e=>{t.drawPieSegment(e,i.median,2,0,2*Math.PI,null,n)})}else{if(t.drawLine((e.min+e.median)/2,i.min,(e.max+e.median)/2,i.min,null,n),t.drawLine(e.median,i.min,e.median,i.firstQuartile,null,n),t.drawRect(Math.min(e.min,e.max),Math.min(i.firstQuartile,i.thirdQuartile),Math.abs(e.max-e.min),Math.abs(i.thirdQuartile-i.firstQuartile),null,n),t.drawLine(e.min,i.median,e.max,i.median,null,n),t.drawLine(e.median,i.max,e.median,i.thirdQuartile,null,n),t.drawLine((e.min+e.median)/2,i.max,(e.max+e.median)/2,i.max,null,n),o&&r&&a&&t.drawLine(e.median,i.mean,r.median,a.mean,"box-whisker-mean-line",u||n),c){var d=Math.abs(e.median-e.min)/2;t.drawLine(e.median-d,i.mean-d,e.median+d,i.mean+d,null,_||n),t.drawLine(e.median-d,i.mean+d,e.median+d,i.mean-d,null,_||n)}h&&i.outlierPoints.forEach(i=>{t.drawPieSegment(e.median,i,2,0,2*Math.PI,null,n)}),l&&i.innerPoints.forEach(i=>{t.drawPieSegment(e.median,i,2,0,2*Math.PI,null,n)})}t.endGroup()}_renderLabels(t,e,i,r){var a=this,s=this._plotter,n=e.length,l=i.dataLabel,h=l.border,o=l.offset,u=l.connectingLine,c="dataY";s.rotated&&(c="dataX"),void 0===o&&(o=u?16:0),h&&(o-=2);for(var _=0;_<n;_++){var m=e[_],d=m.tag,g=wjcCore.asType(d,wjcChart._DataPoint,!0);if(g){var p=d.item,f=d.y;if(d[c]=p.min,d.yfmt=p.min,d.y=p.min,this._plotter._renderLabel(t,m,g,i,l,a,o,r),d[c]=p.firstQuartile,d.yfmt=p.firstQuartile,d.y=p.firstQuartile,this._plotter._renderLabel(t,m,g,i,l,a,o,r),d[c]=p.median,d.yfmt=p.median,d.y=p.median,this._plotter._renderLabel(t,m,g,i,l,a,o,r),d[c]=p.thirdQuartile,d.yfmt=p.thirdQuartile,d.y=p.thirdQuartile,this._plotter._renderLabel(t,m,g,i,l,a,o,r),d[c]=p.max,d.yfmt=p.max,d.y=p.max,this._plotter._renderLabel(t,m,g,i,l,a,o,r),this.showMeanMarker){let e=Number(p.mean.toFixed(2));d[c]=e,d.yfmt=e,d.y=e,this._plotter._renderLabel(t,m,g,i,l,a,o,r)}p.showOutliers&&p.outlierPoints&&p.outlierPoints.forEach(e=>{d[c]=e,d.yfmt=e,d.y=e,this._plotter._renderLabel(t,m,g,i,l,a,o,r)}),d.y=f}}}};export class _BoxPlot{constructor(t,e,i){this._outlierPoints=[],this._innerPoints=[],this._data=t,this._quartileCalculation=e,this._showOutliers=i,this._parse()}get showOutliers(){return this._showOutliers}get min(){return this._min}get max(){return this._max}get mean(){return this._mean}get firstQuartile(){return this._firstQuartile}get thirdQuartile(){return this._thirdQuartile}get median(){return this._median}get outlierPoints(){return this._outlierPoints}get innerPoints(){return this._innerPoints}_parse(){var t=this._data.length,e=this._data,i=0;this._outlierPoints=[],this._innerPoints=[],e.sort((t,e)=>t-e),e.some(t=>null!=t&&(this._min=t,!0)),this._max=null==e[t-1]?0:e[t-1],this._quartileCalculation===QuartileCalculation.InclusiveMedian?(this._firstQuartile=this._quartileInc(e,.25),this._median=this._quartileInc(e,.5),this._thirdQuartile=this._quartileInc(e,.75)):(this._firstQuartile=this._quartileExc(e,.25),this._median=this._quartileExc(e,.5),this._thirdQuartile=this._quartileExc(e,.75)),this._iqr=1.5*Math.abs(this._thirdQuartile-this._firstQuartile);var r=this._firstQuartile-this._iqr,a=this._thirdQuartile+this._iqr;if(this._showOutliers){var s=this._max;this._max=this._min,this._min=s,this._data.forEach(t=>{i+=t,t<r||t>a?this._outlierPoints.push(t):(t<this._min&&(this._min=t),t>this._max&&(this._max=t))})}else i=this._data.reduce((t,e)=>t+e,0);this._innerPoints=this._data.filter(t=>{if(t>this._min&&t<this._max)return!0}),this._mean=i/t}_quartileInc(t,e){var i,r,a,s,n=t.length;return 1===n?t[0]:(i=(n-1)*e+1,r=Math.floor(i),a=t[r-1],s=i-r,a+(t[r]-a)*s)}_quartileExc(t,e){var i,r,a,s,n=t.length;return 1===n?t[0]:2===n?t[Math.round(e)]:(n+1)%4==0?t[(n+1)*e]:(i=(n+1)*e,r=Math.floor(i),a=t[r-1],s=i-r,a+(t[r]-a)*s)}};export var ErrorAmount;!function(t){t[t.FixedValue=0]="FixedValue",t[t.Percentage=1]="Percentage",t[t.StandardDeviation=2]="StandardDeviation",t[t.StandardError=3]="StandardError",t[t.Custom=4]="Custom"}(ErrorAmount||(ErrorAmount={}));export var ErrorBarEndStyle;!function(t){t[t.Cap=0]="Cap",t[t.NoCap=1]="NoCap"}(ErrorBarEndStyle||(ErrorBarEndStyle={}));export var ErrorBarDirection;!function(t){t[t.Both=0]="Both",t[t.Minus=1]="Minus",t[t.Plus=2]="Plus"}(ErrorBarDirection||(ErrorBarDirection={}));export class ErrorBar extends wjcChart.Series{constructor(t){super(),this._errorAmount=ErrorAmount.FixedValue,this._endStyle=ErrorBarEndStyle.Cap,this._direction=ErrorBarDirection.Both,this.rendering.addHandler(this._rendering,this),this.initialize(t)}get value(){return this._value}set value(t){t!=this._value&&(this._value=t,this._invalidate())}get errorAmount(){return this._errorAmount}set errorAmount(t){(t=wjcCore.asEnum(t,ErrorAmount,!0))!=this._errorAmount&&(this._errorAmount=t,this._invalidate())}get errorBarStyle(){return this._errorBarStyle}set errorBarStyle(t){t!=this._errorBarStyle&&(this._errorBarStyle=t,this._invalidate())}get endStyle(){return this._endStyle}set endStyle(t){(t=wjcCore.asEnum(t,ErrorBarEndStyle,!0))!=this._endStyle&&(this._endStyle=t,this._invalidate())}get direction(){return this._direction}set direction(t){(t=wjcCore.asEnum(t,ErrorBarDirection,!0))!=this._direction&&(this._direction=t,this._invalidate())}getDataRect(t,e){if(!t)return null;this._chart;var i,r=this.errorAmount,a=0,s=0;this._paddings=[],this._calculateErrorValue();var n,l,h,o,u=this.getValues(0);if(!u)return t;for(h=0,i=u.length;h<i;h++){var c={plus:0,val:0,minus:0},_=this._value||0;switch(o=u[h],r){case ErrorAmount.Custom:(c=this._getCustomValue(h)).val=o,this._paddings.push(c);break;case ErrorAmount.FixedValue:this._paddings.push({plus:_,minus:_,val:o});break;case ErrorAmount.Percentage:this._paddings.push({plus:o*_,minus:o*_,val:o});break;case ErrorAmount.StandardDeviation:this._paddings.push({plus:this._errorValue*_,minus:this._errorValue*_,val:o});break;case ErrorAmount.StandardError:this._paddings.push({plus:this._errorValue,minus:this._errorValue,val:o})}(isNaN(n)||n>o-c.minus)&&(n=o-c.minus),(isNaN(l)||l<o+c.plus)&&(l=o+c.plus)}switch(r){case ErrorAmount.FixedValue:a=_,s=_;break;case ErrorAmount.Percentage:a=n*_,s=l*_;break;case ErrorAmount.StandardDeviation:a=this._errorValue*_,s=this._errorValue*_;break;case ErrorAmount.StandardError:a=this._errorValue,s=this._errorValue}return this._showPlus&&(l+=s),this._showMinus&&(n-=a),new wjcCore.Rect(t.left,n,t.width,l-n)}_getCustomValue(t){var e,i=this.value,r={minus:0,val:0,plus:0};return null!=this._minusBindingValues||null!=this._plusBindingValues?(r.minus=this._minusBindingValues&&this._minusBindingValues[t]||0,r.plus=this._plusBindingValues&&this._plusBindingValues[t]||0,r):null==i?r:(wjcCore.isArray(i)?((e=i[t])&&e.minus&&(r.minus=e.minus),e&&e.plus&&(r.plus=e.plus)):wjcCore.isNumber(i)?(r.minus=i,r.plus=i):(i.minus&&(r.minus=i.minus),i.plus&&(r.plus=i.plus)),r)}_calculateErrorValue(){var t=0,e=0,i=0;if(this._errorAmount===ErrorAmount.StandardDeviation||this._errorAmount===ErrorAmount.StandardError){var r=this.getValues(0);null!=r&&(r.forEach(i=>{t+=i,e++}),i=t/e,this._mean=i,t=0,r.forEach(e=>{t+=Math.pow(e-i,2)}),this._errorValue=Math.sqrt(t/(e-1))),this._errorAmount==ErrorAmount.StandardError&&(this._errorValue=this._errorValue/Math.sqrt(e))}}_clearValues(){this.__errorValue=null,this._mean=null,this._plusBindingValues=null,this._minusBindingValues=null,super._clearValues()}getValues(t){if(0==t&&this.errorAmount===ErrorAmount.Custom){var e=this._getBinding(1),i=this._getBinding(2);if((null==this._plusBindingValues||null==this._minusBindingValues)&&e&&i)if(null!=this._cv){if(e){r=this._bindValues(this._cv.items,e);this._plusBindingValues=r.values}if(i){a=this._bindValues(this._cv.items,i);this._minusBindingValues=a.values}}else if(null!=this.binding&&null!=this._chart&&null!=this._chart.collectionView){if(e){var r=this._bindValues(this._chart.collectionView.items,e);this._plusBindingValues=r.values}if(i){var a=this._bindValues(this._chart.collectionView.items,i);this._minusBindingValues=a.values}}}return super.getValues(t)}get _chart(){return this.__chart}set _chart(t){t!==this.__chart&&(this.__chart=t)}get _errorValue(){return this.__errorValue}set _errorValue(t){t!=this.__errorValue&&(this.__errorValue=t)}get _showPlus(){return this.direction===ErrorBarDirection.Both||this.direction===ErrorBarDirection.Plus}get _showMinus(){return this.direction===ErrorBarDirection.Both||this.direction===ErrorBarDirection.Minus}_rendering(t,e){this._errorBarEles=[],e.cancel=!0;var i=this.chart,r=i._plotRect,a=this._getAxisY(),s=this._getAxisX(),n=(a.origin,e.engine),l=i.series.indexOf(this),h=this._plotter;h.plotSeries(n,s,a,this,i,e.index,e.count,t=>{var e,o,u,c=this._paddings,_=this._showPlus,m=this._showMinus,d=i._isRotated(),g=this.errorBarStyle&&this.errorBarStyle["stroke-width"]||2;u=(o=d?s:a).actualMax,e=o.convert(u);var p=n.stroke,f=n.strokeWidth;n.stroke="black",n.strokeWidth=1,t&&t.length&&t.forEach((t,i)=>{if(null!=t.x&&null!=t.y){var a=c[i],s=a&&a.minus||0,p=a&&a.plus||0,f=Math.abs(o.convert(u-s)-e),x=Math.abs(o.convert(u+p)-e),y=new wjcCore.Point(t.x,t.y),v=new wjcCore.Point(t.x,t.y);d?(this.errorAmount===ErrorAmount.StandardDeviation&&(t=new wjcCore.Point(o.convert(this._mean),t.y),y.x=t.x,v.x=t.x),m&&(y.x=y.x-f),_&&(v.x=v.x+x)):(this.errorAmount===ErrorAmount.StandardDeviation&&(t=new wjcCore.Point(t.x,o.convert(this._mean)),y.y=t.y,v.y=t.y),m&&(y.y=y.y+f),_&&(v.y=v.y-x));let w;w=d?new wjcCore.Rect(y.x,y.y-g,Math.abs(v.x-y.x),2*g):new wjcCore.Rect(v.x-g,v.y,2*g,Math.abs(v.y-y.y));let M=new wjcChart._RectArea(w);M.ignoreLabel=!0;let S=new wjcChart._DataPoint(l,i,i,a.val);M.tag=S,h.hitTester.add(M,l);let C=[n.drawLine(Math.max(y.x,r.left),Math.min(y.y,r.bottom),Math.min(v.x,r.right),Math.max(v.y,r.top),"error-bar",this.errorBarStyle)];if(this._errorBarEles[i]=C,this.endStyle===ErrorBarEndStyle.Cap){if(_){let t;d?v.x<=r.right&&(t=n.drawLine(v.x,v.y-g,v.x,v.y+g,"error-bar",this.errorBarStyle),C.push(t)):v.y>=r.top&&(t=n.drawLine(v.x-g,v.y,v.x+g,v.y,"error-bar",this.errorBarStyle),C.push(t))}if(m){let t;d?y.x>=r.left&&(t=n.drawLine(y.x,y.y-g,y.x,y.y+g,"error-bar",this.errorBarStyle),C.push(t)):y.y<=r.bottom&&(t=n.drawLine(y.x-g,y.y,y.x+g,y.y,"error-bar",this.errorBarStyle),C.push(t))}}}}),n.stroke=p,n.strokeWidth=f})}getPlotElement(t){if(this.hostElement&&t<this._pointIndexes.length){let i=null==this._errorBarEles[t]?[]:this._errorBarEles[t].slice();var e=this._pointIndexes[t];return e<this.hostElement.childNodes.length&&i.push(this.hostElement.childNodes[e]),i}return null}};