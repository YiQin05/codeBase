/*
    *
    * Wijmo Library 5.20183.550
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
import*as wjcCore from"wijmo/wijmo";import*as wjcChart from"wijmo/wijmo.chart";var __glob="undefined"!=typeof window?window:self;import*as wjcSelfRef from"wijmo/wijmo.chart.finance";var wjcSelf=wjcSelfRef||exports;__glob.wijmo=__glob.wijmo||{},__glob.wijmo.chart=__glob.wijmo.chart||{},__glob.wijmo.chart.finance=wjcSelf;export function _trunc(e){return wjcCore.asNumber(e,!0,!1),e>0?Math.floor(e):Math.ceil(e)};export function _sum(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wjcCore.asArray(e,!1),e.reduce((e,t)=>e+wjcCore.asNumber(t),0)};export function _average(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wjcCore.asArray(e,!1),_sum(e)/e.length};export function _minimum(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wjcCore.asArray(e,!1),Math.min.apply(null,e)};export function _maximum(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wjcCore.asArray(e,!1),Math.max.apply(null,e)};export function _variance(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wjcCore.asArray(e,!1);var t=_average(e);return _average(e.map(e=>Math.pow(e-t,2)))};export function _stdDeviation(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wjcCore.asArray(e,!1),Math.sqrt(_variance(e))};export function _avgTrueRng(e,t,a,i=14){wjcCore.asArray(e,!1),wjcCore.asArray(t,!1),wjcCore.asArray(a,!1),wjcCore.asInt(i,!1,!0);var s=_trueRng(e,t,a,i),r=Math.min(e.length,t.length,a.length,s.length),n=[];wjcCore.assert(r>i&&i>1,"Average True Range period must be an integer less than the length of the data and greater than one.");for(var h=0;h<r;h++)wjcCore.asNumber(e[h],!1),wjcCore.asNumber(t[h],!1),wjcCore.asNumber(a[h],!1),wjcCore.asNumber(s[h],!1),h+1===i?n.push(_average(s.slice(0,i))):h+1>i&&n.push(((i-1)*n[n.length-1]+s[h])/i);return n};export function _trueRng(e,t,a,i=14){wjcCore.asArray(e,!1),wjcCore.asArray(t,!1),wjcCore.asArray(a,!1),wjcCore.asInt(i,!1,!0);var s=Math.min(e.length,t.length,a.length),r=[];wjcCore.assert(s>i&&i>1,"True Range period must be an integer less than the length of the data and greater than one.");for(var n=0;n<s;n++)wjcCore.asNumber(e[n],!1),wjcCore.asNumber(t[n],!1),wjcCore.asNumber(a[n],!1),0===n?r.push(e[n]-t[n]):r.push(Math.max(e[n]-t[n],Math.abs(e[n]-a[n-1]),Math.abs(t[n]-a[n-1])));return r};export function _sma(e,t){wjcCore.asArray(e,!1),wjcCore.asNumber(t,!1,!0),wjcCore.assert(e.length>t&&t>1,"Simple Moving Average period must be an integer less than the length of the data and greater than one.");for(var a=[],i=t;i<=e.length;i++)a.push(_average(e.slice(i-t,i)));return a};export function _ema(e,t){wjcCore.asArray(e,!1),wjcCore.asNumber(t,!1,!0),wjcCore.assert(e.length>t&&t>1,"Exponential Moving Average period must be an integer less than the length of the data and greater than one.");var a=[],i=2/(t+1),s=_sma(e,t);e=e.slice(t-1);for(var r=0;r<e.length;r++)0===r?a.push(s[0]):a.push((e[r]-a[r-1])*i+a[r-1]);return a};export function _range(e,t,a=1){wjcCore.asNumber(e,!1),wjcCore.asNumber(t,!1),wjcCore.asNumber(a,!1),wjcCore.assert(e<t,"begin argument must be less than end argument.");for(var i=[],s=e;s<=t;s+=a)i.push(s);return i};export var FinancialChartType;!function(e){e[e.Column=0]="Column",e[e.Scatter=1]="Scatter",e[e.Line=2]="Line",e[e.LineSymbols=3]="LineSymbols",e[e.Area=4]="Area",e[e.Candlestick=5]="Candlestick",e[e.HighLowOpenClose=6]="HighLowOpenClose",e[e.HeikinAshi=7]="HeikinAshi",e[e.LineBreak=8]="LineBreak",e[e.Renko=9]="Renko",e[e.Kagi=10]="Kagi",e[e.ColumnVolume=11]="ColumnVolume",e[e.EquiVolume=12]="EquiVolume",e[e.CandleVolume=13]="CandleVolume",e[e.ArmsCandleVolume=14]="ArmsCandleVolume",e[e.PointAndFigure=15]="PointAndFigure"}(FinancialChartType||(FinancialChartType={}));export class FinancialChart extends wjcChart.FlexChartCore{constructor(e,t){super(e,null),this._chartType=FinancialChartType.Line,this.__heikinAshiPlotter=null,this.__lineBreakPlotter=null,this.__renkoPlotter=null,this.__kagiPlotter=null,this.__pfPlotter=null,this.initialize(t)}_getProductInfo(){return"A78U,FinancialChart"}get chartType(){return this._chartType}set chartType(e){(e=wjcCore.asEnum(e,FinancialChartType))!=this._chartType&&(this._chartType=e,this.invalidate())}get options(){return this._options}set options(e){e!=this._options&&(this._options=e,this.invalidate())}get _heikinAshiPlotter(){return null===this.__heikinAshiPlotter&&(this.__heikinAshiPlotter=new _HeikinAshiPlotter,this._initPlotter(this.__heikinAshiPlotter)),this.__heikinAshiPlotter}get _lineBreakPlotter(){return null===this.__lineBreakPlotter&&(this.__lineBreakPlotter=new _LineBreakPlotter,this._initPlotter(this.__lineBreakPlotter)),this.__lineBreakPlotter}get _renkoPlotter(){return null===this.__renkoPlotter&&(this.__renkoPlotter=new _RenkoPlotter,this._initPlotter(this.__renkoPlotter)),this.__renkoPlotter}get _kagiPlotter(){return null===this.__kagiPlotter&&(this.__kagiPlotter=new _KagiPlotter,this._initPlotter(this.__kagiPlotter)),this.__kagiPlotter}get _pfPlotter(){return null===this.__pfPlotter&&(this.__pfPlotter=new _PointAndFigurePlotter,this._initPlotter(this.__pfPlotter)),this.__pfPlotter}_getChartType(){var e=null;switch(this.chartType){case FinancialChartType.Area:e=wjcChart.ChartType.Area;break;case FinancialChartType.Line:case FinancialChartType.Kagi:case FinancialChartType.PointAndFigure:e=wjcChart.ChartType.Line;break;case FinancialChartType.Column:case FinancialChartType.ColumnVolume:e=wjcChart.ChartType.Column;break;case FinancialChartType.LineSymbols:e=wjcChart.ChartType.LineSymbols;break;case FinancialChartType.Scatter:e=wjcChart.ChartType.Scatter;break;case FinancialChartType.Candlestick:case FinancialChartType.Renko:case FinancialChartType.HeikinAshi:case FinancialChartType.LineBreak:case FinancialChartType.EquiVolume:case FinancialChartType.CandleVolume:case FinancialChartType.ArmsCandleVolume:e=wjcChart.ChartType.Candlestick;break;case FinancialChartType.HighLowOpenClose:e=wjcChart.ChartType.HighLowOpenClose}return e}_getPlotter(e){var t=this.chartType,a=null;if(e){var i=e.chartType;i&&!wjcCore.isUndefined(i)&&i!=t&&(t=i,!0)}switch(t){case FinancialChartType.HeikinAshi:a=this._heikinAshiPlotter;break;case FinancialChartType.LineBreak:a=this._lineBreakPlotter;break;case FinancialChartType.Renko:a=this._renkoPlotter;break;case FinancialChartType.Kagi:a=this._kagiPlotter;break;case FinancialChartType.ColumnVolume:(a=super._getPlotter(e)).isVolume=!0,a.width=1;break;case FinancialChartType.EquiVolume:(a=super._getPlotter(e)).isEqui=!0,a.isCandle=!1,a.isArms=!1,a.isVolume=!0,a.symbolWidth="100%";break;case FinancialChartType.CandleVolume:(a=super._getPlotter(e)).isEqui=!1,a.isCandle=!0,a.isArms=!1,a.isVolume=!0,a.symbolWidth="100%";break;case FinancialChartType.ArmsCandleVolume:(a=super._getPlotter(e)).isEqui=!1,a.isCandle=!1,a.isArms=!0,a.isVolume=!0,a.symbolWidth="100%";break;case FinancialChartType.PointAndFigure:a=this._pfPlotter;break;default:a=super._getPlotter(e)}return a}_createSeries(){return new FinancialSeries}};export class FinancialSeries extends wjcChart.SeriesBase{get chartType(){return this._finChartType}set chartType(e){(e=wjcCore.asEnum(e,FinancialChartType,!0))!=this._finChartType&&(this._finChartType=e,this._invalidate())}_getChartType(){var e=null;switch(this.chartType){case FinancialChartType.Area:e=wjcChart.ChartType.Area;break;case FinancialChartType.Line:case FinancialChartType.Kagi:case FinancialChartType.PointAndFigure:e=wjcChart.ChartType.Line;break;case FinancialChartType.Column:case FinancialChartType.ColumnVolume:e=wjcChart.ChartType.Column;break;case FinancialChartType.LineSymbols:e=wjcChart.ChartType.LineSymbols;break;case FinancialChartType.Scatter:e=wjcChart.ChartType.Scatter;break;case FinancialChartType.Candlestick:case FinancialChartType.Renko:case FinancialChartType.HeikinAshi:case FinancialChartType.LineBreak:case FinancialChartType.EquiVolume:case FinancialChartType.CandleVolume:case FinancialChartType.ArmsCandleVolume:e=wjcChart.ChartType.Candlestick;break;case FinancialChartType.HighLowOpenClose:e=wjcChart.ChartType.HighLowOpenClose}return e}getDataRect(e,t){if(t)return t;var a=this.getValues(0),i=this.getValues(1)||(this.chart._xvals&&this.chart._xvals.length?this.chart._xvals:null),s=this._getBinding(0),r=this._getBinding(1),n=this._getBinding(2),h=this._getBinding(3);this._plotter;let l=this._getChartType()||this.chart._getChartType();if(l!==wjcChart.ChartType.HighLowOpenClose&&l!==wjcChart.ChartType.Candlestick||s===r)return null;if(a){for(var o=NaN,c=NaN,u=NaN,g=NaN,_=a.length,d=0;d<_;d++){var p=this._getItem(d),w=a[d];if(isFinite(w)&&[w,r?p[r]:null,n?p[n]:null,h?p[h]:null].forEach(e=>{wjcChart._DataInfo.isValid(e)&&null!==e&&((isNaN(c)||e<c)&&(c=e),(isNaN(g)||e>g)&&(g=e))}),i){var C=i[d];isFinite(C)&&(isNaN(o)?o=u=C:C<o?o=C:w>g&&(u=C))}}if(i||(o=0,u=_-1),!isNaN(c))return new wjcCore.Rect(o,c,u-o,g-c)}return null}};export class _BaseCalculator{constructor(e,t,a,i){this.highs=e,this.lows=t,this.opens=a,this.closes=i}calculate(){}};export class _HeikinAshiCalculator extends _BaseCalculator{constructor(e,t,a,i){super(e,t,a,i)}calculate(){var e,t,a,i,s=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),r=[];if(s<=0)return r;for(var n=0;n<s;n++)i=_average(this.highs[n],this.lows[n],this.opens[n],this.closes[n]),0===n?(a=_average(this.opens[n],this.closes[n]),e=this.highs[n],t=this.lows[n]):(a=_average(r[n-1].open,r[n-1].close),e=Math.max(this.highs[n],a,i),t=Math.min(this.lows[n],a,i)),r.push({high:e,low:t,close:i,open:a,pointIndex:n,x:null});return r}};export class _BaseRangeCalculator extends _BaseCalculator{constructor(e,t,a,i,s,r,n,h){super(e,t,a,i),this.xs=s,this.size=r,this.unit=n,this.fields=h}_getValues(){var e,t=[],a=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length);switch(this.fields){case DataFields.High:t=this.highs;break;case DataFields.Low:t=this.lows;break;case DataFields.Open:t=this.opens;break;case DataFields.HL2:for(e=0;e<a;e++)t.push(_average(this.highs[e],this.lows[e]));break;case DataFields.HLC3:for(e=0;e<a;e++)t.push(_average(this.highs[e],this.lows[e],this.closes[e]));break;case DataFields.HLOC4:for(e=0;e<a;e++)t.push(_average(this.highs[e],this.lows[e],this.opens[e],this.closes[e]));break;case DataFields.Close:default:t=this.closes}return t}_getSize(){var e=this.unit===RangeMode.ATR?_avgTrueRng(this.highs,this.lows,this.closes,this.size):null;return this.unit===RangeMode.ATR?e[e.length-1]:this.size}};export class _LineBreakCalculator extends _BaseRangeCalculator{constructor(e,t,a,i,s,r){super(e,t,a,i,s,r)}calculate(){var e=null!==this.xs&&this.xs.length>0,t=this.closes.length,a=[],i=[[],[]];if(t<=0)return a;for(var s,r,n,h,l,o,c,u=[],g=1;g<t;g++){if(h=a.length,l=h-1,r=e?this.xs[g]:g,n=this.closes[g],-1===l){if((s=this.closes[0])===n)continue}else if(u=this._trendExists(i)||1===this.size?i[0].slice(-this.size).concat(i[1].slice(-this.size)):i[0].slice(1-this.size).concat(i[1].slice(1-this.size)),o=Math.max.apply(null,u),c=Math.min.apply(null,u),n>o)s=Math.max(i[0][l],i[1][l]);else{if(!(n<c))continue;s=Math.min(i[0][l],i[1][l])}i[0].push(s),i[1].push(n),a.push({high:Math.max(s,n),low:Math.min(s,n),open:s,close:n,x:r,pointIndex:g})}return a}_trendExists(e){if(e[1].length<this.size)return!1;var t,a=!1,i=e[1].slice(-this.size);for(t=1;t<this.size&&(a=i[t]>i[t-1]);t++);if(!a)for(t=1;t<this.size&&(a=i[t]<i[t-1]);t++);return a}};export class _KagiCalculator extends _BaseRangeCalculator{constructor(e,t,a,i,s,r,n,h){super(e,t,a,i,s,r,n,h)}calculate(){var e=this._getSize(),t=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),a=this._getValues(),i=null!==this.xs&&this.xs.length>0,s=[],r=[[],[]];if(t<=0)return s;for(var n,h,l,o,c,u,g,_,d,p,w=1;w<t;w++){if(o=s.length,c=o-1,h=i?this.xs[w]:w,p=w,d=!1,this.fields===DataFields.HighLow)if(-1===c)if(this.highs[w]>this.highs[0])l=this.highs[w];else{if(!(this.lows[w]<this.lows[0]))continue;l=this.lows[w]}else if((_=r[1][c]-r[0][c])>0)if(this.highs[w]>r[1][c])l=this.highs[w];else{if(!(this.lows[w]<r[1][c]))continue;l=this.lows[w]}else if(this.lows[w]<r[1][c])l=this.lows[w];else{if(!(this.highs[w]>r[1][c]))continue;l=this.highs[w]}else l=a[w];if(this.unit===RangeMode.Percentage&&(e=l*this.size),-1===c){if(h=i?this.xs[0]:0,p=0,n=this.fields===DataFields.HighLow?null==this.highs[0]?this.highs[this.highs.length-1]:this.highs[0]:null==a[0]?a[a.length-1]:a[0],(_=Math.abs(n-l)||0)<e)continue}else if(_=r[1][c]-r[0][c],g=Math.max(r[0][c],r[1][c]),u=Math.min(r[0][c],r[1][c]),_>0)if(l>g)d=!0;else{if(!((_=g-l)>=e))continue;n=g}else if(l<u)d=!0;else{if(!((_=l-u)>=e))continue;n=u}d?(r[1][c]=l,s[c].close=l,s[c].high=Math.max(s[c].open,s[c].close),s[c].low=Math.min(s[c].open,s[c].close)):(r[0].push(n),r[1].push(l),s.push({high:Math.max(n,l),low:Math.min(n,l),open:n,close:l,x:h,pointIndex:p}))}return s}};export class _RenkoCalculator extends _BaseRangeCalculator{constructor(e,t,a,i,s,r,n,h,l=!1){super(e,t,a,i,s,r,n,h),this.rounding=l}calculate(){var e=this._getSize(),t=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),a=null!==this.xs&&this.xs.length>0,i=this._getValues(),s=[],r=[[],[]];if(t<=0)return s;for(var n,h,l,o,c,u,g,_,d=1;d<t;d++){if(o=s.length,c=o-1,h=a?this.xs[d]:d,this.fields===DataFields.HighLow)if(-1===c)if(this.highs[d]-this.highs[0]>e)n=this.highs[0],l=this.highs[d];else{if(!(this.lows[0]-this.lows[d]>e))continue;n=this.lows[0],l=this.lows[d]}else if(u=Math.min(r[0][c],r[1][c]),g=Math.max(r[0][c],r[1][c]),this.highs[d]-g>e)n=g,l=this.highs[d];else{if(!(u-this.lows[d]>e))continue;n=u,l=this.lows[d]}else if(l=i[d],-1===c)n=i[0];else if(u=Math.min(r[0][c],r[1][c]),g=Math.max(r[0][c],r[1][c]),l>g)n=g;else{if(!(l<u))continue;n=u}if(_=l-n,!(Math.abs(_)<e)){_=_trunc(_/e);for(var p=0;p<Math.abs(_);p++){var w={};this.rounding&&(n=this._round(n,e)),r[0].push(n),w.open=n,n=_>0?n+e:n-e,r[1].push(n),w.close=n,w.x=h,w.pointIndex=d,w.high=Math.max(w.open,w.close),w.low=Math.min(w.open,w.close),s.push(w)}}}return s}_round(e,t){return Math.round(e/t)*t}};export class _HeikinAshiPlotter extends wjcChart._FinancePlotter{constructor(){super(),this._symFactor=.7,this.clear()}clear(){super.clear(),this._haValues=null,this._calculator=null}plotSeries(e,t,a,i,s,r,n){this._calculate(i);var h=wjcCore.asType(i,wjcChart.SeriesBase),l=this.chart.series.indexOf(i),o=i.getValues(1),c=this._symFactor,u=this._haValues.length,g=!0;if(o){var _=this.dataInfo.getDeltaX();_>0&&(c*=_)}else o=this.dataInfo.getXVals();o?u=Math.min(u,o.length):(g=!1,o=new Array(u));var d=this._DEFAULT_WIDTH,p=h._getSymbolFill(l),w=h._getAltSymbolFill(l)||"transparent",C=h._getSymbolStroke(l),m=h._getAltSymbolStroke(l)||C,f=c,x=i.getDataType(1)||i.chart._xDataType;e.strokeWidth=d;for(var y,v,j,b,k,F,T,V,P=t.actualMin,A=t.actualMax,M=0,L=0;L<u;L++)if(j=g?o[L]:L,wjcChart._DataInfo.isValid(j)&&P<=j&&j<=A){if(k=this._haValues[L].high,F=this._haValues[L].low,T=this._haValues[L].open,V=this._haValues[L].close,y=T<V?w:p,v=T<V?m:C,e.fill=y,e.stroke=v,e.startGroup(),b=this._getDataPoint(l,L,j,i),this.chart.itemFormatter){var S=new wjcChart.HitTestInfo(this.chart,new wjcCore.Point(t.convert(j),a.convert(k)),wjcChart.ChartElement.SeriesSymbol);S._setData(h,L),S._setDataPoint(b),this.chart.itemFormatter(e,S,()=>{this._drawSymbol(e,t,a,l,L,y,f,j,k,F,T,V,b,x)})}else this._drawSymbol(e,t,a,l,L,y,f,j,k,F,T,V,b,x);e.endGroup(),i._setPointIndex(L,M),M++}}_drawSymbol(e,t,a,i,s,r,n,h,l,o,c,u,g,_){var d,p=null,w=null,C=null,m=null,f=_===wjcCore.DataType.Date?432e5:.5;if(C=t.convert(h-f*n),m=t.convert(h+f*n),C>m){var x=C;C=m,m=x}h=t.convert(h),wjcChart._DataInfo.isValid(c)&&wjcChart._DataInfo.isValid(u)&&(c=a.convert(c),u=a.convert(u),w=(p=Math.min(c,u))+Math.abs(c-u),e.drawRect(C,p,m-C,w-p),(d=new wjcChart._RectArea(new wjcCore.Rect(C,p,m-C,w-p))).tag=g,this.hitTester.add(d,i)),wjcChart._DataInfo.isValid(l)&&(l=a.convert(l),null!==p&&(e.drawLine(h,p,h,l),d.rect.top=l,d.rect.height=d.rect.height+l)),wjcChart._DataInfo.isValid(o)&&(o=a.convert(o),null!==w&&(e.drawLine(h,w,h,o),d.rect.height=d.rect.height+o))}_getDataPoint(e,t,a,i){var s=new wjcChart._DataPoint(e,t,a,this._haValues[t].high),r=i._getItem(t),n=i._getBinding(0),h=i._getBinding(1),l=i._getBinding(2),o=i._getBinding(3),c=i._getAxisY();return null!=r&&(s.item=wjcChart._BasePlotter.cloneStyle(r,[]),s.item[n]=this._haValues[t].high,s.item[h]=this._haValues[t].low,s.item[l]=this._haValues[t].open,s.item[o]=this._haValues[t].close),s.y=this._haValues[t].high,s.yfmt=c._formatValue(this._haValues[t].high),s}_calculate(e){var t=e._getBindingValues(0),a=e._getBindingValues(1),i=e._getBindingValues(2),s=e._getBindingValues(3);this._calculator=new _HeikinAshiCalculator(t,a,i,s),this._haValues=this._calculator.calculate(),(null===this._haValues||wjcCore.isUndefined(this._haValues))&&this._init()}_init(){this._haValues=[]}};export class _BaseRangePlotter extends wjcChart._BasePlotter{constructor(){super(),this._symFactor=.7,this.clear()}clear(){super.clear(),this._rangeValues=null,this._rangeXLabels=null,this._calculator=null}unload(){super.unload();for(var e,t,a=0;a<this.chart.series.length;a++)(e=this.chart.series[a])&&(t=e._getAxisX())&&t.itemsSource&&(t.itemsSource=null)}adjustLimits(e,t){var a,i,s,r=0,n=0,h=0,l=0,o=this.chart._xDataType===wjcCore.DataType.Date?.5:0;wjcCore.assert(this.chart.series.length<=1,"Current FinancialChartType only supports a single series");for(var c=0;c<this.chart.series.length;c++)a=this.chart.series[c],this._calculate(a),this._rangeValues.length<=0||this._rangeXLabels.length<=0||((i=this._rangeValues.map(e=>e.open)).push.apply(i,this._rangeValues.map(e=>e.close)),s=this._rangeXLabels.map(e=>e.value),h=Math.min.apply(null,i),l=Math.max.apply(null,i),r=Math.min.apply(null,s),n=Math.max.apply(null,s),a._getAxisX().itemsSource=this._rangeXLabels);return r-=o,new wjcCore.Rect(r,h,n-r+o,l-h)}plotSeries(e,t,a,i,s,r,n){this._calculate(i);var h=this.chart.series.indexOf(i),l=this._rangeValues.length,o=t.actualMin,c=t.actualMax,u=this._DEFAULT_WIDTH,g=this._symFactor,_=i._getSymbolFill(h),d=i._getAltSymbolFill(h)||"transparent",p=i._getSymbolStroke(h),w=i._getAltSymbolStroke(h)||p;e.strokeWidth=u;for(var C,m,f,x,y=0,v=0;v<l;v++)if(C=v,wjcChart._DataInfo.isValid(C)&&o<=C&&C<=c){if(m=this._rangeValues[v].open,f=this._rangeValues[v].close,e.fill=m>f?_:d,e.stroke=m>f?p:w,x=this._getDataPoint(h,v,i,Math.max(m,f)),e.startGroup(),this.chart.itemFormatter){var j=new wjcChart.HitTestInfo(this.chart,new wjcCore.Point(t.convert(C),a.convert(f)),wjcChart.ChartElement.SeriesSymbol);j._setData(i,v),j._setDataPoint(x),this.chart.itemFormatter(e,j,()=>{this._drawSymbol(e,t,a,h,y,g,C,m,f,x)})}else this._drawSymbol(e,t,a,h,y,g,C,m,f,x);e.endGroup(),i._setPointIndex(v,y),y++}}_drawSymbol(e,t,a,i,s,r,n,h,l,o){var c,u,g,_,d;if(g=t.convert(n-.5*r),_=t.convert(n+.5*r),g>_){var p=g;g=_,_=p}wjcChart._DataInfo.isValid(h)&&wjcChart._DataInfo.isValid(l)&&(h=a.convert(h),l=a.convert(l),u=(c=Math.min(h,l))+Math.abs(h-l),e.drawRect(g,c,_-g,u-c),(d=new wjcChart._RectArea(new wjcCore.Rect(g,c,_-g,u-c))).tag=o,this.hitTester.add(d,i))}_getDataPoint(e,t,a,i){var s=t,r=new wjcChart._DataPoint(e,t,s,i),n=a._getItem(this._rangeValues[t].pointIndex),h=a.bindingX||this.chart.bindingX,l=a._getBinding(0),o=a._getBinding(1),c=a._getBinding(2),u=a._getBinding(3),g=a._getAxisY();return r.item=wjcChart._BasePlotter.cloneStyle(n,[]),r.item[l]=this._rangeValues[t].high,r.item[o]=this._rangeValues[t].low,r.item[c]=this._rangeValues[t].open,r.item[u]=this._rangeValues[t].close,r.y=this._rangeValues[t].close,r.yfmt=g._formatValue(this._rangeValues[t].close),r.x=r.item[h],r.xfmt=this._rangeXLabels[t]._text,r}_init(){this._rangeValues=[],this._rangeXLabels=[]}_calculate(e){}_generateXLabels(e){var t,a=e._getAxisX(),i=e.getDataType(1)||this.chart._xDataType;this._rangeValues.forEach((e,s)=>{var r=e.x;t=i===wjcCore.DataType.Date?wjcCore.Globalize.format(wjcChart.FlexChart._fromOADate(r),a.format||"d"):i===wjcCore.DataType.Number?a._formatValue(r):null!==i&&i!==wjcCore.DataType.String||!this.chart._xlabels?r.toString():this.chart._xlabels[r],this._rangeXLabels.push({value:s,text:t,_text:t})},this)}};export var DataFields;!function(e){e[e.Close=0]="Close",e[e.High=1]="High",e[e.Low=2]="Low",e[e.Open=3]="Open",e[e.HighLow=4]="HighLow",e[e.HL2=5]="HL2",e[e.HLC3=6]="HLC3",e[e.HLOC4=7]="HLOC4"}(DataFields||(DataFields={}));export var RangeMode;!function(e){e[e.Fixed=0]="Fixed",e[e.ATR=1]="ATR",e[e.Percentage=2]="Percentage"}(RangeMode||(RangeMode={}));export class _LineBreakPlotter extends _BaseRangePlotter{constructor(){super()}clear(){super.clear(),this._newLineBreaks=null}_calculate(e){this._init();var t=e._getBindingValues(3),a=e.getValues(1)||this.chart._xvals;this._calculator=new _LineBreakCalculator(null,null,null,t,a,this._newLineBreaks),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||wjcCore.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(e)}_init(){super._init(),this._newLineBreaks=wjcCore.asInt(this.getNumOption("newLineBreaks","lineBreak"),!0,!0)||3,wjcCore.assert(this._newLineBreaks>=1,"Value must be greater than 1")}};export class _RenkoPlotter extends _BaseRangePlotter{constructor(){super()}clear(){super.clear(),this._boxSize=null,this._rangeMode=null}_calculate(e){this._init();var t=e._getBindingValues(0),a=e._getBindingValues(1),i=e._getBindingValues(2),s=e._getBindingValues(3),r=e.getValues(1)||this.chart._xvals;this._calculator=new _RenkoCalculator(t,a,i,s,r,this._boxSize,this._rangeMode,this._fields,this._rounding),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||wjcCore.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(e)}_init(){super._init(),this._boxSize=this.getNumOption("boxSize","renko")||14,this._rangeMode=this.getOption("rangeMode","renko")||RangeMode.Fixed,this._rangeMode=wjcCore.asEnum(this._rangeMode,RangeMode,!0),wjcCore.assert(this._rangeMode!==RangeMode.Percentage,"RangeMode.Percentage is not supported"),this._fields=this.getOption("fields","renko")||DataFields.Close,this._fields=wjcCore.asEnum(this._fields,DataFields,!0),wjcCore.assert(this._fields!==DataFields.HighLow,"DataFields.HighLow is not supported"),this._rounding=wjcCore.asBoolean(this.getOption("rounding","renko"),!0)}_generateXLabels(e){super._generateXLabels(e),this._rangeXLabels.forEach((e,t)=>{t>0&&this._rangeXLabels[t-1]._text===e.text&&(e.text="")},this)}};export class _KagiPlotter extends _BaseRangePlotter{constructor(){super()}_calculate(e){this._init();var t=e._getBindingValues(0),a=e._getBindingValues(1),i=e._getBindingValues(2),s=e._getBindingValues(3),r=e.getValues(1)||this.chart._xvals;this._calculator=new _KagiCalculator(t,a,i,s,r,this._reversalAmount,this._rangeMode,this._fields),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||wjcCore.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(e)}plotSeries(e,t,a,i,s,r,n){this._calculate(i);var h=this.chart.series.indexOf(i),l=this._rangeValues.length,o=t.actualMin,c=t.actualMax,u=this._DEFAULT_WIDTH,g=i._getSymbolStroke(h),_=i._getAltSymbolStroke(h)||g,d=[],p=[];e.stroke=g,e.strokeWidth=u;var w,C,m,f,x,y,v,j=0;e.startGroup();for(var b=0;b<l;b++)w=b,wjcChart._DataInfo.isValid(w)&&o<=w&&w<=c&&(C=this._rangeValues[b].open,m=this._rangeValues[b].close,0===b?(f=Math.min(C,m),x=Math.max(C,m),e.strokeWidth=C>m?u:2*u,e.stroke=C>m?g:_,e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(m)),e.drawLine(t.convert(w-1)-e.strokeWidth/2,a.convert(C),t.convert(w)+e.strokeWidth/2,a.convert(C))):e.strokeWidth===u?m>C?(m>x?(e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(x)),e.strokeWidth=2*u,e.stroke=_,e.drawLine(t.convert(w),a.convert(x),t.convert(w),a.convert(m)),f=C):e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(m)),x=m):e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(m)):e.strokeWidth/2===u&&(m<C?(m<f?(e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(f)),e.strokeWidth=u,e.stroke=g,e.drawLine(t.convert(w),a.convert(f),t.convert(w),a.convert(m)),x=C):e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(m)),f=m):e.drawLine(t.convert(w),a.convert(C),t.convert(w),a.convert(m))),b<l-1&&e.drawLine(t.convert(w)-e.strokeWidth/2,a.convert(m),t.convert(w+1)+e.strokeWidth/2,a.convert(m)),v=this._getDataPoint(h,b,i,m),(y=new wjcChart._CircleArea(new wjcCore.Point(t.convert(w),a.convert(m)),.5*e.strokeWidth)).tag=v,this.hitTester.add(y,h),i._setPointIndex(b,j),j++,d.push(t.convert(w)),p.push(a.convert(C)),d.push(t.convert(w)),p.push(a.convert(m)));e.endGroup(),this.hitTester.add(new wjcChart._LinesArea(d,p),h)}_init(){super._init(),this._reversalAmount=this.getNumOption("reversalAmount","kagi")||14,this._rangeMode=this.getOption("rangeMode","kagi")||RangeMode.Fixed,this._rangeMode=wjcCore.asEnum(this._rangeMode,RangeMode,!0),this._fields=this.getOption("fields","kagi")||DataFields.Close,this._fields=wjcCore.asEnum(this._fields,DataFields,!0)}clear(){super.clear(),this._reversalAmount=null,this._rangeMode=null}};export var PointAndFigureScaling;!function(e){e[e.Traditional=0]="Traditional",e[e.Fixed=1]="Fixed",e[e.Dynamic=2]="Dynamic"}(PointAndFigureScaling||(PointAndFigureScaling={}));export class _PointAndFigurePlotter extends wjcChart._BasePlotter{constructor(){super()}clear(){super.clear(),this._boxSize=null,this._fields=null,this._reversal=null,this._scaling=null}unload(){super.unload()}_init(){this._boxSize=this.getNumOption("boxSize","pointAndFigure")||1,this._reversal=this.getNumOption("reversal","pointAndFigure")||3,this._period=this.getNumOption("period","pointAndFigure")||20,this._fields=this.getOption("fields","pointAndFigure")||DataFields.Close,this._fields=wjcCore.asEnum(this._fields,DataFields,!0),wjcCore.assert(this._fields==DataFields.Close||this._fields==DataFields.HighLow,"Only DataFields.Close and DataFields.HighLow are supported"),this._scaling=this.getOption("scaling","pointAndFigure")||PointAndFigureScaling.Traditional,this._scaling=wjcCore.asEnum(this._scaling,PointAndFigureScaling,!0),this._xlbls=[]}adjustLimits(e,t){this._init(),this.hitTester.clear();let a=new wjcCore.Rect(0,0,0,0),i=this.chart.series.length;if(wjcCore.assert(i<=1,"Current FinancialChartType only supports a single series"),i>0){let e=this.chart.series[0],t=this._reversal,i=e.collectionView?e.collectionView:this.chart.collectionView,o=i?i.items:null;if(o&&o.length>0){let i=e._getBinding(0),c=e._getBinding(1),u=e._getBinding(2),g=e._getBinding(3);this._fields==DataFields.Close&&(g?i=g:u&&(i=u),c=i);let _=e.bindingX?e.bindingX:this.chart.bindingX,d=this._actualBoxSize=this.calcBoxSize(o,i,c);if(this._pfdata=this.calcPFHiLo2(o,i,c,_,d,t),this._pfdata&&this._pfdata.length>0){var s=this._pfdata.reduce(function(e,t){return Math.max(e,t.max)},this._pfdata[0].max),r=this._pfdata.reduce(function(e,t){return Math.min(e,t.min)},this._pfdata[0].min);a=new wjcCore.Rect(-.5,r-.5*d,this._pfdata.length,s-r+d);for(var n=1;n<this._pfdata.length;n++){var h=this._pfdata[n-1],l=this._pfdata[n];wjcCore.isDate(l.date)&&wjcCore.isDate(h.date)&&l.date.getYear()!=h.date.getYear()&&this._xlbls.push({value:n,text:wjcCore.Globalize.formatNumber(l.date.getFullYear()%100,"d2")})}}}}return 0==this._xlbls.length&&this._xlbls.push({value:0}),this.chart.axisX._beginUpdate(),this.chart.axisY._beginUpdate(),this.axisYMajorGrid=this.chart.axisY.majorGrid,this.axisXItemsSource=this.chart.axisX.itemsSource,this.chart.axisY.majorGrid=!1,this.chart.axisX.itemsSource=this._xlbls,a}plotSeries(e,t,a,i,s,r,n){if(this._pfdata&&this._pfdata.length>0){var h=this._actualBoxSize;this.renderGrid(e,this._pfdata,h),this.renderData(this.chart,e,this._pfdata,h)}this.chart.axisY.majorGrid=this.axisYMajorGrid,this.chart.axisX.itemsSource=this.axisXItemsSource,this.chart.axisX._cancelUpdate(),this.chart.axisY._cancelUpdate()}calcBoxSize(e,t,a){var i=e.reduce(function(e,a){return Math.max(e,a[t])},e[0][t]),s=e.reduce(function(e,t){return Math.min(e,t[a])},e[0][a]),r=this._boxSize,n=i-s;switch(this._scaling){case PointAndFigureScaling.Traditional:n<.25?r=.0625:n>=.25&&n<1?r=.125:n>=1&&n<5?r=.25:n>=5&&n<20?r=.5:n>=20&&n<100?r=1:n>=100&&n<200?r=2:n>=200&&n<500?r=4:n>=500&&n<1e3?r=5:n>=1e3&&n<25e3?r=50:n>-25e3&&(r=500);break;case PointAndFigureScaling.Dynamic:let e=this.chart.series[0],t=e._getBindingValues(0),a=e._getBindingValues(1);e._getBindingValues(2);var h=_avgTrueRng(t,a,e._getBindingValues(3),this._period);r=h[h.length-1];break;case PointAndFigureScaling.Fixed:}return r}calcPFHiLo2(e,t,a,i,s,r){let n=[];for(let c=0;c<e.length;c++){let u=e[c][t],g=e[c][a];wjcCore.assert(u>=g,"'High' value must be larger than 'low' value.");let _=e[c][i];if(0==n.length)n.push({min:this.roundDown(g,s),max:this.roundDown(u,s),rise:!1,date:_});else{var h=n[n.length-1];if(h.rise){var l=h.max+s,o=h.max-r*s;this.roundUp(u,s)>=l?h.max=this.roundUp(u,s):g<=o&&n.push({min:this.roundDown(g,s),max:h.max-s,rise:!1,date:_})}else{var l=h.min-s,o=h.min+r*s;this.roundDown(g,s)<=l?h.min=this.roundDown(g,s):u>=o&&n.push({min:h.min+s,max:this.roundUp(u,s),rise:!0,date:_})}}}if(n.length>0){var c=n[0];c.min==c.max&&n.splice(0,1)}return n}roundUp(e,t){return Math.ceil(e/t-.999999)*t}roundDown(e,t){return Math.floor(e/t+.999999)*t}renderGrid(e,t,a){if(this._pfdata){for(var i=this._pfdata.reduce(function(e,t){return Math.max(e,t.max)},this._pfdata[0].max),s=this._pfdata.reduce(function(e,t){return Math.min(e,t.min)},this._pfdata[0].min),r=this.chart,n=this._pfdata.length,h=s-.5*a;h<=i+a;h+=a){o=new wjcCore.Point(-.5,h);o=r.dataToPoint(o);c=new wjcCore.Point(n,h);c=r.dataToPoint(c),e.stroke=wjcChart.FlexChart._FG,e.strokeWidth=1,e.drawLine(o.x,o.y,c.x,c.y,wjcChart.FlexChart._CSS_GRIDLINE)}for(var l=-.5;l<=n;l+=1){var o=new wjcCore.Point(l,this.chart.axisY.actualMin);o=r.dataToPoint(o);var c=new wjcCore.Point(l,this.chart.axisY.actualMax);c=r.dataToPoint(c),e.stroke=wjcChart.FlexChart._FG,e.strokeWidth=1,e.drawLine(o.x,o.y,c.x,c.y,wjcChart.FlexChart._CSS_GRIDLINE)}}}renderData(e,t,a,i){let s=e.series[0],r=s._getSymbolStroke(0),n=s._getAltSymbolStroke(0)||r;for(let s=0;s<a.length;s++){let l=a[s],o=(a[s].max-a[s].min)/i;if(0==o)continue;let c=new wjcCore.Point(s-.5,l.min);c=e.dataToPoint(c);let u=new wjcCore.Point(s+.5,l.max);u=e.dataToPoint(u),t.fill="transparent";let g=(u.y-c.y)/o;for(var h=0;h<o+1;h++)if(t.strokeWidth=1.5,l.rise?(t.stroke=r,t.drawLine(c.x,c.y+(h-.5)*g,u.x,c.y+(h+.5)*g),t.drawLine(u.x,c.y+(h-.5)*g,c.x,c.y+(h+.5)*g)):(t.stroke=n,t.drawEllipse(.5*(c.x+u.x),c.y+h*g,.5*Math.abs(c.x-u.x),.5*Math.abs(g))),this.hitTester){let e=l.min+h*i,t=new wjcChart._DataPoint(0,s,l.date,e);t.y=e,t.yfmt=this.chart.axisY._formatValue(e),wjcCore.isDate(l.date)&&(t.x=l.date,t.xfmt=wjcCore.Globalize.formatDate(l.date,"d"));let a=new wjcCore.Rect(Math.min(c.x,u.x),c.y+h*g-.5*g,Math.abs(u.x-c.x),g);a.height<0&&(a.top+=g,a.height=-a.height);let r=new wjcChart._RectArea(a);r.tag=t,this.hitTester.add(r,0)}}}};