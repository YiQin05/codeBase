/*
    *
    * Wijmo Library 5.20183.550
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","wijmo/wijmo.grid","wijmo/wijmo","wijmo/wijmo.input","wijmo/wijmo.grid.filter"],function(t,e,i,n,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a="undefined"!=typeof window?window:self,o=l||e;a.wijmo=a.wijmo||{},a.wijmo.grid=a.wijmo.grid||{},a.wijmo.grid.filter=o;var s=function(){function t(t){this._maxValues=250,this._sortValues=!0,this._col=t,this._bnd=t.binding?new n.Binding(t.binding):null}return Object.defineProperty(t.prototype,"showValues",{get:function(){return this._values},set:function(t){this._values=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterText",{get:function(){return this._filterText},set:function(t){this._filterText=n.asString(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxValues",{get:function(){return this._maxValues},set:function(t){this._maxValues=n.asNumber(t,!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uniqueValues",{get:function(){return this._uniqueValues},set:function(t){this._uniqueValues=n.asArray(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortValues",{get:function(){return this._sortValues},set:function(t){this._sortValues=n.asBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this._map},set:function(t){this._map=n.asType(t,i.DataMap,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return null!=this._values&&Object.keys(this._values).length>0},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){var e=this.column;return!(this._bnd&&this._values&&Object.keys(this._values).length)||(t=this._bnd.getValue(t),t=this.dataMap?this.dataMap.getDisplayValue(t):e.dataMap?e.dataMap.getDisplayValue(t):n.Globalize.format(t,e.format),void 0!=this._values[t])},t.prototype.clear=function(){this.showValues=null,this.filterText=null},t.prototype.implementsInterface=function(t){return"IColumnFilter"==t},t.prototype._getUniqueValues=function(t,e){var i=[];if(this.uniqueValues){for(var r=this.uniqueValues,l=0;l<r.length;l++){d=r[l];i.push({value:d,text:d.toString()})}return i}var a={},o=t.collectionView,s=o?o.sourceCollection:[];if(e&&o&&o.sourceCollection&&o.filter){var u=this.showValues;this.showValues=null;for(var c=[],l=0;l<s.length;l++)o.filter(s[l])&&c.push(s[l]);s=c,this.showValues=u}for(l=0;l<s.length;l++){var d=t._binding.getValue(s[l]),p=this.dataMap?this.dataMap.getDisplayValue(d):t.dataMap?t.dataMap.getDisplayValue(d):n.Globalize.format(d,t.format);a[p]||(a[p]=!0,i.push({value:d,text:p}))}return i},t}();e.ValueFilter=s;var u=function(t){function e(e,i){var l=t.call(this,e)||this;l._filter=n.asType(i,s,!1);var a=l.getTemplate();l.applyTemplate("wj-control wj-valuefilter-editor",a,{_divFilter:"div-filter",_cbSelectAll:"cb-select-all",_spSelectAll:"sp-select-all",_divValues:"div-values"}),l._cbSelectAll.tabIndex=0;var o=n.culture.FlexGridFilter;n.setText(l._spSelectAll,o.selectAll);var u=l._view=new n.CollectionView;if(u.sortNullsFirst=!0,i.sortValues){var c=i.column.dataMap||i.dataMap?"text":"value",d=i.column.dataType!=n.DataType.Boolean;u.sortDescriptions.push(new n.SortDescription(c,d))}return u.filter=l._filterValues.bind(l),u.collectionChanged.addHandler(l._updateSelectAllCheck,l),l._filterText="",l._cmbFilter=new r.ComboBox(l._divFilter,{placeholder:o.search}),l._lbValues=new r.ListBox(l._divValues,{displayMemberPath:"text",checkedMemberPath:"show",itemsSource:l._view,itemFormatter:function(t,e){return e||o.null}}),n.setAriaLabel(l._cmbFilter.inputElement,o.ariaLabels.search),l._cmbFilter.textChanged.addHandler(l._filterTextChanged,l),l._cbSelectAll.addEventListener("click",l._cbSelectAllClicked.bind(l)),l.updateEditor(),l}return __extends(e,t),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),e.prototype.updateEditor=function(){var t=this,e=this._filter.column,i=this._filter._getUniqueValues(e,!0);this._lbValues.isContentHtml=e.isContentHtml;var n=this._filter.showValues;if(n&&0!=Object.keys(n).length){for(var r in n)for(l=0;l<i.length;l++)if(i[l].text==r){i[l].show=!0;break}}else for(var l=0;l<i.length;l++)i[l].show=!0;this._view.pageSize=20,this._view.sourceCollection=i,setTimeout(function(){t._view.pageSize=t._filter.maxValues,t._cmbFilter.text=t._filter.filterText||"",t._filterText=t._cmbFilter.text.toLowerCase()})},e.prototype.clearEditor=function(){this._cmbFilter.text="",this._filterText="",this._view.pageSize=0,this._view.refresh();for(var t=this._view.items,e=0;e<t.length;e++)t[e].show=!1;this._view.pageSize=this._filter.maxValues},e.prototype.updateFilter=function(){var t=null,e=this._view.items;if(this._filterText||this._cbSelectAll.indeterminate){t={};for(var i=0;i<e.length;i++){var n=e[i];n.show&&(t[n.text]=!0)}}this._filter.showValues=t,this._filter.filterText=""},e.prototype._filterTextChanged=function(){var t=this;this._toText&&clearTimeout(this._toText),this._toText=setTimeout(function(){var e=t._cmbFilter.text.toLowerCase(),i=e!=t._filterText;t._filterText=e,t._view.refresh(),i&&(t._cbSelectAll.checked=!0,t._cbSelectAllClicked())},300)},e.prototype._filterValues=function(t){return!this._filterText||!(!t||!t.text)&&t.text.toLowerCase().indexOf(this._filterText)>-1},e.prototype._cbSelectAllClicked=function(){for(var t=this._cbSelectAll.checked,e=this._view.items,i=this._divValues.scrollTop,n=0;n<e.length;n++)e[n].show=t;this._view.refresh(),this._divValues.scrollTop=i},e.prototype._updateSelectAllCheck=function(){for(var t=0,e=this._view.items,i=0;i<e.length;i++)e[i].show&&t++;0==t?(this._cbSelectAll.checked=!1,this._cbSelectAll.indeterminate=!1):t==e.length?(this._cbSelectAll.checked=!0,this._cbSelectAll.indeterminate=!1):this._cbSelectAll.indeterminate=!0},e.controlTemplate='<div><div wj-part="div-filter"></div><div class="wj-listbox-item"><label><input wj-part="cb-select-all" type="checkbox"> <span wj-part="sp-select-all"></span></label></div><div wj-part="div-values"></div></div>',e}(n.Control);e.ValueFilterEditor=u;var c=function(){function t(t){this._c1=new p(this),this._c2=new p(this),this._and=!0,this._col=t,this._bnd=t.binding?new n.Binding(t.binding):null}return Object.defineProperty(t.prototype,"condition1",{get:function(){return this._c1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"condition2",{get:function(){return this._c2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"and",{get:function(){return this._and},set:function(t){this._and=n.asBoolean(t),this._bnd=this._col&&this._col.binding?new n.Binding(this._col.binding):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this._map},set:function(t){this._map=n.asType(t,i.DataMap,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._c1.isActive||this._c2.isActive},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){var e=this._col,i=this._c1,r=this._c2;if(!this._bnd||!this.isActive)return!0;t=this._bnd.getValue(t),e.dataMap?t=e.dataMap.getDisplayValue(t):n.isDate(t)?(n.isString(i.value)||n.isString(r.value))&&(t=n.Globalize.format(t,e.format)):n.isNumber(t)&&(t=n.Globalize.parseFloat(n.Globalize.format(t,e.format)));var l=i.apply(t),a=r.apply(t);return i.isActive&&r.isActive?this._and?l&&a:l||a:i.isActive?l:!r.isActive||a},t.prototype.clear=function(){this._c1.clear(),this._c2.clear(),this.and=!0},t.prototype.implementsInterface=function(t){return"IColumnFilter"==t},t}();e.ConditionFilter=c;var d=function(t){function e(e,i){var r=t.call(this,e)||this;r._filter=n.asType(i,c,!1);var l=r.getTemplate();r.applyTemplate("wj-control wj-conditionfilter-editor",l,{_divHdr:"div-hdr",_divCmb1:"div-cmb1",_divVal1:"div-val1",_btnAnd:"btn-and",_btnOr:"btn-or",_spAnd:"sp-and",_spOr:"sp-or",_divCmb2:"div-cmb2",_divVal2:"div-val2"});var a=n.culture.FlexGridFilter,o=a.ariaLabels;n.setAriaLabel(r._btnAnd,o.and),n.setAriaLabel(r._btnOr,o.or),n.setText(r._divHdr,a.header),n.setText(r._spAnd,a.and),n.setText(r._spOr,a.or),r._cmb1=r._createOperatorCombo(r._divCmb1,o.op1),r._cmb2=r._createOperatorCombo(r._divCmb2,o.op2),r._val1=r._createValueInput(r._divVal1,o.val1),r._val2=r._createValueInput(r._divVal2,o.val2);var s=r.hostElement;return r.addEventListener(s,"change",r._btnAndOrChanged.bind(r)),r.addEventListener(s,"keydown",r._keydown.bind(r)),r.updateEditor(),r}return __extends(e,t),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),e.prototype.updateEditor=function(){var t=this._filter.condition1,e=this._filter.condition2;this._cmb1.selectedValue=t.operator,this._cmb2.selectedValue=e.operator,this._val1 instanceof r.ComboBox?(this._val1.text=n.changeType(t.value,n.DataType.String,null),this._val2.text=n.changeType(e.value,n.DataType.String,null)):(this._val1.value=t.value,this._val2.value=e.value);var i=this._filter.and;this._checkRadio(this._btnAnd,i),this._checkRadio(this._btnOr,!i)},e.prototype.clearEditor=function(){this._cmb1.selectedValue=this._cmb2.selectedValue=null,this._val1.text=this._val2.text=null,this._checkRadio(this._btnAnd,!0),this._checkRadio(this._btnOr,!1)},e.prototype.updateFilter=function(){var t=this._filter.column,e=this._filter.condition1,i=this._filter.condition2;if(e.operator=this._cmb1.selectedValue,i.operator=this._cmb2.selectedValue,this._val1 instanceof r.ComboBox){var l=t.dataType==n.DataType.Date?n.DataType.String:t.dataType;e.value=n.changeType(this._val1.text,l,t.format),i.value=n.changeType(this._val2.text,l,t.format)}else e.value=this._val1.value,i.value=this._val2.value;this._filter.and=this._btnAnd.checked},e.prototype._createOperatorCombo=function(t,e){var i=this._filter.column,l=n.culture.FlexGridFilter,a=l.stringOperators,o=this._filter.dataMap||i.dataMap,s=n.DataType;i.dataType==s.Date&&this._hasDatePart(i.format)?a=l.dateOperators:i.dataType!=s.Number||o?i.dataType!=s.Boolean||o||(a=l.booleanOperators):a=l.numberOperators;var u=new r.ComboBox(t,{itemsSource:a,displayMemberPath:"name",selectedValuePath:"op"});return n.setAriaLabel(u.inputElement,e),u},e.prototype._createValueInput=function(t,e){var i=this._filter.column,l=this._filter.dataMap||i.dataMap,a=null,o=n.DataType;return i.dataType==o.Date&&this._hasDatePart(i.format)?(a=this._hasTimePart(i.format)?new r.InputDateTime(t):new r.InputDate(t)).format=i.format:i.dataType!=o.Number||l?(a=new r.ComboBox(t),l?(a.itemsSource=l.getDisplayValues(),a.isEditable=!0):i.dataType==o.Boolean&&(a.itemsSource=[!0,!1])):(a=new r.InputNumber(t)).format=i.format,a.isRequired=!1,n.setAriaLabel(a.inputElement,e),a},e.prototype._hasDatePart=function(t){return!t||(t=n.culture.Globalize.calendar.patterns[t]||t,/[yMd]+/.test(t))},e.prototype._hasTimePart=function(t){return!!t&&(t=n.culture.Globalize.calendar.patterns[t]||t,/[Hmst]+/.test(t))},e.prototype._btnAndOrChanged=function(t){var e=t.target==this._btnAnd,i=t.target==this._btnOr;(e||i)&&(this._checkRadio(this._btnAnd,e),this._checkRadio(this._btnOr,i))},e.prototype._checkRadio=function(t,e){t.checked=e,t.setAttribute("aria-checked",e.toString()),t.setAttribute("tabindex",e?"1":"-1")},e.prototype._keydown=function(t){var e=t.target==this._btnAnd,i=t.target==this._btnOr;if(e||i)switch(t.keyCode){case n.Key.Left:case n.Key.Right:case n.Key.Up:case n.Key.Down:var r=e?this._btnOr:this._btnAnd;r.click(),r.focus(),t.preventDefault()}},e.controlTemplate='<div><div wj-part="div-hdr"></div><div wj-part="div-cmb1"></div><br/><div wj-part="div-val1"></div><br/><div role="radiogroup" style="text-align:center"><label><input wj-part="btn-and" type="radio" role="radio"> <span wj-part="sp-and"></span> </label>&nbsp;&nbsp;&nbsp;<label><input wj-part="btn-or" type="radio" role="radio"> <span wj-part="sp-or"></span> </label></div><div wj-part="div-cmb2"></div><br/><div wj-part="div-val2"></div><br/></div>',e}(n.Control);e.ConditionFilterEditor=d;var p=function(){function t(t){this._op=null,this._filter=t}return Object.defineProperty(t.prototype,"operator",{get:function(){return this._op},set:function(t){this._op=n.asEnum(t,h,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._val},set:function(t){if(this._val=t,this._strVal=n.isString(t)?t.toString().toLowerCase():null,this._mapVal=null,this._filter){var e=this._filter.dataMap||this._filter.column.dataMap;e&&(this._mapVal=e.getDisplayValue(t),n.isString(this._mapVal)&&(this._strVal=this._mapVal=this._mapVal.toLowerCase()))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){switch(this._op){case null:return!1;case h.EQ:case h.NE:return!0;default:return null!=this._val||null!=this._strVal}},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.operator=null,this.value=null},t.prototype.apply=function(t){var e=this._mapVal||this._strVal||this._val;n.isString(t)&&(t=t.toLowerCase()),n.isString(e)&&null==t&&(t="");var i=h;switch(this._op){case null:return!0;case i.EQ:return null!=t&&null!=e?t.valueOf()==e.valueOf():t==e;case i.NE:return null!=t&&null!=e?t.valueOf()!=e.valueOf():t!=e;case i.GT:return t>e;case i.GE:return t>=e;case i.LT:return t<e;case i.LE:return t<=e;case i.BW:return!(null==this._strVal||!n.isString(t))&&0==t.indexOf(this._strVal);case i.EW:return!!(null!=this._strVal&&n.isString(t)&&t.length>=this._strVal.length)&&t.substr(t.length-this._strVal.length)==e;case i.CT:return!(null==this._strVal||!n.isString(t))&&t.indexOf(this._strVal)>-1;case i.NC:return!(null==this._strVal||!n.isString(t))&&t.indexOf(this._strVal)<0}throw"Unknown operator"},t}();e.FilterCondition=p;var h;!function(t){t[t.EQ=0]="EQ",t[t.NE=1]="NE",t[t.GT=2]="GT",t[t.GE=3]="GE",t[t.LT=4]="LT",t[t.LE=5]="LE",t[t.BW=6]="BW",t[t.EW=7]="EW",t[t.CT=8]="CT",t[t.NC=9]="NC"}(h=e.Operator||(e.Operator={}));var f=function(){function t(t,e){this._owner=t,this._col=e,this._valueFilter=new s(e),this._conditionFilter=new c(e)}return Object.defineProperty(t.prototype,"filterType",{get:function(){return null!=this._filterType?this._filterType:this._owner.defaultFilterType},set:function(t){if((t=n.asEnum(t,b,!0))!=this._filterType){var e=this.isActive;this.clear(),this._filterType=t,e?this._owner.apply():this._col.grid&&this._col.grid.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this.conditionFilter.dataMap||this.valueFilter.dataMap},set:function(t){this.conditionFilter.dataMap=t,this.valueFilter.dataMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueFilter",{get:function(){return this._valueFilter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conditionFilter",{get:function(){return this._conditionFilter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._conditionFilter.isActive||this._valueFilter.isActive},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){return this._conditionFilter.apply(t)&&this._valueFilter.apply(t)},t.prototype.clear=function(){this._valueFilter.clear(),this._conditionFilter.clear()},t.prototype.implementsInterface=function(t){return"IColumnFilter"==t},t}();e.ColumnFilter=f,n._addCultureInfo("FlexGridFilter",{ariaLabels:{edit:"Edit Filter for Column",dialog:"Filter Editor for Column",asc:"Sort Column in Ascending Order",dsc:"Sort Column in Descending Order",search:"Search Item List",op1:"First Condition Operator",val1:"First Condition Value",and:"Require both Conditions",or:"Require either Condition",op2:"Second Condition Operator",val2:"Second Condition Value"},ascending:"↑ Ascending",descending:"↓ Descending",apply:"Apply",cancel:"Cancel",clear:"Clear",conditions:"Filter by Condition",values:"Filter by Value",search:"Search",selectAll:"Select All",null:"(nothing)",header:"Show items where the value",and:"And",or:"Or",stringOperators:[{name:"(not set)",op:null},{name:"Equals",op:h.EQ},{name:"Does not equal",op:h.NE},{name:"Begins with",op:h.BW},{name:"Ends with",op:h.EW},{name:"Contains",op:h.CT},{name:"Does not contain",op:h.NC}],numberOperators:[{name:"(not set)",op:null},{name:"Equals",op:h.EQ},{name:"Does not equal",op:h.NE},{name:"Is Greater than",op:h.GT},{name:"Is Greater than or equal to",op:h.GE},{name:"Is Less than",op:h.LT},{name:"Is Less than or equal to",op:h.LE}],dateOperators:[{name:"(not set)",op:null},{name:"Equals",op:h.EQ},{name:"Is Before",op:h.LT},{name:"Is After",op:h.GT}],booleanOperators:[{name:"(not set)",op:null},{name:"Equals",op:h.EQ},{name:"Does not equal",op:h.NE}]});var _=function(t){function e(e,i,r){void 0===r&&(r=!0);var l=t.call(this,e,null,!0)||this;l.filterChanged=new n.Event,l.buttonClicked=new n.Event,l._filter=n.asType(i,f);var a=l.getTemplate();l.applyTemplate("wj-control wj-content wj-columnfiltereditor",a,{_divSort:"div-sort",_btnAsc:"btn-asc",_btnDsc:"btn-dsc",_divType:"div-type",_aVal:"a-val",_aCnd:"a-cnd",_divEdtVal:"div-edt-val",_divEdtCnd:"div-edt-cnd",_btnApply:"btn-apply",_btnCancel:"btn-cancel",_btnClear:"btn-clear"});var o=n.culture.FlexGridFilter,s=o.ariaLabels,u=l.hostElement,c=l.filter.column,d=c.grid.collectionView;n.setAttribute(u,"role","dialog"),n.setAriaLabel(u,s.dialog+" "+c.header),n.setAriaLabel(l._btnAsc,s.asc),n.setAriaLabel(l._btnDsc,s.dsc),n.setText(l._btnAsc,o.ascending),n.setText(l._btnDsc,o.descending),n.setText(l._aVal,o.values),n.setText(l._aCnd,o.conditions),n.setText(l._btnApply,o.apply),n.setText(l._btnCancel,o.cancel),n.setText(l._btnClear,o.clear);var p=l.filter.conditionFilter.isActive||0==(i.filterType&b.Value)?b.Condition:b.Value;l._showFilter(p),r&&d&&d.canSort||(l._divSort.style.display="none");var h=l._btnClicked.bind(l);return l._btnApply.addEventListener("click",h),l._btnCancel.addEventListener("click",h),l._btnClear.addEventListener("click",h),l._btnAsc.addEventListener("click",h),l._btnDsc.addEventListener("click",h),l._aVal.addEventListener("click",h),l._aCnd.addEventListener("click",h),u.addEventListener("keydown",function(t){if(!t.defaultPrevented){var e=t.target.tagName.match(/^(a|button)$/i);switch(t.keyCode){case n.Key.Space:e&&(l._btnClicked(t),t.preventDefault());break;case n.Key.Enter:e?l._btnClicked(t):(l.updateFilter(),l.onFilterChanged(),l.onButtonClicked()),t.preventDefault();break;case n.Key.Escape:l.onButtonClicked(),t.preventDefault();break;case n.Key.Tab:n.moveFocus(l.hostElement,t.shiftKey?-1:1),t.preventDefault()}}}),l}return __extends(e,t),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),e.prototype.updateEditor=function(){this._edtVal&&this._edtVal.updateEditor(),this._edtCnd&&this._edtCnd.updateEditor()},e.prototype.updateFilter=function(){switch(this._getFilterType()){case b.Value:this._edtVal.updateFilter(),this.filter.conditionFilter.clear();break;case b.Condition:this._edtCnd.updateFilter(),this.filter.valueFilter.clear()}},e.prototype.onFilterChanged=function(t){this.filterChanged.raise(this,t)},e.prototype.onButtonClicked=function(t){this.buttonClicked.raise(this,t)},e.prototype._handleResize=function(){this.isTouching||this._wasTouching||this.onButtonClicked()},e.prototype._showFilter=function(t){this._wasTouching=this.isTouching,t==b.Value&&null==this._edtVal&&(this._edtVal=new u(this._divEdtVal,this.filter.valueFilter)),t==b.Condition&&null==this._edtCnd&&(this._edtCnd=new d(this._divEdtCnd,this.filter.conditionFilter)),0!=(t&this.filter.filterType)&&(t==b.Value?(this._divEdtVal.style.display="",this._divEdtCnd.style.display="none",this._enableLink(this._aVal,!1),this._enableLink(this._aCnd,!0),this._edtVal.focus()):(this._divEdtVal.style.display="none",this._divEdtCnd.style.display="",this._enableLink(this._aVal,!0),this._enableLink(this._aCnd,!1),this._edtCnd.focus()));var e=this._divType.style;switch(this.filter.filterType){case b.None:case b.Condition:case b.Value:e.display="none";break;default:e.display=""}},e.prototype._enableLink=function(t,e){n.toggleClass(t,"wj-state-disabled",!e),n.setAttribute(t,"href",e?"":null),n.setAttribute(t,"disabled",e?null:"disabled")},e.prototype._getFilterType=function(){var t=b;return"none"!=this._divEdtVal.style.display?t.Value:t.Condition},e.prototype._btnClicked=function(t){var e=t.target;if(t.preventDefault(),t.stopPropagation(),!n.hasClass(e,"wj-state-disabled")){if(e==this._aVal)return this._showFilter(b.Value),void n.moveFocus(this._edtVal.hostElement,0);if(e==this._aCnd)return this._showFilter(b.Condition),void n.moveFocus(this._edtCnd.hostElement,0);if(e==this._btnAsc||e==this._btnDsc){var i=this.filter.column,r=i.sortMemberPath?i.sortMemberPath:i.binding,l=i.grid.collectionView,a=new n.SortDescription(r,t.target==this._btnAsc);l.sortDescriptions.deferUpdate(function(){l.sortDescriptions.clear(),l.sortDescriptions.push(a)})}e==this._btnApply?(this.updateFilter(),this.onFilterChanged()):e==this._btnClear?this.filter.isActive&&(this.filter.clear(),this.onFilterChanged()):this.updateEditor(),this.onButtonClicked()}},e.controlTemplate='<div><div wj-part="div-sort"><button wj-part="btn-asc" class="wj-btn" style="min-width:95px"></button>&nbsp;&nbsp;&nbsp;<button wj-part="btn-dsc" class="wj-btn" style="min-width:95px"></button></div><div wj-part="div-type" class="wj-filtertype"><a wj-part="a-cnd" href="" draggable="false"></a>&nbsp;|&nbsp;<a wj-part="a-val" href="" draggable="false"></a></div><div wj-part="div-edt-val" tabindex="-1"></div><div wj-part="div-edt-cnd" tabindex="-1"></div><div style="text-align:right;margin-top:10px"><button wj-part="btn-apply" class="wj-btn"></button>&nbsp;&nbsp;<button wj-part="btn-cancel" class="wj-btn"></button>&nbsp;&nbsp;<button wj-part="btn-clear" class="wj-btn"></button></div>',e}(n.Control);e.ColumnFilterEditor=_;var b;!function(t){t[t.None=0]="None",t[t.Condition=1]="Condition",t[t.Value=2]="Value",t[t.Both=3]="Both"}(b=e.FilterType||(e.FilterType={}));var v=function(){function t(t,e){this._showIcons=!0,this._showSort=!0,this._defFilterType=b.Both,this.filterApplied=new n.Event,this.filterChanging=new n.Event,this.filterChanged=new n.Event;var l="Missing dependency: FlexGridFilter requires ";n.assert(null!=i,l+"wijmo.grid."),n.assert(null!=r,l+"wijmo.input."),this._filters=[],this._g=n.asType(t,i.FlexGrid,!1),this._g.formatItem.addHandler(this._formatItem.bind(this)),this._g.itemsSourceChanged.addHandler(this.clear.bind(this));var a=this._g.hostElement;t.addEventListener(a,"mousedown",this._mousedown.bind(this),!0),t.addEventListener(a,"click",this._click.bind(this),!0),t.addEventListener(a,"keydown",this._keydown.bind(this),!0),this._g.invalidate(),e&&n.copy(this,e)}return Object.defineProperty(t.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterColumns",{get:function(){return this._filterColumns},set:function(t){this._filterColumns=n.asArray(t),this.clear()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showFilterIcons",{get:function(){return this._showIcons},set:function(t){t!=this.showFilterIcons&&(this._showIcons=n.asBoolean(t),this._g&&this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSortButtons",{get:function(){return this._showSort},set:function(t){this._showSort=n.asBoolean(t)},enumerable:!0,configurable:!0}),t.prototype.getColumnFilter=function(t,e){void 0===e&&(e=!0),t=this._asColumn(t);for(var i=0;i<this._filters.length;i++)if(this._filters[i].column==t)return this._filters[i];if(e&&t.binding){var n=new f(this,t);return this._filters.push(n),n}return null},Object.defineProperty(t.prototype,"defaultFilterType",{get:function(){return this._defFilterType},set:function(t){(t=n.asEnum(t,b,!1))!=this.defaultFilterType&&(this._defFilterType=t,this._g.invalidate(),this.clear())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterDefinition",{get:function(){for(var t={defaultFilterType:this.defaultFilterType,filters:[]},e=0;e<this._filters.length;e++){var i=this._filters[e];if(i&&i.column&&i.column.binding&&(i.isActive||i.filterType!=this.defaultFilterType)){var n={binding:i.column.binding};if(i.conditionFilter.isActive){var r=i.conditionFilter;n={binding:i.column.binding,type:"condition",condition1:{operator:r.condition1.operator,value:r.condition1.value},and:r.and,condition2:{operator:r.condition2.operator,value:r.condition2.value}}}else if(i.valueFilter.isActive){var l=i.valueFilter;n={binding:i.column.binding,type:"value",filterText:l.filterText,showValues:l.showValues}}i.filterType!=this.defaultFilterType&&(n.filterType=i.filterType),t.filters.push(n)}}return JSON.stringify(t)},set:function(t){if(t=n.asString(t),this.clear(),t){var e=JSON.parse(t);this.defaultFilterType=e.defaultFilterType;for(var i=0;i<e.filters.length;i++){var r=e.filters[i],l=this._g.getColumn(r.binding),a=this.getColumnFilter(l,!0);if(a)switch(null!=r.filterType&&(a.filterType=n.asEnum(r.filterType,b)),r.type){case"condition":var o=a.conditionFilter;o.condition1.value=l.dataType==n.DataType.Date?n.changeType(r.condition1.value,l.dataType,null):r.condition1.value,o.condition1.operator=r.condition1.operator,o.and=r.and,o.condition2.value=l.dataType==n.DataType.Date?n.changeType(r.condition2.value,l.dataType,null):r.condition2.value,o.condition2.operator=r.condition2.operator;break;case"value":var s=a.valueFilter;s.filterText=r.filterText,s.showValues=r.showValues}}}this.apply()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeEditor",{get:function(){return n.Control.getControl(this._divEdt)},enumerable:!0,configurable:!0}),t.prototype.editColumnFilter=function(t,e,r){var l=this;this.closeEditor(),t=this._asColumn(t);var a=this._g,o=new i.CellRangeEventArgs(a.cells,new i.CellRange(-1,t.index));if(this.onFilterChanging(o)){o.cancel=!0;var s=n.createElement('<div class="wj-dropdown-panel"></div>'),u=this.getColumnFilter(t),c=new _(s,u,this.showSortButtons);this._divEdt=s,this._edtCol=t,a.rightToLeft&&(s.dir="rtl"),c.filterChanged.addHandler(function(){o.cancel=!1,setTimeout(function(){o.cancel||l.apply()})}),c.buttonClicked.addHandler(function(){l.closeEditor(),a.focus(),l.onFilterChanged(o)}),c.lostFocus.addHandler(function(){setTimeout(function(){var t=n.Control.getControl(l._divEdt);t&&!t.containsFocus()&&l.closeEditor()},10)});var d=e?e.col:t.index;e||a.columns[d].binding==t.binding||(d=a.selection.leftCol),a._edtHdl._commitRowEdits(),a.scrollIntoView(-1,d,!0);var p=a.columnHeaders,h=e&&e.panel==p?e.row:p.rows.length-1,f=d,b=p.getCellBoundingRect(h,f),v=r||p.getCellElement(h,f);v?n.showPopup(s,v,!1,!1,!1):n.showPopup(s,b),this._setAriaExpanded(v,!0),this._setAriaExpanded(a.cells.getCellElement(-1,f),!0);for(var g=c.hostElement.querySelectorAll("input"),y=0;y<g.length;y++){var m=g[y];if(m.offsetHeight>0&&m.tabIndex>-1&&!m.disabled){m.focus();break}}c.containsFocus()||c.focus()}else this._divEdt=this._edtCol=null},t.prototype._setAriaExpanded=function(e,i){if(e){var r=e.querySelector("."+t._WJC_FILTER);n.setAttribute(r,"aria-expanded",i)}},t.prototype.closeEditor=function(){var t=this._g,e=n.Control.getControl(this._divEdt),i=this._edtCol;if(e&&n.hidePopup(e.hostElement,function(){e.dispose()}),i){var r=t.columnHeaders,l=r.rows.length?r.getCellElement(r.rows.length-1,i.index):null;this._setAriaExpanded(l,!1),l=t.cells.getCellElement(-1,i.index),this._setAriaExpanded(l,!1)}this._divEdt=null,this._edtCol=null},t.prototype.apply=function(){var t=this._g.collectionView;if(t){var e=this._g.editableCollectionView;e&&(e.commitEdit(),e.commitNew()),t.filter=this._filter.bind(this)}var i=t?t.updateFilterDefinition:null;n.isFunction(i)&&i.call(t,this),this.onFilterApplied()},t.prototype.clear=function(){this._filters.length&&(this._filters=[],this.apply())},t.prototype.onFilterApplied=function(t){this.filterApplied.raise(this,t)},t.prototype.onFilterChanging=function(t){return this.filterChanging.raise(this,t),!t.cancel},t.prototype.onFilterChanged=function(t){this.filterChanged.raise(this,t)},t.prototype._asColumn=function(t){return n.isString(t)?this._g.getColumn(t):n.isNumber(t)?this._g.columns[t]:n.asType(t,i.Column,!1)},t.prototype._filter=function(t){for(var e=0;e<this._filters.length;e++)if(!this._filters[e].apply(t))return!1;return!0},t.prototype._formatItem=function(t,e){if(e.panel==t.columnHeaders){var r=this._g,l=r.getMergedRange(e.panel,e.row,e.col)||new i.CellRange(e.row,e.col),a=r.columns[l.col],o=r._getBindingColumn(e.panel,e.row,a),s=e.cell;if(l.row2==e.panel.rows.length-1||a!=o){var u=this.getColumnFilter(o,this.defaultFilterType!=b.None);this._filterColumns&&this._filterColumns.indexOf(o.binding)<0&&(u=null),u?(n.toggleClass(s,"wj-filter-on",u.isActive),n.toggleClass(s,"wj-filter-off",!u.isActive)):(n.removeClass(s,"wj-filter-on"),n.removeClass(s,"wj-filter-off")),u&&u.filterType!=b.None&&(this._showIcons&&this._addFilterButton(o,u,s),0==e.row&&(s=r.cells.getCellElement(-1,e.col))&&this._addFilterButton(a,u,s))}}},t.prototype._addFilterButton=function(e,i,r){var l=t._WJC_FILTER,a=n.createElement('<button class="wj-btn wj-btn-glyph wj-right '+l+'" type="button" tabindex="-1"><span class="wj-glyph-filter"></span></button>');n.setAriaLabel(a,n.culture.FlexGridFilter.ariaLabels.edit+" "+e.header),n.setAttribute(a,"aria-haspopup","dialog"),n.setAttribute(a,"aria-expanded",!1),n.setAttribute(a,"aria-describedby",e.describedById),n.setAttribute(a,"aria-pressed",i.isActive),r.querySelector("."+l)||(1==r.children.length&&(r=r.querySelector("div")||r),r.appendChild(a))},t.prototype._mousedown=function(t){this._toggleEditor(t)&&(this._tmd=!0,t.stopPropagation(),t.preventDefault())},t.prototype._click=function(t){(this._tmd||this._toggleEditor(t))&&(t.stopPropagation(),t.preventDefault()),this._tmd=!1},t.prototype._toggleEditor=function(e){var i=this;if(this._tmd=!1,!e.defaultPrevented&&0==e.button)if(n.closestClass(e.target,t._WJC_FILTER)){var r=this._g,l=r.hitTest(e.target);if(l.panel||(l=r.hitTest(e)),l.panel==r.columnHeaders||l.panel==r.cells&&-1==l.row){var a=r.columns[l.col],o=r._getBindingColumn(l.panel,l.row,a);return this._divEdt&&this._edtCol==o?(this.closeEditor(),r.focus()):setTimeout(function(){i.editColumnFilter(o,l)},this._divEdt?100:0),!0}}else this.closeEditor();return!1},t.prototype._keydown=function(t){if(!t.defaultPrevented&&!t.ctrlKey&&t.altKey&&(t.keyCode==n.Key.Down||t.keyCode==n.Key.Up)){var e=this.grid,i=e.selection,r=i.col>-1?e.columns[i.col]:null,l=r?e._getBindingColumn(e.cells,i.row,r):null;l&&!l.dataMap&&this.getColumnFilter(l,!0)&&(this.editColumnFilter(l),t.preventDefault(),t.stopPropagation())}},t._WJC_FILTER="wj-elem-filter",t}();e.FlexGridFilter=v});