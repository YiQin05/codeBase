/*
    *
    * Wijmo Library 5.20183.550
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();define(["require","exports","wijmo/wijmo","wijmo/wijmo.chart","wijmo/wijmo.chart.finance"],function(t,e,i,a,n){"use strict";function s(t){return i.asNumber(t,!0,!1),t>0?Math.floor(t):Math.ceil(t)}function r(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),i.asArray(t,!1),t.reduce(function(t,e){return t+i.asNumber(e)},0)}function o(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),i.asArray(t,!1),r(t)/t.length}function l(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments)),i.asArray(t,!1);var e=o(t);return o(t.map(function(t){return Math.pow(t-e,2)}))}function h(t,e,a,n){void 0===n&&(n=14),i.asArray(t,!1),i.asArray(e,!1),i.asArray(a,!1),i.asInt(n,!1,!0);var s=u(t,e,a,n),r=Math.min(t.length,e.length,a.length,s.length),l=[];i.assert(r>n&&n>1,"Average True Range period must be an integer less than the length of the data and greater than one.");for(var h=0;h<r;h++)i.asNumber(t[h],!1),i.asNumber(e[h],!1),i.asNumber(a[h],!1),i.asNumber(s[h],!1),h+1===n?l.push(o(s.slice(0,n))):h+1>n&&l.push(((n-1)*l[l.length-1]+s[h])/n);return l}function u(t,e,a,n){void 0===n&&(n=14),i.asArray(t,!1),i.asArray(e,!1),i.asArray(a,!1),i.asInt(n,!1,!0);var s=Math.min(t.length,e.length,a.length),r=[];i.assert(s>n&&n>1,"True Range period must be an integer less than the length of the data and greater than one.");for(var o=0;o<s;o++)i.asNumber(t[o],!1),i.asNumber(e[o],!1),i.asNumber(a[o],!1),0===o?r.push(t[o]-e[o]):r.push(Math.max(t[o]-e[o],Math.abs(t[o]-a[o-1]),Math.abs(e[o]-a[o-1])));return r}function c(t,e){i.asArray(t,!1),i.asNumber(e,!1,!0),i.assert(t.length>e&&e>1,"Simple Moving Average period must be an integer less than the length of the data and greater than one.");for(var a=[],n=e;n<=t.length;n++)a.push(o(t.slice(n-e,n)));return a}Object.defineProperty(e,"__esModule",{value:!0});var _="undefined"!=typeof window?window:self,g=n||e;_.wijmo=_.wijmo||{},_.wijmo.chart=_.wijmo.chart||{},_.wijmo.chart.finance=g,e._trunc=s,e._sum=r,e._average=o,e._minimum=function(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),i.asArray(t,!1),Math.min.apply(null,t)},e._maximum=function(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),i.asArray(t,!1),Math.max.apply(null,t)},e._variance=l,e._stdDeviation=function(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),i.asArray(t,!1),Math.sqrt(l(t))},e._avgTrueRng=h,e._trueRng=u,e._sma=c,e._ema=function(t,e){i.asArray(t,!1),i.asNumber(e,!1,!0),i.assert(t.length>e&&e>1,"Exponential Moving Average period must be an integer less than the length of the data and greater than one.");var a=[],n=2/(e+1),s=c(t,e);t=t.slice(e-1);for(var r=0;r<t.length;r++)0===r?a.push(s[0]):a.push((t[r]-a[r-1])*n+a[r-1]);return a},e._range=function(t,e,a){void 0===a&&(a=1),i.asNumber(t,!1),i.asNumber(e,!1),i.asNumber(a,!1),i.assert(t<e,"begin argument must be less than end argument.");for(var n=[],s=t;s<=e;s+=a)n.push(s);return n};var p;!function(t){t[t.Column=0]="Column",t[t.Scatter=1]="Scatter",t[t.Line=2]="Line",t[t.LineSymbols=3]="LineSymbols",t[t.Area=4]="Area",t[t.Candlestick=5]="Candlestick",t[t.HighLowOpenClose=6]="HighLowOpenClose",t[t.HeikinAshi=7]="HeikinAshi",t[t.LineBreak=8]="LineBreak",t[t.Renko=9]="Renko",t[t.Kagi=10]="Kagi",t[t.ColumnVolume=11]="ColumnVolume",t[t.EquiVolume=12]="EquiVolume",t[t.CandleVolume=13]="CandleVolume",t[t.ArmsCandleVolume=14]="ArmsCandleVolume",t[t.PointAndFigure=15]="PointAndFigure"}(p=e.FinancialChartType||(e.FinancialChartType={}));var d=function(t){function e(e,i){var a=t.call(this,e,null)||this;return a._chartType=p.Line,a.__heikinAshiPlotter=null,a.__lineBreakPlotter=null,a.__renkoPlotter=null,a.__kagiPlotter=null,a.__pfPlotter=null,a.initialize(i),a}return __extends(e,t),e.prototype._getProductInfo=function(){return"A78U,FinancialChart"},Object.defineProperty(e.prototype,"chartType",{get:function(){return this._chartType},set:function(t){(t=i.asEnum(t,p))!=this._chartType&&(this._chartType=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(t){t!=this._options&&(this._options=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_heikinAshiPlotter",{get:function(){return null===this.__heikinAshiPlotter&&(this.__heikinAshiPlotter=new k,this._initPlotter(this.__heikinAshiPlotter)),this.__heikinAshiPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lineBreakPlotter",{get:function(){return null===this.__lineBreakPlotter&&(this.__lineBreakPlotter=new A,this._initPlotter(this.__lineBreakPlotter)),this.__lineBreakPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_renkoPlotter",{get:function(){return null===this.__renkoPlotter&&(this.__renkoPlotter=new L,this._initPlotter(this.__renkoPlotter)),this.__renkoPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_kagiPlotter",{get:function(){return null===this.__kagiPlotter&&(this.__kagiPlotter=new M,this._initPlotter(this.__kagiPlotter)),this.__kagiPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_pfPlotter",{get:function(){return null===this.__pfPlotter&&(this.__pfPlotter=new T,this._initPlotter(this.__pfPlotter)),this.__pfPlotter},enumerable:!0,configurable:!0}),e.prototype._getChartType=function(){var t=null;switch(this.chartType){case p.Area:t=a.ChartType.Area;break;case p.Line:case p.Kagi:case p.PointAndFigure:t=a.ChartType.Line;break;case p.Column:case p.ColumnVolume:t=a.ChartType.Column;break;case p.LineSymbols:t=a.ChartType.LineSymbols;break;case p.Scatter:t=a.ChartType.Scatter;break;case p.Candlestick:case p.Renko:case p.HeikinAshi:case p.LineBreak:case p.EquiVolume:case p.CandleVolume:case p.ArmsCandleVolume:t=a.ChartType.Candlestick;break;case p.HighLowOpenClose:t=a.ChartType.HighLowOpenClose}return t},e.prototype._getPlotter=function(e){var a=this.chartType,n=null;if(e){var s=e.chartType;s&&!i.isUndefined(s)&&s!=a&&(a=s,!0)}switch(a){case p.HeikinAshi:n=this._heikinAshiPlotter;break;case p.LineBreak:n=this._lineBreakPlotter;break;case p.Renko:n=this._renkoPlotter;break;case p.Kagi:n=this._kagiPlotter;break;case p.ColumnVolume:(n=t.prototype._getPlotter.call(this,e)).isVolume=!0,n.width=1;break;case p.EquiVolume:(n=t.prototype._getPlotter.call(this,e)).isEqui=!0,n.isCandle=!1,n.isArms=!1,n.isVolume=!0,n.symbolWidth="100%";break;case p.CandleVolume:(n=t.prototype._getPlotter.call(this,e)).isEqui=!1,n.isCandle=!0,n.isArms=!1,n.isVolume=!0,n.symbolWidth="100%";break;case p.ArmsCandleVolume:(n=t.prototype._getPlotter.call(this,e)).isEqui=!1,n.isCandle=!1,n.isArms=!0,n.isVolume=!0,n.symbolWidth="100%";break;case p.PointAndFigure:n=this._pfPlotter;break;default:n=t.prototype._getPlotter.call(this,e)}return n},e.prototype._createSeries=function(){return new f},e}(a.FlexChartCore);e.FinancialChart=d;var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"chartType",{get:function(){return this._finChartType},set:function(t){(t=i.asEnum(t,p,!0))!=this._finChartType&&(this._finChartType=t,this._invalidate())},enumerable:!0,configurable:!0}),e.prototype._getChartType=function(){var t=null;switch(this.chartType){case p.Area:t=a.ChartType.Area;break;case p.Line:case p.Kagi:case p.PointAndFigure:t=a.ChartType.Line;break;case p.Column:case p.ColumnVolume:t=a.ChartType.Column;break;case p.LineSymbols:t=a.ChartType.LineSymbols;break;case p.Scatter:t=a.ChartType.Scatter;break;case p.Candlestick:case p.Renko:case p.HeikinAshi:case p.LineBreak:case p.EquiVolume:case p.CandleVolume:case p.ArmsCandleVolume:t=a.ChartType.Candlestick;break;case p.HighLowOpenClose:t=a.ChartType.HighLowOpenClose}return t},e.prototype.getDataRect=function(t,e){if(e)return e;var n=this.getValues(0),s=this.getValues(1)||(this.chart._xvals&&this.chart._xvals.length?this.chart._xvals:null),r=this._getBinding(0),o=this._getBinding(1),l=this._getBinding(2),h=this._getBinding(3),u=(this._plotter,this._getChartType()||this.chart._getChartType());if(u!==a.ChartType.HighLowOpenClose&&u!==a.ChartType.Candlestick||r===o)return null;if(n){for(var c=NaN,_=NaN,g=NaN,p=NaN,d=n.length,f=0;f<d;f++){var m=this._getItem(f),y=n[f];if(isFinite(y)&&[y,o?m[o]:null,l?m[l]:null,h?m[h]:null].forEach(function(t){a._DataInfo.isValid(t)&&null!==t&&((isNaN(_)||t<_)&&(_=t),(isNaN(p)||t>p)&&(p=t))}),s){var v=s[f];isFinite(v)&&(isNaN(c)?c=g=v:v<c?c=v:y>p&&(g=v))}}if(s||(c=0,g=d-1),!isNaN(_))return new i.Rect(c,_,g-c,p-_)}return null},e}(a.SeriesBase);e.FinancialSeries=f;var m=function(){function t(t,e,i,a){this.highs=t,this.lows=e,this.opens=i,this.closes=a}return t.prototype.calculate=function(){},t}();e._BaseCalculator=m;var y=function(t){function e(e,i,a,n){return t.call(this,e,i,a,n)||this}return __extends(e,t),e.prototype.calculate=function(){var t,e,i,a,n=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),s=[];if(n<=0)return s;for(var r=0;r<n;r++)a=o(this.highs[r],this.lows[r],this.opens[r],this.closes[r]),0===r?(i=o(this.opens[r],this.closes[r]),t=this.highs[r],e=this.lows[r]):(i=o(s[r-1].open,s[r-1].close),t=Math.max(this.highs[r],i,a),e=Math.min(this.lows[r],i,a)),s.push({high:t,low:e,close:a,open:i,pointIndex:r,x:null});return s},e}(m);e._HeikinAshiCalculator=y;var v=function(t){function e(e,i,a,n,s,r,o,l){var h=t.call(this,e,i,a,n)||this;return h.xs=s,h.size=r,h.unit=o,h.fields=l,h}return __extends(e,t),e.prototype._getValues=function(){var t,e=[],i=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length);switch(this.fields){case P.High:e=this.highs;break;case P.Low:e=this.lows;break;case P.Open:e=this.opens;break;case P.HL2:for(t=0;t<i;t++)e.push(o(this.highs[t],this.lows[t]));break;case P.HLC3:for(t=0;t<i;t++)e.push(o(this.highs[t],this.lows[t],this.closes[t]));break;case P.HLOC4:for(t=0;t<i;t++)e.push(o(this.highs[t],this.lows[t],this.opens[t],this.closes[t]));break;case P.Close:default:e=this.closes}return e},e.prototype._getSize=function(){var t=this.unit===C.ATR?h(this.highs,this.lows,this.closes,this.size):null;return this.unit===C.ATR?t[t.length-1]:this.size},e}(m);e._BaseRangeCalculator=v;var x=function(t){function e(e,i,a,n,s,r){return t.call(this,e,i,a,n,s,r)||this}return __extends(e,t),e.prototype.calculate=function(){var t=null!==this.xs&&this.xs.length>0,e=this.closes.length,i=[],a=[[],[]];if(e<=0)return i;for(var n,s,r,o,l,h,u,c=[],_=1;_<e;_++){if(o=i.length,l=o-1,s=t?this.xs[_]:_,r=this.closes[_],-1===l){if((n=this.closes[0])===r)continue}else if(c=this._trendExists(a)||1===this.size?a[0].slice(-this.size).concat(a[1].slice(-this.size)):a[0].slice(1-this.size).concat(a[1].slice(1-this.size)),h=Math.max.apply(null,c),u=Math.min.apply(null,c),r>h)n=Math.max(a[0][l],a[1][l]);else{if(!(r<u))continue;n=Math.min(a[0][l],a[1][l])}a[0].push(n),a[1].push(r),i.push({high:Math.max(n,r),low:Math.min(n,r),open:n,close:r,x:s,pointIndex:_})}return i},e.prototype._trendExists=function(t){if(t[1].length<this.size)return!1;var e,i=!1,a=t[1].slice(-this.size);for(e=1;e<this.size&&(i=a[e]>a[e-1]);e++);if(!i)for(e=1;e<this.size&&(i=a[e]<a[e-1]);e++);return i},e}(v);e._LineBreakCalculator=x;var b=function(t){function e(e,i,a,n,s,r,o,l){return t.call(this,e,i,a,n,s,r,o,l)||this}return __extends(e,t),e.prototype.calculate=function(){var t=this._getSize(),e=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),i=this._getValues(),a=null!==this.xs&&this.xs.length>0,n=[],s=[[],[]];if(e<=0)return n;for(var r,o,l,h,u,c,_,g,p,d,f=1;f<e;f++){if(h=n.length,u=h-1,o=a?this.xs[f]:f,d=f,p=!1,this.fields===P.HighLow)if(-1===u)if(this.highs[f]>this.highs[0])l=this.highs[f];else{if(!(this.lows[f]<this.lows[0]))continue;l=this.lows[f]}else if((g=s[1][u]-s[0][u])>0)if(this.highs[f]>s[1][u])l=this.highs[f];else{if(!(this.lows[f]<s[1][u]))continue;l=this.lows[f]}else if(this.lows[f]<s[1][u])l=this.lows[f];else{if(!(this.highs[f]>s[1][u]))continue;l=this.highs[f]}else l=i[f];if(this.unit===C.Percentage&&(t=l*this.size),-1===u){if(o=a?this.xs[0]:0,d=0,r=this.fields===P.HighLow?null==this.highs[0]?this.highs[this.highs.length-1]:this.highs[0]:null==i[0]?i[i.length-1]:i[0],(g=Math.abs(r-l)||0)<t)continue}else if(g=s[1][u]-s[0][u],_=Math.max(s[0][u],s[1][u]),c=Math.min(s[0][u],s[1][u]),g>0)if(l>_)p=!0;else{if(!((g=_-l)>=t))continue;r=_}else if(l<c)p=!0;else{if(!((g=l-c)>=t))continue;r=c}p?(s[1][u]=l,n[u].close=l,n[u].high=Math.max(n[u].open,n[u].close),n[u].low=Math.min(n[u].open,n[u].close)):(s[0].push(r),s[1].push(l),n.push({high:Math.max(r,l),low:Math.min(r,l),open:r,close:l,x:o,pointIndex:d}))}return n},e}(v);e._KagiCalculator=b;var w=function(t){function e(e,i,a,n,s,r,o,l,h){void 0===h&&(h=!1);var u=t.call(this,e,i,a,n,s,r,o,l)||this;return u.rounding=h,u}return __extends(e,t),e.prototype.calculate=function(){var t=this._getSize(),e=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),i=null!==this.xs&&this.xs.length>0,a=this._getValues(),n=[],r=[[],[]];if(e<=0)return n;for(var o,l,h,u,c,_,g,p,d=1;d<e;d++){if(u=n.length,c=u-1,l=i?this.xs[d]:d,this.fields===P.HighLow)if(-1===c)if(this.highs[d]-this.highs[0]>t)o=this.highs[0],h=this.highs[d];else{if(!(this.lows[0]-this.lows[d]>t))continue;o=this.lows[0],h=this.lows[d]}else if(_=Math.min(r[0][c],r[1][c]),g=Math.max(r[0][c],r[1][c]),this.highs[d]-g>t)o=g,h=this.highs[d];else{if(!(_-this.lows[d]>t))continue;o=_,h=this.lows[d]}else if(h=a[d],-1===c)o=a[0];else if(_=Math.min(r[0][c],r[1][c]),g=Math.max(r[0][c],r[1][c]),h>g)o=g;else{if(!(h<_))continue;o=_}if(p=h-o,!(Math.abs(p)<t)){p=s(p/t);for(var f=0;f<Math.abs(p);f++){var m={};this.rounding&&(o=this._round(o,t)),r[0].push(o),m.open=o,o=p>0?o+t:o-t,r[1].push(o),m.close=o,m.x=l,m.pointIndex=d,m.high=Math.max(m.open,m.close),m.low=Math.min(m.open,m.close),n.push(m)}}}return n},e.prototype._round=function(t,e){return Math.round(t/e)*e},e}(v);e._RenkoCalculator=w;var k=function(t){function e(){var e=t.call(this)||this;return e._symFactor=.7,e.clear(),e}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._haValues=null,this._calculator=null},e.prototype.plotSeries=function(t,e,n,s,r,o,l){var h=this;this._calculate(s);var u=i.asType(s,a.SeriesBase),c=this.chart.series.indexOf(s),_=s.getValues(1),g=this._symFactor,p=this._haValues.length,d=!0;if(_){var f=this.dataInfo.getDeltaX();f>0&&(g*=f)}else _=this.dataInfo.getXVals();_?p=Math.min(p,_.length):(d=!1,_=new Array(p));var m=this._DEFAULT_WIDTH,y=u._getSymbolFill(c),v=u._getAltSymbolFill(c)||"transparent",x=u._getSymbolStroke(c),b=u._getAltSymbolStroke(c)||x,w=g,k=s.getDataType(1)||s.chart._xDataType;t.strokeWidth=m;for(var V,P,C,A,L,M,S,T,B=e.actualMin,D=e.actualMax,F=0,O=0;O<p;O++)if(C=d?_[O]:O,a._DataInfo.isValid(C)&&B<=C&&C<=D){if(L=this._haValues[O].high,M=this._haValues[O].low,S=this._haValues[O].open,T=this._haValues[O].close,V=S<T?v:y,P=S<T?b:x,t.fill=V,t.stroke=P,t.startGroup(),A=this._getDataPoint(c,O,C,s),this.chart.itemFormatter){var H=new a.HitTestInfo(this.chart,new i.Point(e.convert(C),n.convert(L)),a.ChartElement.SeriesSymbol);H._setData(u,O),H._setDataPoint(A),this.chart.itemFormatter(t,H,function(){h._drawSymbol(t,e,n,c,O,V,w,C,L,M,S,T,A,k)})}else this._drawSymbol(t,e,n,c,O,V,w,C,L,M,S,T,A,k);t.endGroup(),s._setPointIndex(O,F),F++}},e.prototype._drawSymbol=function(t,e,n,s,r,o,l,h,u,c,_,g,p,d){var f,m=null,y=null,v=null,x=null,b=d===i.DataType.Date?432e5:.5;if(v=e.convert(h-b*l),x=e.convert(h+b*l),v>x){var w=v;v=x,x=w}h=e.convert(h),a._DataInfo.isValid(_)&&a._DataInfo.isValid(g)&&(_=n.convert(_),g=n.convert(g),y=(m=Math.min(_,g))+Math.abs(_-g),t.drawRect(v,m,x-v,y-m),(f=new a._RectArea(new i.Rect(v,m,x-v,y-m))).tag=p,this.hitTester.add(f,s)),a._DataInfo.isValid(u)&&(u=n.convert(u),null!==m&&(t.drawLine(h,m,h,u),f.rect.top=u,f.rect.height=f.rect.height+u)),a._DataInfo.isValid(c)&&(c=n.convert(c),null!==y&&(t.drawLine(h,y,h,c),f.rect.height=f.rect.height+c))},e.prototype._getDataPoint=function(t,e,i,n){var s=new a._DataPoint(t,e,i,this._haValues[e].high),r=n._getItem(e),o=n._getBinding(0),l=n._getBinding(1),h=n._getBinding(2),u=n._getBinding(3),c=n._getAxisY();return null!=r&&(s.item=a._BasePlotter.cloneStyle(r,[]),s.item[o]=this._haValues[e].high,s.item[l]=this._haValues[e].low,s.item[h]=this._haValues[e].open,s.item[u]=this._haValues[e].close),s.y=this._haValues[e].high,s.yfmt=c._formatValue(this._haValues[e].high),s},e.prototype._calculate=function(t){var e=t._getBindingValues(0),a=t._getBindingValues(1),n=t._getBindingValues(2),s=t._getBindingValues(3);this._calculator=new y(e,a,n,s),this._haValues=this._calculator.calculate(),(null===this._haValues||i.isUndefined(this._haValues))&&this._init()},e.prototype._init=function(){this._haValues=[]},e}(a._FinancePlotter);e._HeikinAshiPlotter=k;var V=function(t){function e(){var e=t.call(this)||this;return e._symFactor=.7,e.clear(),e}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._rangeValues=null,this._rangeXLabels=null,this._calculator=null},e.prototype.unload=function(){t.prototype.unload.call(this);for(var e,i,a=0;a<this.chart.series.length;a++)(e=this.chart.series[a])&&(i=e._getAxisX())&&i.itemsSource&&(i.itemsSource=null)},e.prototype.adjustLimits=function(t,e){var a,n,s,r=0,o=0,l=0,h=0,u=this.chart._xDataType===i.DataType.Date?.5:0;i.assert(this.chart.series.length<=1,"Current FinancialChartType only supports a single series");for(var c=0;c<this.chart.series.length;c++)a=this.chart.series[c],this._calculate(a),this._rangeValues.length<=0||this._rangeXLabels.length<=0||((n=this._rangeValues.map(function(t){return t.open})).push.apply(n,this._rangeValues.map(function(t){return t.close})),s=this._rangeXLabels.map(function(t){return t.value}),l=Math.min.apply(null,n),h=Math.max.apply(null,n),r=Math.min.apply(null,s),o=Math.max.apply(null,s),a._getAxisX().itemsSource=this._rangeXLabels);return r-=u,new i.Rect(r,l,o-r+u,h-l)},e.prototype.plotSeries=function(t,e,n,s,r,o,l){var h=this;this._calculate(s);var u=this.chart.series.indexOf(s),c=this._rangeValues.length,_=e.actualMin,g=e.actualMax,p=this._DEFAULT_WIDTH,d=this._symFactor,f=s._getSymbolFill(u),m=s._getAltSymbolFill(u)||"transparent",y=s._getSymbolStroke(u),v=s._getAltSymbolStroke(u)||y;t.strokeWidth=p;for(var x,b,w,k,V=0,P=0;P<c;P++)if(x=P,a._DataInfo.isValid(x)&&_<=x&&x<=g){if(b=this._rangeValues[P].open,w=this._rangeValues[P].close,t.fill=b>w?f:m,t.stroke=b>w?y:v,k=this._getDataPoint(u,P,s,Math.max(b,w)),t.startGroup(),this.chart.itemFormatter){var C=new a.HitTestInfo(this.chart,new i.Point(e.convert(x),n.convert(w)),a.ChartElement.SeriesSymbol);C._setData(s,P),C._setDataPoint(k),this.chart.itemFormatter(t,C,function(){h._drawSymbol(t,e,n,u,V,d,x,b,w,k)})}else this._drawSymbol(t,e,n,u,V,d,x,b,w,k);t.endGroup(),s._setPointIndex(P,V),V++}},e.prototype._drawSymbol=function(t,e,n,s,r,o,l,h,u,c){var _,g,p,d,f;if(p=e.convert(l-.5*o),d=e.convert(l+.5*o),p>d){var m=p;p=d,d=m}a._DataInfo.isValid(h)&&a._DataInfo.isValid(u)&&(h=n.convert(h),u=n.convert(u),g=(_=Math.min(h,u))+Math.abs(h-u),t.drawRect(p,_,d-p,g-_),(f=new a._RectArea(new i.Rect(p,_,d-p,g-_))).tag=c,this.hitTester.add(f,s))},e.prototype._getDataPoint=function(t,e,i,n){var s=e,r=new a._DataPoint(t,e,s,n),o=i._getItem(this._rangeValues[e].pointIndex),l=i.bindingX||this.chart.bindingX,h=i._getBinding(0),u=i._getBinding(1),c=i._getBinding(2),_=i._getBinding(3),g=i._getAxisY();return r.item=a._BasePlotter.cloneStyle(o,[]),r.item[h]=this._rangeValues[e].high,r.item[u]=this._rangeValues[e].low,r.item[c]=this._rangeValues[e].open,r.item[_]=this._rangeValues[e].close,r.y=this._rangeValues[e].close,r.yfmt=g._formatValue(this._rangeValues[e].close),r.x=r.item[l],r.xfmt=this._rangeXLabels[e]._text,r},e.prototype._init=function(){this._rangeValues=[],this._rangeXLabels=[]},e.prototype._calculate=function(t){},e.prototype._generateXLabels=function(t){var e,n=this,s=t._getAxisX(),r=t.getDataType(1)||this.chart._xDataType;this._rangeValues.forEach(function(t,o){var l=t.x;e=r===i.DataType.Date?i.Globalize.format(a.FlexChart._fromOADate(l),s.format||"d"):r===i.DataType.Number?s._formatValue(l):null!==r&&r!==i.DataType.String||!n.chart._xlabels?l.toString():n.chart._xlabels[l],n._rangeXLabels.push({value:o,text:e,_text:e})},this)},e}(a._BasePlotter);e._BaseRangePlotter=V;var P;!function(t){t[t.Close=0]="Close",t[t.High=1]="High",t[t.Low=2]="Low",t[t.Open=3]="Open",t[t.HighLow=4]="HighLow",t[t.HL2=5]="HL2",t[t.HLC3=6]="HLC3",t[t.HLOC4=7]="HLOC4"}(P=e.DataFields||(e.DataFields={}));var C;!function(t){t[t.Fixed=0]="Fixed",t[t.ATR=1]="ATR",t[t.Percentage=2]="Percentage"}(C=e.RangeMode||(e.RangeMode={}));var A=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._newLineBreaks=null},e.prototype._calculate=function(t){this._init();var e=t._getBindingValues(3),a=t.getValues(1)||this.chart._xvals;this._calculator=new x(null,null,null,e,a,this._newLineBreaks),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||i.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(t)},e.prototype._init=function(){t.prototype._init.call(this),this._newLineBreaks=i.asInt(this.getNumOption("newLineBreaks","lineBreak"),!0,!0)||3,i.assert(this._newLineBreaks>=1,"Value must be greater than 1")},e}(V);e._LineBreakPlotter=A;var L=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._boxSize=null,this._rangeMode=null},e.prototype._calculate=function(t){this._init();var e=t._getBindingValues(0),a=t._getBindingValues(1),n=t._getBindingValues(2),s=t._getBindingValues(3),r=t.getValues(1)||this.chart._xvals;this._calculator=new w(e,a,n,s,r,this._boxSize,this._rangeMode,this._fields,this._rounding),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||i.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(t)},e.prototype._init=function(){t.prototype._init.call(this),this._boxSize=this.getNumOption("boxSize","renko")||14,this._rangeMode=this.getOption("rangeMode","renko")||C.Fixed,this._rangeMode=i.asEnum(this._rangeMode,C,!0),i.assert(this._rangeMode!==C.Percentage,"RangeMode.Percentage is not supported"),this._fields=this.getOption("fields","renko")||P.Close,this._fields=i.asEnum(this._fields,P,!0),i.assert(this._fields!==P.HighLow,"DataFields.HighLow is not supported"),this._rounding=i.asBoolean(this.getOption("rounding","renko"),!0)},e.prototype._generateXLabels=function(e){var i=this;t.prototype._generateXLabels.call(this,e),this._rangeXLabels.forEach(function(t,e){e>0&&i._rangeXLabels[e-1]._text===t.text&&(t.text="")},this)},e}(V);e._RenkoPlotter=L;var M=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._calculate=function(t){this._init();var e=t._getBindingValues(0),a=t._getBindingValues(1),n=t._getBindingValues(2),s=t._getBindingValues(3),r=t.getValues(1)||this.chart._xvals;this._calculator=new b(e,a,n,s,r,this._reversalAmount,this._rangeMode,this._fields),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||i.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(t)},e.prototype.plotSeries=function(t,e,n,s,r,o,l){this._calculate(s);var h=this.chart.series.indexOf(s),u=this._rangeValues.length,c=e.actualMin,_=e.actualMax,g=this._DEFAULT_WIDTH,p=s._getSymbolStroke(h),d=s._getAltSymbolStroke(h)||p,f=[],m=[];t.stroke=p,t.strokeWidth=g;var y,v,x,b,w,k,V,P=0;t.startGroup();for(var C=0;C<u;C++)y=C,a._DataInfo.isValid(y)&&c<=y&&y<=_&&(v=this._rangeValues[C].open,x=this._rangeValues[C].close,0===C?(b=Math.min(v,x),w=Math.max(v,x),t.strokeWidth=v>x?g:2*g,t.stroke=v>x?p:d,t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(x)),t.drawLine(e.convert(y-1)-t.strokeWidth/2,n.convert(v),e.convert(y)+t.strokeWidth/2,n.convert(v))):t.strokeWidth===g?x>v?(x>w?(t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(w)),t.strokeWidth=2*g,t.stroke=d,t.drawLine(e.convert(y),n.convert(w),e.convert(y),n.convert(x)),b=v):t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(x)),w=x):t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(x)):t.strokeWidth/2===g&&(x<v?(x<b?(t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(b)),t.strokeWidth=g,t.stroke=p,t.drawLine(e.convert(y),n.convert(b),e.convert(y),n.convert(x)),w=v):t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(x)),b=x):t.drawLine(e.convert(y),n.convert(v),e.convert(y),n.convert(x))),C<u-1&&t.drawLine(e.convert(y)-t.strokeWidth/2,n.convert(x),e.convert(y+1)+t.strokeWidth/2,n.convert(x)),V=this._getDataPoint(h,C,s,x),(k=new a._CircleArea(new i.Point(e.convert(y),n.convert(x)),.5*t.strokeWidth)).tag=V,this.hitTester.add(k,h),s._setPointIndex(C,P),P++,f.push(e.convert(y)),m.push(n.convert(v)),f.push(e.convert(y)),m.push(n.convert(x)));t.endGroup(),this.hitTester.add(new a._LinesArea(f,m),h)},e.prototype._init=function(){t.prototype._init.call(this),this._reversalAmount=this.getNumOption("reversalAmount","kagi")||14,this._rangeMode=this.getOption("rangeMode","kagi")||C.Fixed,this._rangeMode=i.asEnum(this._rangeMode,C,!0),this._fields=this.getOption("fields","kagi")||P.Close,this._fields=i.asEnum(this._fields,P,!0)},e.prototype.clear=function(){t.prototype.clear.call(this),this._reversalAmount=null,this._rangeMode=null},e}(V);e._KagiPlotter=M;var S;!function(t){t[t.Traditional=0]="Traditional",t[t.Fixed=1]="Fixed",t[t.Dynamic=2]="Dynamic"}(S=e.PointAndFigureScaling||(e.PointAndFigureScaling={}));var T=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._boxSize=null,this._fields=null,this._reversal=null,this._scaling=null},e.prototype.unload=function(){t.prototype.unload.call(this)},e.prototype._init=function(){this._boxSize=this.getNumOption("boxSize","pointAndFigure")||1,this._reversal=this.getNumOption("reversal","pointAndFigure")||3,this._period=this.getNumOption("period","pointAndFigure")||20,this._fields=this.getOption("fields","pointAndFigure")||P.Close,this._fields=i.asEnum(this._fields,P,!0),i.assert(this._fields==P.Close||this._fields==P.HighLow,"Only DataFields.Close and DataFields.HighLow are supported"),this._scaling=this.getOption("scaling","pointAndFigure")||S.Traditional,this._scaling=i.asEnum(this._scaling,S,!0),this._xlbls=[]},e.prototype.adjustLimits=function(t,e){this._init(),this.hitTester.clear();var a=new i.Rect(0,0,0,0),n=this.chart.series.length;if(i.assert(n<=1,"Current FinancialChartType only supports a single series"),n>0){var s=this.chart.series[0],r=this._reversal,o=s.collectionView?s.collectionView:this.chart.collectionView,l=o?o.items:null;if(l&&l.length>0){var h=s._getBinding(0),u=s._getBinding(1),c=s._getBinding(2),_=s._getBinding(3);this._fields==P.Close&&(_?h=_:c&&(h=c),u=h);var g=s.bindingX?s.bindingX:this.chart.bindingX,p=this._actualBoxSize=this.calcBoxSize(l,h,u);if(this._pfdata=this.calcPFHiLo2(l,h,u,g,p,r),this._pfdata&&this._pfdata.length>0){var d=this._pfdata.reduce(function(t,e){return Math.max(t,e.max)},this._pfdata[0].max),f=this._pfdata.reduce(function(t,e){return Math.min(t,e.min)},this._pfdata[0].min);a=new i.Rect(-.5,f-.5*p,this._pfdata.length,d-f+p);for(var m=1;m<this._pfdata.length;m++){var y=this._pfdata[m-1],v=this._pfdata[m];i.isDate(v.date)&&i.isDate(y.date)&&v.date.getYear()!=y.date.getYear()&&this._xlbls.push({value:m,text:i.Globalize.formatNumber(v.date.getFullYear()%100,"d2")})}}}}return 0==this._xlbls.length&&this._xlbls.push({value:0}),this.chart.axisX._beginUpdate(),this.chart.axisY._beginUpdate(),this.axisYMajorGrid=this.chart.axisY.majorGrid,this.axisXItemsSource=this.chart.axisX.itemsSource,this.chart.axisY.majorGrid=!1,this.chart.axisX.itemsSource=this._xlbls,a},e.prototype.plotSeries=function(t,e,i,a,n,s,r){if(this._pfdata&&this._pfdata.length>0){var o=this._actualBoxSize;this.renderGrid(t,this._pfdata,o),this.renderData(this.chart,t,this._pfdata,o)}this.chart.axisY.majorGrid=this.axisYMajorGrid,this.chart.axisX.itemsSource=this.axisXItemsSource,this.chart.axisX._cancelUpdate(),this.chart.axisY._cancelUpdate()},e.prototype.calcBoxSize=function(t,e,i){var a=t.reduce(function(t,i){return Math.max(t,i[e])},t[0][e]),n=t.reduce(function(t,e){return Math.min(t,e[i])},t[0][i]),s=this._boxSize,r=a-n;switch(this._scaling){case S.Traditional:r<.25?s=.0625:r>=.25&&r<1?s=.125:r>=1&&r<5?s=.25:r>=5&&r<20?s=.5:r>=20&&r<100?s=1:r>=100&&r<200?s=2:r>=200&&r<500?s=4:r>=500&&r<1e3?s=5:r>=1e3&&r<25e3?s=50:r>-25e3&&(s=500);break;case S.Dynamic:var o=this.chart.series[0],l=o._getBindingValues(0),u=o._getBindingValues(1),c=(o._getBindingValues(2),h(l,u,o._getBindingValues(3),this._period));s=c[c.length-1]}return s},e.prototype.calcPFHiLo2=function(t,e,a,n,s,r){for(var o=[],l=0;l<t.length;l++){var h=t[l][e],u=t[l][a];i.assert(h>=u,"'High' value must be larger than 'low' value.");var c=t[l][n];if(0==o.length)o.push({min:this.roundDown(u,s),max:this.roundDown(h,s),rise:!1,date:c});else{var _=o[o.length-1];if(_.rise){var g=_.max+s,p=_.max-r*s;this.roundUp(h,s)>=g?_.max=this.roundUp(h,s):u<=p&&o.push({min:this.roundDown(u,s),max:_.max-s,rise:!1,date:c})}else{var g=_.min-s,p=_.min+r*s;this.roundDown(u,s)<=g?_.min=this.roundDown(u,s):h>=p&&o.push({min:_.min+s,max:this.roundUp(h,s),rise:!0,date:c})}}}if(o.length>0){var d=o[0];d.min==d.max&&o.splice(0,1)}return o},e.prototype.roundUp=function(t,e){return Math.ceil(t/e-.999999)*e},e.prototype.roundDown=function(t,e){return Math.floor(t/e+.999999)*e},e.prototype.renderGrid=function(t,e,n){if(this._pfdata){for(var s=this._pfdata.reduce(function(t,e){return Math.max(t,e.max)},this._pfdata[0].max),r=this._pfdata.reduce(function(t,e){return Math.min(t,e.min)},this._pfdata[0].min),o=this.chart,l=this._pfdata.length,h=r-.5*n;h<=s+n;h+=n){c=new i.Point(-.5,h);c=o.dataToPoint(c);_=new i.Point(l,h);_=o.dataToPoint(_),t.stroke=a.FlexChart._FG,t.strokeWidth=1,t.drawLine(c.x,c.y,_.x,_.y,a.FlexChart._CSS_GRIDLINE)}for(var u=-.5;u<=l;u+=1){var c=new i.Point(u,this.chart.axisY.actualMin);c=o.dataToPoint(c);var _=new i.Point(u,this.chart.axisY.actualMax);_=o.dataToPoint(_),t.stroke=a.FlexChart._FG,t.strokeWidth=1,t.drawLine(c.x,c.y,_.x,_.y,a.FlexChart._CSS_GRIDLINE)}}},e.prototype.renderData=function(t,e,n,s){for(var r=t.series[0],o=r._getSymbolStroke(0),l=r._getAltSymbolStroke(0)||o,h=0;h<n.length;h++){var u=n[h],c=(n[h].max-n[h].min)/s;if(0!=c){var _=new i.Point(h-.5,u.min);_=t.dataToPoint(_);var g=new i.Point(h+.5,u.max);g=t.dataToPoint(g),e.fill="transparent";for(var p=(g.y-_.y)/c,d=0;d<c+1;d++)if(e.strokeWidth=1.5,u.rise?(e.stroke=o,e.drawLine(_.x,_.y+(d-.5)*p,g.x,_.y+(d+.5)*p),e.drawLine(g.x,_.y+(d-.5)*p,_.x,_.y+(d+.5)*p)):(e.stroke=l,e.drawEllipse(.5*(_.x+g.x),_.y+d*p,.5*Math.abs(_.x-g.x),.5*Math.abs(p))),this.hitTester){var f=u.min+d*s,m=new a._DataPoint(0,h,u.date,f);m.y=f,m.yfmt=this.chart.axisY._formatValue(f),i.isDate(u.date)&&(m.x=u.date,m.xfmt=i.Globalize.formatDate(u.date,"d"));var y=new i.Rect(Math.min(_.x,g.x),_.y+d*p-.5*p,Math.abs(g.x-_.x),p);y.height<0&&(y.top+=p,y.height=-y.height);var v=new a._RectArea(y);v.tag=m,this.hitTester.add(v,0)}}}},e}(a._BasePlotter);e._PointAndFigurePlotter=T});