/*
    *
    * Wijmo Library 5.20183.550
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";function tryGetModuleWijmoInput(){var e;return(e=__glob.wijmo)&&e.input}var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wjcCore=require("wijmo/wijmo"),__glob="undefined"!=typeof window?window:self,wjcSelfRef=require("wijmo/wijmo.grid"),wjcSelf=wjcSelfRef||exports;__glob.wijmo=__glob.wijmo||{},__glob.wijmo.grid=wjcSelf,wjcCore._addCultureInfo("FlexGrid",{groupHeaderFormat:"{name}: <b>{value}</b> ({count:n0} items)",ariaLabels:{toggleDropDown:"Toggle Dropdown",toggleGroup:"Toggle Group"}});var HeadersVisibility;!function(e){e[e.None=0]="None",e[e.Column=1]="Column",e[e.Row=2]="Row",e[e.All=3]="All"}(HeadersVisibility=exports.HeadersVisibility||(exports.HeadersVisibility={}));var FlexGrid=function(e){function t(t,o){var i=e.call(this,t,null,!0)||this;i._szClient=new wjcCore.Size(0,0),i._ptScrl=new wjcCore.Point(0,0),i._cellPadding=3,i._clipToScreen=!1,i._autoGenCols=!0,i._autoClipboard=!0,i._autoScroll=!0,i._autoSearch=!1,i._readOnly=!1,i._indent=14,i._autoSizeMode=AutoSizeMode.Both,i._hdrVis=HeadersVisibility.All,i._alSorting=!0,i._alAddNew=!1,i._alDelete=!1,i._alResizing=AllowResizing.Columns,i._alDragging=AllowDragging.Columns,i._alMerging=AllowMerging.None,i._ssHdr=HeadersVisibility.None,i._shSort=!0,i._shGroups=!0,i._shAlt=!0,i._shErr=!0,i._shDropDown=!0,i._valEdt=!0,i._deferResizing=!1,i._pSel=!0,i._pOutline=!0,i._vt=0,i._vtRows=0,i._vtCols=0,i.itemsSourceChanging=new wjcCore.Event,i.itemsSourceChanged=new wjcCore.Event,i.scrollPositionChanged=new wjcCore.Event,i.selectionChanging=new wjcCore.Event,i.selectionChanged=new wjcCore.Event,i.loadingRows=new wjcCore.Event,i.loadedRows=new wjcCore.Event,i.updatingLayout=new wjcCore.Event,i.updatedLayout=new wjcCore.Event,i.resizingColumn=new wjcCore.Event,i.resizedColumn=new wjcCore.Event,i.autoSizingColumn=new wjcCore.Event,i.autoSizedColumn=new wjcCore.Event,i.draggingColumn=new wjcCore.Event,i.draggingColumnOver=new wjcCore.Event,i.draggedColumn=new wjcCore.Event,i.resizingRow=new wjcCore.Event,i.resizedRow=new wjcCore.Event,i.autoSizingRow=new wjcCore.Event,i.autoSizedRow=new wjcCore.Event,i.draggingRow=new wjcCore.Event,i.draggingRowOver=new wjcCore.Event,i.draggedRow=new wjcCore.Event,i.groupCollapsedChanging=new wjcCore.Event,i.groupCollapsedChanged=new wjcCore.Event,i.sortingColumn=new wjcCore.Event,i.sortedColumn=new wjcCore.Event,i.beginningEdit=new wjcCore.Event,i.prepareCellForEdit=new wjcCore.Event,i.cellEditEnding=new wjcCore.Event,i.cellEditEnded=new wjcCore.Event,i.rowEditStarting=new wjcCore.Event,i.rowEditStarted=new wjcCore.Event,i.rowEditEnding=new wjcCore.Event,i.rowEditEnded=new wjcCore.Event,i.rowAdded=new wjcCore.Event,i.deletingRow=new wjcCore.Event,i.deletedRow=new wjcCore.Event,i.copying=new wjcCore.Event,i.copied=new wjcCore.Event,i.pasting=new wjcCore.Event,i.pasted=new wjcCore.Event,i.pastingCell=new wjcCore.Event,i.pastedCell=new wjcCore.Event,i.formatItem=new wjcCore.Event,i.updatingView=new wjcCore.Event,i.updatedView=new wjcCore.Event,i._mappedColumns=null;var n=i.hostElement;wjcCore.isIE()&&(n.style.borderRadius="0");var r=i.getTemplate();i.applyTemplate("wj-control wj-content wj-flexgrid",r,{_root:"root",_eSz:"sz",_eCt:"cells",_fCt:"fcells",_eTL:"tl",_eBL:"bl",_eCHdr:"ch",_eRHdr:"rh",_eCFtr:"cf",_eTLCt:"tlcells",_eBLCt:"blcells",_eCHdrCt:"chcells",_eCFtrCt:"cfcells",_eRHdrCt:"rhcells",_eMarquee:"marquee",_eFocus:"focus"});return[i._eRHdr,i._eCFtr,i._eCHdr,i._eBL,i._eTL].forEach(function(e){wjcCore.setAttribute(e,"aria-hidden",!0),wjcCore.setCss(e,{position:"absolute",overflow:"hidden",outline:"none"}),wjcCore.setCss(e.firstElementChild,{position:"relative"})}),[i._eFocus,i._eMarquee,i._fCt,i._eSz].forEach(function(e){wjcCore.setAttribute(e,"aria-hidden",!0)}),n.tabIndex=-1,i.deferUpdate(function(){var e=i._getDefaultRowHeight();i._rows=new RowCollection(i,e),i._cols=new ColumnCollection(i,4*e),i._hdrRows=new RowCollection(i,e),i._hdrCols=new ColumnCollection(i,Math.round(1.25*e)),i._ftrRows=new RowCollection(i,e),i._gpTL=new GridPanel(i,CellType.TopLeft,i._hdrRows,i._hdrCols,i._eTLCt),i._gpCHdr=new GridPanel(i,CellType.ColumnHeader,i._hdrRows,i._cols,i._eCHdrCt),i._gpRHdr=new GridPanel(i,CellType.RowHeader,i._rows,i._hdrCols,i._eRHdrCt),i._gpCells=new GridPanel(i,CellType.Cell,i._rows,i._cols,i._eCt),i._gpBL=new GridPanel(i,CellType.BottomLeft,i._ftrRows,i._hdrCols,i._eBLCt),i._gpCFtr=new GridPanel(i,CellType.ColumnFooter,i._ftrRows,i._cols,i._eCFtrCt),i._hdrRows.push(new Row),i._hdrCols.push(new Column({align:"center"})),i._cf=new CellFactory,i._keyHdl=new _KeyboardHandler(i),i._mouseHdl=new _MouseHandler(i),i._edtHdl=new _EditHandler(i),i._selHdl=new _SelectionHandler(i),i._addHdl=new _AddNewHandler(i),i._mrgMgr=new MergeManager(i),i._bndSortConverter=i._sortConverter.bind(i),wjcCore.setAttribute(i.cells.hostElement,"role","grid"),i.selectionMode=SelectionMode.CellRange,i.initialize(o)}),i.addEventListener(i._root,"scroll",function(e){i._updateScrollPosition()&&(i.finishEditing(),i._updateContent(!0))}),i.addEventListener(n,"focus",function(e){if(n.tabIndex>-1){var t=e.target;if(t instanceof HTMLElement&&t.tabIndex<0)return void i._setFocus(!0)}},!0),i}return __extends(t,e),t.prototype._handleResize=function(){this._rcBounds=null,e.prototype._handleResize.call(this)},Object.defineProperty(t.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(e){(e=wjcCore.asEnum(e,HeadersVisibility))!=this._hdrVis&&(this._hdrVis=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(e){e!=this._stickyHdr&&(this._stickyHdr=wjcCore.asBoolean(e),this._updateStickyHeaders(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(e){this._pSel=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(e){this._pOutline=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"virtualizationThreshold",{get:function(){return this._vt},set:function(e){this._vt=e,wjcCore.isNumber(e)?this._vtRows=this._vtCols=wjcCore.asNumber(e):e?wjcCore.isArray(e)&&2==e.length?(this._vtRows=wjcCore.asNumber(e[0]),this._vtCols=wjcCore.asNumber(e[1])):wjcCore.assert(!1,"virtualizationThreshold should be a number or an array with two numbers."):this._vtRows=this._vtCols=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(e){this._autoGenCols=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(e){this._autoClipboard=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoScroll",{get:function(){return this._autoScroll},set:function(e){this._autoScroll=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSearch",{get:function(){return this._autoSearch},set:function(e){this._autoSearch=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnLayout",{get:function(){for(var e=t._getSerializableProperties(Column),o=new Column,i=[],n=0;n<this.columns.length;n++){for(var r=this.columns[n],s={},l=0;l<e.length;l++){var a=e[l],c=r[a];c!=o[a]&&wjcCore.isPrimitive(c)&&"size"!=a&&(s[a]=c)}i.push(s)}return JSON.stringify({columns:i})},set:function(e){var t=JSON.parse(wjcCore.asString(e));if(!t||null==t.columns)throw"Invalid columnLayout data.";this.columns.clear(),this.initialize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(e){e!=this._readOnly&&(this._readOnly=wjcCore.asBoolean(e),this.finishEditing(),this.invalidate(!0),this._addHdl.updateNewRowTemplate(),wjcCore.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly),this._setAria("readonly",this.isReadOnly?"true":null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imeEnabled",{get:function(){return null!=this._imeHdl},set:function(e){if(wjcCore.asBoolean(e)!=this.imeEnabled&&this.finishEditing()){var t=this.containsFocus();this._imeHdl&&(this._imeHdl.dispose(),this._imeHdl=null),e&&(this._imeHdl=new _ImeHandler(this)),t&&this.focus()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(e){this._alResizing=wjcCore.asEnum(e,AllowResizing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(e){this._deferResizing=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(e){this._autoSizeMode=wjcCore.asEnum(e,AutoSizeMode)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=wjcCore.asBoolean(e,!0)},enumerable:!0,configurable:!0}),t.prototype._getQuickAutoSize=function(){return wjcCore.isBoolean(this._quickSize)?this._quickSize:!this.formatItem.hasHandlers&&null==this.itemFormatter},Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(e){this._alSorting=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(e){e!=this._alAddNew&&(this._alAddNew=wjcCore.asBoolean(e),this._addHdl.updateNewRowTemplate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(e){this._addHdl.newRowAtTop=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(e){e!=this._alDelete&&(this._alDelete=wjcCore.asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(e){(e=wjcCore.asEnum(e,AllowMerging))!=this._alMerging&&(this._alMerging=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(e){(e=wjcCore.asEnum(e,HeadersVisibility))!=this._ssHdr&&(this._ssHdr=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showMarquee",{get:function(){return!this._eMarquee.style.display},set:function(e){if(e!=this.showMarquee){var t=this._eMarquee.style;t.visibility="collapse",t.display=wjcCore.asBoolean(e)?"":"none",this.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSort",{get:function(){return this._shSort},set:function(e){e!=this._shSort&&(this._shSort=wjcCore.asBoolean(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showGroups",{get:function(){return this._shGroups},set:function(e){e!=this._shGroups&&(this._shGroups=wjcCore.asBoolean(e),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAlternatingRows",{get:function(){return this._shAlt},set:function(e){e!=this._shAlt&&(this._shAlt=wjcCore.asBoolean(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showErrors",{get:function(){return this._shErr},set:function(e){e!=this._shErr&&(this._clearCells(),this._shErr=wjcCore.asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(e){e!=this.itemValidator&&(this._itemValidator=wjcCore.asFunction(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(e){this._valEdt=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(e){e!=this._gHdrFmt&&(this._gHdrFmt=wjcCore.asString(e),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(e){(e=wjcCore.asEnum(e,AllowDragging))!=this._alDragging&&(this._alDragging=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemsSource",{get:function(){return this._items},set:function(e){if(e!=this._items){var t=new wjcCore.CancelEventArgs;if(this.onItemsSourceChanging(t)){if(this._cv&&((o=wjcCore.tryCast(this._cv,wjcCore.CollectionView))&&o.sortConverter==this._bndSortConverter&&(o.sortConverter=null),this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null),this._items=e,this._cv=this._getCollectionView(e),this._lastCount=0,this._cv){this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this);var o=wjcCore.tryCast(this._cv,wjcCore.CollectionView);o&&!o.sortConverter&&(o.sortConverter=this._bndSortConverter)}this._bindGrid(!0);var i=SelectionMode;this.selectionMode==i.ListBox&&(this.selectionMode=i.CellRange,this.selectionMode=i.ListBox),this.onItemsSourceChanged(t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editableCollectionView",{get:function(){return wjcCore.tryCast(this._cv,"IEditableCollectionView")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(e){e!=this._childItemsPath&&(wjcCore.assert(null==e||wjcCore.isArray(e)||wjcCore.isString(e),"childItemsPath should be an array or a string."),this._childItemsPath=e,this._bindGrid(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(e){e!=this.rowHeaderPath&&(e=wjcCore.asString(e),this._rowHdrPath=e?new wjcCore.Binding(e):null,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),t.prototype.getColumn=function(e){return this.columns.getColumn(e)},Object.defineProperty(t.prototype,"frozenRows",{get:function(){return this.rows.frozen},set:function(e){this.rows.frozen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(e){this.columns.frozen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(e){e!=this.cloneFrozenCells&&(this._fzClone=wjcCore.asBoolean(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(e){e!=this._sortRowIndex&&(this._sortRowIndex=wjcCore.asNumber(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(e){var o=this._root,i=-e.x;if(this.rightToLeft)switch(t._getRtlMode()){case"rev":i=o.scrollWidth-o.clientWidth+e.x;break;case"neg":i=e.x;break;default:i=-e.x}o.scrollLeft=i,o.scrollTop=-e.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlRect",{get:function(){return this._rcBounds||(this._rcBounds=wjcCore.getElementRect(this._root)),this._rcBounds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollSize",{get:function(){return new wjcCore.Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFactory",{get:function(){return this._cf},set:function(e){e!=this._cf&&(this._clearCells(),this._cf=wjcCore.asType(e,CellFactory,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(e){e!=this._itemFormatter&&(this._clearCells(),this._itemFormatter=wjcCore.asFunction(e))},enumerable:!0,configurable:!0}),t.prototype.canEditCell=function(e,t){return this._edtHdl._allowEditing(e,t)},t.prototype.getCellData=function(e,t,o){return this.cells.getCellData(e,t,o)},t.prototype.getCellBoundingRect=function(e,t,o){return this.cells.getCellBoundingRect(e,t,o)},t.prototype.setCellData=function(e,t,o,i,n){return void 0===i&&(i=!0),void 0===n&&(n=!0),this.cells.setCellData(e,t,o,i,n)},t.prototype.hitTest=function(e,t){return wjcCore.isNumber(e)&&wjcCore.isNumber(t)&&(e=new wjcCore.Point(e,t)),wjcCore.isBoolean(t)&&t&&(this._rcBounds=null),new HitTestInfo(this,e)},t.prototype.getClipString=function(e){return this._edtHdl.getClipString(e)},t.prototype.setClipString=function(e,t){this._edtHdl.setClipString(e,t)},t.prototype.focus=function(){this._setFocus(!1)},t.prototype.dispose=function(){this.finishEditing(!0),this.itemsSource=null,e.prototype.dispose.call(this)},t.prototype.refresh=function(t){if(void 0===t&&(t=!0),e.prototype.refresh.call(this,t),this.finishEditing(),t){this._updateColumnTypes(),this.scrollPosition=this._ptScrl;var o=this._getDefaultRowHeight();this._rows._setDefaultSize(o),this._cols._setDefaultSize(4*o),this._hdrRows._setDefaultSize(o),this._hdrCols._setDefaultSize(Math.round(1.25*o)),this._ftrRows._setDefaultSize(o)}this.refreshCells(t)},t.prototype.refreshCells=function(e,t,o){this.isUpdating||(e?this._updateLayout():this._updateContent(t,o))},t.prototype.autoSizeColumn=function(e,t,o){void 0===t&&(t=!1),void 0===o&&(o=4),this.autoSizeColumns(e,e,t,o)},t.prototype.autoSizeColumns=function(e,o,i,n){var r=this;void 0===i&&(i=!1),void 0===n&&(n=4);var s=0,l=i?this.topLeftCells:this.columnHeaders,a=i?this.bottomLeftCells:this.columnFooters,c=i?this.rowHeaders:this.cells,h=this.viewRange;e=null==e?0:wjcCore.asInt(e),o=null==o?c.columns.length-1:wjcCore.asInt(o),h.row=Math.max(0,h.row-1e3),h.row2=Math.min(h.row2+1e3,this.rows.length-1),this.finishEditing()&&this.columns.deferUpdate(function(){wjcCore.setCss(r._eCt,{width:r._gpCells.width});var i=document.createElement("div");i.setAttribute(t._WJS_MEASURE,"true"),i.style.visibility="hidden",c.hostElement.parentElement.appendChild(i);for(var u=r._getCanvasContext(),d=e;d<=o&&d>-1&&d<c.columns.length;d++){var g=c.columns[d];if(g.isVisible){if(s=0,r.autoSizeMode&AutoSizeMode.Headers){for(p=0;p<l.rows.length;p++)if(l.rows[p].isVisible){f=r._getDesiredWidth(l,p,d,i);s=Math.max(s,f)}for(p=0;p<a.rows.length;p++)if(a.rows[p].isVisible){f=r._getDesiredWidth(a,p,d,i);s=Math.max(s,f)}}if(r.autoSizeMode&AutoSizeMode.Cells&&h.isValid)if(g._getQuickAutoSize()){var p=r._getWidestRow(c,h,d,u),f=r._getDesiredWidth(c,p,d,i);s=Math.max(s,f)}else for(p=h.row;p<=h.row2&&p<c.rows.length;p++)if(c.rows[p].isVisible){f=r._getDesiredWidth(c,p,d,i);s=Math.max(s,f)}s>0&&(g.width=s+n+2)}}r.cellFactory.disposeCell(i),wjcCore.removeChild(i)})},t.prototype.autoSizeRow=function(e,t,o){void 0===t&&(t=!1),void 0===o&&(o=0),this.autoSizeRows(e,e,t,o)},t.prototype.autoSizeRows=function(e,o,i,n){var r=this;void 0===i&&(i=!1),void 0===n&&(n=0);var s=0,l=i?this.topLeftCells:this.rowHeaders,a=i?this.columnHeaders:this.cells;i=wjcCore.asBoolean(i),n=wjcCore.asNumber(n),e=null==e?0:wjcCore.asInt(e),o=null==o?a.rows.length-1:wjcCore.asInt(o),this.finishEditing()&&this.rows.deferUpdate(function(){wjcCore.setCss(r._eCt,{width:r._gpCells.width});var i=document.createElement("div");i.setAttribute(t._WJS_MEASURE,"true"),i.style.visibility="hidden",a.hostElement.appendChild(i);for(var c={},h=e;h<=o&&h>-1&&h<a.rows.length;h++)a.rows[h].isVisible&&(s=0,r.autoSizeMode&AutoSizeMode.Headers&&(s=r._getDesiredRowHeight(l,h,i,c)),r.autoSizeMode&AutoSizeMode.Cells&&(s=Math.max(s,r._getDesiredRowHeight(a,h,i,c))),s+=n,a.rows[h].height=s>a.rows.defaultSize?s:null);r.cellFactory.disposeCell(i),wjcCore.removeChild(i)})},Object.defineProperty(t.prototype,"treeIndent",{get:function(){return this._indent},set:function(e){e!=this._indent&&(this._indent=wjcCore.asNumber(e,!1,!0),this.columns.onCollectionChanged())},enumerable:!0,configurable:!0}),t.prototype.collapseGroupsToLevel=function(e){var t=this;this.finishEditing()&&this.deferUpdate(function(){var o=t.rows;o.deferUpdate(function(){for(var t=0;t<o.length;t++){var i=o[t];i instanceof GroupRow&&(i.isCollapsed=i.level>=e)}})})},Object.defineProperty(t.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(e){(e=wjcCore.asEnum(e,SelectionMode))!=this.selectionMode&&(this._clearCells(),this._selHdl.selectionMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(e){this._selHdl.selection=e},enumerable:!0,configurable:!0}),t.prototype.select=function(e,t){void 0===t&&(t=!0),this._selHdl.select(e,t)},t.prototype.getSelectedState=function(e,t){return this.cells.getSelectedState(e,t,null)},Object.defineProperty(t.prototype,"selectedRows",{get:function(){var e=[];if(this.selectionMode==SelectionMode.ListBox)for(o=0;o<this.rows.length;o++)this.rows[o].isSelected&&e.push(this.rows[o]);else if(this.rows.length)for(var t=this.selection,o=t.topRow;o>-1&&o<=t.bottomRow;o++)e.push(this.rows[o]);return e},set:function(e){var t=this;wjcCore.assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode."),e=wjcCore.asArray(e),this.deferUpdate(function(){for(var o=0,i=!0;o<t.rows.length;o++){var n=t.rows[o],r=e&&e.indexOf(n)>-1;r&&i&&(i=!1,t.select(o,t.selection.col)),n.isSelected=r}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){for(var e=this.selectedRows,t=0;t<e.length;t++)e[t]=e[t].dataItem;return e},set:function(e){var t=this;wjcCore.assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode."),e=wjcCore.asArray(e),this.deferUpdate(function(){for(var o=0,i=!0;o<t.rows.length;o++){var n=t.rows[o],r=e&&e.indexOf(n.dataItem)>-1;r&&i&&(i=!1,t.select(o,t.selection.col)),n.isSelected=r}})},enumerable:!0,configurable:!0}),t.prototype.scrollIntoView=function(e,t,o){(null==this._maxOffsetY||this._rows._dirty||this._cols._dirty)&&this._updateLayout();var i=this.scrollPosition,n=this._szClient.width,r=this._szClient.height-this._gpCFtr.rows.getTotalSize(),s=this.cells._getFrozenPos();if((e=wjcCore.asInt(e))>-1&&e<this._rows.length&&e>=this._rows.frozen){var l=this._rows[e],a=this.cells.height>r?Math.round(l.pos/(this.cells.height-r)*100)/100:0,c=Math.round(this._maxOffsetY*a),h=l.pos-c,u=h+l.renderSize;u>r-i.y&&(i.y=Math.max(-h,r-u)),h-s.y<-i.y&&(i.y=-(h-s.y))}if((t=wjcCore.asInt(t))>-1&&t<this._cols.length&&t>=this._cols.frozen){var d=this._cols[t],g=d.pos+d.renderSize;g>-i.x+n&&(i.x=Math.max(-d.pos,n-g)),d.pos-s.x<-i.x&&(i.x=-(d.pos-s.x))}return!i.equals(this._ptScrl)&&(this.scrollPosition=i,o&&(this._updateScrollPosition(),this.refresh()),!0)},t.prototype.isRangeValid=function(e){return e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length},t.prototype.startEditing=function(e,t,o,i){return void 0===e&&(e=!0),this._edtHdl.startEditing(e,t,o,i)},t.prototype.finishEditing=function(e){return this._edtHdl.finishEditing(e)},Object.defineProperty(t.prototype,"activeEditor",{get:function(){return this._edtHdl.activeEditor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editRange",{get:function(){return this._edtHdl.editRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(e){e!=this._mrgMgr&&(this._mrgMgr=wjcCore.asType(e,MergeManager,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getMergedRange=function(e,t,o,i){return void 0===i&&(i=!0),this._mrgMgr?this._mrgMgr.getMergedRange(e,t,o,i):null},Object.defineProperty(t.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(e){this._keyHdl._kaTab=wjcCore.asEnum(e,KeyAction)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(e){this._keyHdl._kaEnter=wjcCore.asEnum(e,KeyAction)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._shDropDown},set:function(e){e!=this._shDropDown&&(this._shDropDown=wjcCore.asBoolean(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.toggleDropDownList=function(){this._tglDropDown||(this._tglDropDown=!0,this._edtHdl._toggleListBox(null),this._tglDropDown=!1)},t.prototype.onItemsSourceChanging=function(e){return this.itemsSourceChanging.raise(this,e),!e.cancel},t.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)},t.prototype.onScrollPositionChanged=function(e){this.scrollPositionChanged.raise(this,e)},t.prototype.onSelectionChanging=function(e){return this.selectionChanging.raise(this,e),!e.cancel},t.prototype.onSelectionChanged=function(e){this.selectionChanged.raise(this,e)},t.prototype.onLoadingRows=function(e){return this.loadingRows.raise(this,e),!e.cancel},t.prototype.onLoadedRows=function(e){this.loadedRows.raise(this,e)},t.prototype.onUpdatingLayout=function(e){return this.updatingLayout.raise(this,e),!e.cancel},t.prototype.onUpdatedLayout=function(e){this.updatedLayout.raise(this,e)},t.prototype.onResizingColumn=function(e){return this.resizingColumn.raise(this,e),!e.cancel},t.prototype.onResizedColumn=function(e){this.resizedColumn.raise(this,e)},t.prototype.onAutoSizingColumn=function(e){return this.autoSizingColumn.raise(this,e),!e.cancel},t.prototype.onAutoSizedColumn=function(e){this.autoSizedColumn.raise(this,e)},t.prototype.onDraggingColumn=function(e){return this.draggingColumn.raise(this,e),!e.cancel},t.prototype.onDraggingColumnOver=function(e){return this.draggingColumnOver.raise(this,e),!e.cancel},t.prototype.onDraggedColumn=function(e){this.draggedColumn.raise(this,e)},t.prototype.onResizingRow=function(e){return this.resizingRow.raise(this,e),!e.cancel},t.prototype.onResizedRow=function(e){this.resizedRow.raise(this,e)},t.prototype.onAutoSizingRow=function(e){return this.autoSizingRow.raise(this,e),!e.cancel},t.prototype.onAutoSizedRow=function(e){this.autoSizedRow.raise(this,e)},t.prototype.onDraggingRow=function(e){return this.draggingRow.raise(this,e),!e.cancel},t.prototype.onDraggingRowOver=function(e){return this.draggingRowOver.raise(this,e),!e.cancel},t.prototype.onDraggedRow=function(e){this.draggedRow.raise(this,e)},t.prototype.onGroupCollapsedChanging=function(e){return this.groupCollapsedChanging.raise(this,e),!e.cancel},t.prototype.onGroupCollapsedChanged=function(e){this.groupCollapsedChanged.raise(this,e)},t.prototype.onSortingColumn=function(e){return this.sortingColumn.raise(this,e),!e.cancel},t.prototype.onSortedColumn=function(e){this.sortedColumn.raise(this,e)},t.prototype.onBeginningEdit=function(e){return this.beginningEdit.raise(this,e),!e.cancel},t.prototype.onPrepareCellForEdit=function(e){this.prepareCellForEdit.raise(this,e)},t.prototype.onCellEditEnding=function(e){return this.cellEditEnding.raise(this,e),!e.cancel&&!e.stayInEditMode},t.prototype.onCellEditEnded=function(e){this.cellEditEnded.raise(this,e)},t.prototype.onRowEditStarting=function(e){this.rowEditStarting.raise(this,e)},t.prototype.onRowEditStarted=function(e){this.rowEditStarted.raise(this,e)},t.prototype.onRowEditEnding=function(e){this.rowEditEnding.raise(this,e)},t.prototype.onRowEditEnded=function(e){this.rowEditEnded.raise(this,e)},t.prototype.onRowAdded=function(e){return this.rowAdded.raise(this,e),!e.cancel},t.prototype.onDeletingRow=function(e){return this.deletingRow.raise(this,e),!e.cancel},t.prototype.onDeletedRow=function(e){this.deletedRow.raise(this,e)},t.prototype.onCopying=function(e){return this.copying.raise(this,e),!e.cancel},t.prototype.onCopied=function(e){this.copied.raise(this,e)},t.prototype.onPasting=function(e){return this.pasting.raise(this,e),!e.cancel},t.prototype.onPasted=function(e){this.pasted.raise(this,e)},t.prototype.onPastingCell=function(e){return this.pastingCell.raise(this,e),!e.cancel},t.prototype.onPastedCell=function(e){this.pastedCell.raise(this,e)},t.prototype.onFormatItem=function(e){this.formatItem.raise(this,e)},t.prototype.onUpdatingView=function(e){return this.updatingView.raise(this,e),!e.cancel},t.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)},t.prototype._getShowErrors=function(){return this.showErrors&&this._hasValidation},t.prototype._getHasValidation=function(){return this._hasValidation},t.prototype._getError=function(e,t,o){if(wjcCore.isFunction(this.itemValidator)){if(e==this.cells)return this.itemValidator(t,o);if(e==this.rowHeaders)for(o=0;o<this.columns.length;o++)if(c=this.itemValidator(t,o))return c}var i=this._cv,n=i?i.getError:null;if(wjcCore.isFunction(n)){var r=e.rows,s=this.columns,l=r[t].dataItem;if(l)for(;t<r.length&&r[t].dataItem==l;t++){if(e==this.cells)return n(l,(a=this._getBindingColumn(this.cells,t,s[o])).binding);if(e==this.rowHeaders)for(o=0;o<s.length;o++){var a=this._getBindingColumn(this.cells,t,s[o]),c=n(l,a.binding);if(c)return c}}}return null},t.prototype._setAria=function(e,t){wjcCore.setAttribute(this.cells.hostElement,"aria-"+e,t)},t.prototype._setFocus=function(e){if(this.hostElement&&(e||!this.containsFocus())){var t=wjcCore.getActiveElement(),o=this.activeEditor,i=this._activeCell,n=this._eFocus;o?wjcCore.contains(o,t)||(o.focus(),n.tabIndex=-1):i?wjcCore.contains(i,t)||t!=this._root&&(i.tabIndex=this._orgTabIndex,i.focus(),n.tabIndex=-1):wjcCore.contains(n,t)||t==this._root||(n.tabIndex=this._orgTabIndex,n.focus()),this.containsFocus()||(n.tabIndex=this._orgTabIndex,n.focus())}},t.prototype._setFocusNoScroll=function(e){if(e.tabIndex=this._orgTabIndex,wjcCore.supportsFocusOptions())e.focus({preventScroll:!0});else{var t=this.scrollPosition,o=e.style,i=o.position,n=o.opacity;o.opacity="0",o.position="fixed",e.focus(),o.position=i,o.opacity=n,this.scrollPosition=t}this._fixScroll()},t.prototype._getDefaultRowHeight=function(){var e=this._eFocus,t=null;e.offsetHeight||((t=wjcCore.createElement('<div><div class="wj-cell">0</div></div>',document.body)).setAttribute("class",this.hostElement.getAttribute("class")),e=t.children[0]);var o=e.offsetHeight;return(isNaN(o)||o<=6)&&(o=28),wjcCore.removeChild(t),o},t.prototype._getDefaultCellPadding=function(){var e=getComputedStyle(this._eFocus);return parseInt(this.rightToLeft?e.paddingRight:e.paddingLeft)},t.prototype._getCollectionView=function(e){return wjcCore.asCollectionView(e)},t.prototype._getCanvasContext=function(){var e=document.createElement("canvas").getContext("2d"),t=getComputedStyle(this.hostElement);return e.font=t.fontSize+" "+t.fontFamily.split(",")[0],e},t.prototype._getWidestRow=function(e,t,o,i){for(var n=0,r=0,s=e.columns[o].dataType==wjcCore.DataType.Boolean,l=t.row;l<=t.row2;l++)if(e.rows[l].isVisible){var a=e.getCellData(l,o,!0),c=i.measureText(a).width;if(c>r&&(r=c,n=l),s)break}return n},t.prototype._getDesiredWidth=function(e,t,o,i){var n=this.getMergedRange(e,t,o,!1),r=i.style;return this.cellFactory.updateCell(e,t,o,i,n),r.width=r.top=r.left="",i.offsetWidth/(n&&n.columnSpan>1?n.columnSpan:1)},t.prototype._getDesiredHeight=function(e,t,o,i){var n=this.getMergedRange(e,t,o,!1),r=i.style;return this.cellFactory.updateCell(e,t,o,i,n),r.height=r.top=r.left="",i.offsetHeight/(n&&n.rowSpan>1?n.rowSpan:1)},t.prototype._getDesiredRowHeight=function(e,t,o,i){for(var n=0,r=0;r<e.columns.length;r++){var s=e.columns[r];if(s.isVisible){var l=this.getMergedRange(e,t,r,!1),a=void 0;if(this._getQuickAutoSize()){var c={ct:e.cellType,col:r,rng:l&&l.rowSpan>1?l.rowSpan:1,content:s.dataType==wjcCore.DataType.Number?"1":e.getCellData(t,r,!0)},h=JSON.stringify(c);null==(a=i[h])&&(a=this._getDesiredHeight(e,t,r,o),i[h]=a)}else a=this._getDesiredHeight(e,t,r,o);n=Math.max(n,a)}}return n},t.prototype._getSortRowIndex=function(){return null!=this._sortRowIndex?this._sortRowIndex:this.columnHeaders.rows.length-1},t.prototype._sortConverter=function(e,t,o,i){var n;if(i){if(this._mappedColumns=null,this._cv)for(var r=this._cv.sortDescriptions,s=0;s<r.length;s++)(n=this.getColumn(r[s].property))&&n.dataMap&&(this._mappedColumns||(this._mappedColumns={}),this._mappedColumns[n.binding]=n.dataMap);this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1&&(n=this.columns[this._mouseHdl._htDown.col],this._mappedColumns&&n.dataMap&&(this._mappedColumns[n.binding]=n.dataMap))}if(this._mappedColumns){var l=this._mappedColumns[e.property];l&&l.sortByDisplayValues&&(o=l.getDisplayValue(o))}return o},t.prototype._bindGrid=function(e){var t=this;if(this.finishEditing(),this.deferUpdate(function(){0==t._lastCount&&wjcCore.hasItems(t._cv)&&(e=!0);var o,i=t.selectionMode==SelectionMode.ListBox;t.preserveSelectedState&&i&&!t.childItemsPath&&(o=t.selectedItems);var n;if(t.preserveOutlineState&&wjcCore.isFunction(window.Map)&&t.rows.maxGroupLevel>-1){n=new Map;for(h=0;h<t.rows.length;h++){var r=t.rows[h];if(r instanceof GroupRow&&r.isCollapsed&&r.dataItem){var s=r.dataItem;s instanceof wjcCore.CollectionViewGroup&&(s=s._path),n.set(s,!0)}}}e&&t.columns.deferUpdate(function(){t._bindColumns()});var l=new wjcCore.CancelEventArgs;t.onLoadingRows(l)&&(t.rows.deferUpdate(function(){t._bindRows()}),t.onLoadedRows(l));var a=0;if(o&&o.length)for(h=0;h<t.rows.length&&a<o.length;h++)o.indexOf(t.rows[h].dataItem)>-1&&(t.rows[h].isSelected=!0,a++);if(i&&0==a&&t._lastCount>0)for(var c=t.selection,h=c.topRow;h<=c.bottomRow&&h>-1&&h<t.rows.length;h++)t.rows[h].isSelected=!0;n&&t.rows.deferUpdate(function(){for(var e=0;e<t.rows.length;e++){var o=t.rows[e];if(o instanceof GroupRow){var i=o.dataItem;i instanceof wjcCore.CollectionViewGroup&&(i=i._path),n.get(i)&&(o.isCollapsed=!0)}}}),!t._lastCount&&t._cv&&t._cv.items&&(t._lastCount=t._cv.items.length)}),!this.rows.length){var o=this._selHdl.selection;o.row=o.row2=-1}this._cv&&setTimeout(function(){t._syncSelection(e)})},t.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var o=wjcCore.NotifyCollectionChangedAction;if(this.childItemsPath&&t.action!=o.Change)this._bindGrid(!1);else{switch(t.action){case o.Change:return void this.invalidate();case o.Add:if(t.index==this._cv.items.length-1){var i=this.rows.length;return this.rows[i-1]instanceof _NewRowTemplate&&i--,void this.rows.insert(i,new Row(t.item))}wjcCore.assert(!1,"added item should be the last one.");break;case o.Remove:var n=this._findRow(t.item);if(n>-1)return this.rows.removeAt(n),void this._syncSelection(!1);wjcCore.assert(!1,"removed item not found on grid.")}this._bindGrid(!1)}}},t.prototype._cvCurrentChanged=function(e,t){this._syncSelection(!1)},t.prototype._syncSelection=function(e){if(this._cv&&this.selectionMode!=SelectionMode.None){var t=this.selection,o=t.row>-1&&t.row<this.rows.length?this.rows[t.row]:null,i=o?o.dataItem:null;if(this.newRowAtTop&&o instanceof _NewRowTemplate&&(i=null),i instanceof wjcCore.CollectionViewGroup&&(i=null),(i!=this._cv.currentItem||e)&&(!this.childItemsPath||!this.editableCollectionView||!this.editableCollectionView.currentAddItem)){var n=this._getRowIndex(this._cv.currentPosition);n==t.row&&this.childItemsPath||(t.row=t.row2=n,this.select(t,!1),this.selectionMode&&this.scrollIntoView(t.row,-1))}}},t.prototype._getRowIndex=function(e){if(this._cv){if(e>-1){for(var t=this._cv.items[e];e<this.rows.length;e++)if(this.rows[e].dataItem===t)return e;return-1}if(1==this.rows.length&&this.rows[0]instanceof _NewRowTemplate)return 0;var o=this.selection.row,i=o>-1?this.rows[o]:null;return i&&(i instanceof GroupRow||null==i.dataItem)?o:-1}return this.selection.row},t.prototype._getCvIndex=function(e){if(this._cv&&e>-1&&e<this.rows.length){var t=this._cv.items,o=this.rows[e].dataItem;for(e=Math.min(e,t.length-1);e>-1;e--)if(t[e]===o)return e}return-1},t.prototype._findRow=function(e){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==e)return t;return-1},t.prototype._updateLayout=function(){var e=new wjcCore.CancelEventArgs;if(this.onUpdatingLayout(e)){var o=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,i=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,n=this._ftrRows.getTotalSize(),r=this._rows.getTotalSize()+n;r<1&&(r=1),this._heightBrowser=Math.min(r,t._getMaxSupportedCssHeight()),this._maxOffsetY=Math.max(0,r-this._heightBrowser),this._cellPadding=this._getDefaultCellPadding();var s=this._heightBrowser+i-n,l=this._gpCells.width,a=this._heightBrowser;!l&&this.rows.length&&(l=.1),!a&&this.columns.length&&(a=.1),this.rightToLeft?(wjcCore.setCss(this._eTL,{right:0,top:0,width:o,height:i}),wjcCore.setCss(this._eCHdr,{right:o,top:0,height:i}),wjcCore.setCss(this._eRHdr,{right:0,top:i,width:o}),wjcCore.setCss(this._eCt,{right:o,top:i,width:l,height:a}),wjcCore.setCss(this._fCt,{right:o,top:i}),wjcCore.setCss(this._eBL,{right:0,top:s,width:o,height:n}),wjcCore.setCss(this._eCFtr,{right:o,top:s,height:n})):(wjcCore.setCss(this._eTL,{left:0,top:0,width:o,height:i}),wjcCore.setCss(this._eCHdr,{left:o,top:0,height:i}),wjcCore.setCss(this._eRHdr,{left:0,top:i,width:o}),wjcCore.setCss(this._eCt,{left:o,top:i,width:l,height:a}),wjcCore.setCss(this._fCt,{left:o,top:i}),wjcCore.setCss(this._eBL,{left:0,top:s,width:o,height:n}),wjcCore.setCss(this._eCFtr,{left:o,top:s,height:n})),this._stickyHdr&&this._updateStickyHeaders();var c=this.frozenRows||this.frozenColumns?"3":"";wjcCore.setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:c});var h=this._root,u=h.offsetWidth-h.clientWidth,d=h.offsetHeight-h.clientHeight;wjcCore.setCss(this._eSz,{width:o+u+this._gpCells.width,height:i+d+this._heightBrowser});var g=null;this.columns._updateStarSizes(h.clientWidth-o)&&(g=h.clientWidth,wjcCore.setCss(this._eCt,{width:this._gpCells.width})),this._szClient=new wjcCore.Size(h.clientWidth-o,h.clientHeight-i),this._rcBounds=null,this._updateScrollHandler(),this._updateContent(!1),u=h.offsetWidth-h.clientWidth,d=h.offsetHeight-h.clientHeight,wjcCore.setCss(this._eSz,{width:o+u+this._gpCells.width,height:i+d+this._heightBrowser}),this._szClient=new wjcCore.Size(h.clientWidth-o,h.clientHeight-i),g&&g!=h.clientWidth&&this.columns._updateStarSizes(h.clientWidth-o)&&(wjcCore.setCss(this._eCt,{width:this._gpCells.width}),this._updateContent(!1)),wjcCore.setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width}),wjcCore.setCss([this._eRHdr,this._fCt],{height:this._szClient.height}),n&&(s=Math.min(s,this._szClient.height+i-n),wjcCore.setCss([this._eBL,this._eCFtr],{top:s})),this.onUpdatedLayout(e)}},t.prototype._updateStickyHeaders=function(){var e=!1,o=0;if(this._stickyHdr){for(var i=0,n=null,r=this.hostElement;r;r=r.parentElement){var s=r.getBoundingClientRect();null==n&&(n=s.top),i=Math.max(i,s.top)}o=-(n=Math.max(0,i-n-1)),e=n>0,this._rcBounds=null}this._eTL.style.top=this._eCHdr.style.top=e?-o+"px":"",wjcCore.toggleClass(this._eTL,t._WJS_STICKY,e),wjcCore.toggleClass(this._eCHdr,t._WJS_STICKY,e)},t.prototype._updateScrollHandler=function(){this._clipToScreen=this._getClipToScreen();var e=this._stickyHdr||this._clipToScreen;e!=this._scrollHandlerAttached&&(this._scrollHandlerAttached=e,e?this.addEventListener(window,"scroll",this._scroll.bind(this),!0):this.removeEventListener(window,"scroll"))},t.prototype._getClipToScreen=function(){if(this.rows.length<=t._MIN_VIRT_ROWS)return!1;if(this._root.clientHeight!=this._root.scrollHeight)return!1;for(var e=this.hostElement;e&&e!=document.documentElement;e=e.parentElement)if("auto"==getComputedStyle(e).overflow)return!1;return!0},t.prototype._scroll=function(e){var t=this;wjcCore.contains(e.target,this.hostElement)&&(this._clipToScreen&&(this._afScrl&&cancelAnimationFrame(this._afScrl),this._afScrl=requestAnimationFrame(function(){t._afScrl=null,t.finishEditing(),t._updateContent(!0)})),this._stickyHdr&&(this._afSticky&&cancelAnimationFrame(this._afSticky),this._afSticky=requestAnimationFrame(function(){t._afSticky=null;var e=new wjcCore.CancelEventArgs;t.onUpdatingLayout(e)&&(t._updateStickyHeaders(),t.onUpdatedLayout(e))})))},t.prototype._updateScrollPosition=function(){var e=this._root,o=e.scrollTop,i=e.scrollLeft;this.rightToLeft&&"rev"==t._getRtlMode()&&(i=e.scrollWidth-e.clientWidth-i);var n=new wjcCore.Point(-Math.abs(i),-o);return!this._ptScrl.equals(n)&&(this._ptScrl=n,this.onScrollPositionChanged(),!0)},t.prototype._updateContent=function(e,t){var o=this._root,i=this.hostElement,n=this.cells.hostElement,r=wjcCore.getActiveElement(),s=wjcCore.contains(i,r)?r:null,l=this._activeCell,a=new wjcCore.CancelEventArgs;if(this.onUpdatingView(a)){if(wjcCore.setAttribute(n,"role",this.rows.maxGroupLevel<0?"grid":"treegrid"),this._hasValidation=wjcCore.isFunction(this._itemValidator)||this._cv&&wjcCore.isFunction(this._cv.getError),this._offsetY=0,this._heightBrowser>this._szClient.height){var c=Math.round(-this._ptScrl.y/(this._heightBrowser-this._szClient.height)*100)/100;this._offsetY=Math.round(this._maxOffsetY*c)}this._updateScrollPosition();var h=this._gpCells._updateContent(e,t,this._offsetY);if(this._hdrVis&HeadersVisibility.Column&&(!t||this._ssHdr&HeadersVisibility.Column)&&this._gpCHdr._updateContent(e,t,0),this._hdrVis&HeadersVisibility.Row&&(!t||this._ssHdr&HeadersVisibility.Row)&&this._gpRHdr._updateContent(e,t,this._offsetY),this._hdrVis&&!t&&this._gpTL._updateContent(e,t,0),this._gpCFtr.rows.length&&(this._gpBL._updateContent(e,t,0),this._gpCFtr._updateContent(e,t,0)),this.showMarquee){var u=this._selHdl.selection,d=this._eMarquee;if(this.isRangeValid(u)){var g=this._getMarqueeRect(u),p=d.firstChild,f=d.offsetWidth-p.offsetWidth,w=d.offsetHeight-p.offsetHeight;wjcCore.setCss(d,{left:g.left+n.offsetLeft-f/2,top:g.top+n.offsetTop-w/2,width:g.width+f,height:g.height+w,visibility:g.width>0&&g.height>0?"":"collapse"})}else wjcCore.setCss(d,{left:0,top:0,width:0,height:0,visibility:"collapse"})}if(this._useFrozenDiv()&&(this._updateFrozenCells(t),h&&wjcCore.hasClass(h,"wj-frozen")&&(h=null)),this._fCt.style.display=this._fCt.childElementCount?"":"none",this._activeCell=h,s)if(s!=o&&s!=this._eFocus&&wjcCore.contains(i,s)&&!wjcCore.contains(n,s)){if(wjcCore.getActiveElement()!=s&&s.focus(),wjcCore.isIE()&&s instanceof HTMLInputElement&&!s.type.match(/checkbox|radio|range/i)){var _=s.selectionStart,C=s.selectionEnd;s.setSelectionRange(_,C)}}else{var m=h!=l;this._setFocus(m)}!s&&h&&(h.tabIndex=this._orgTabIndex),l&&l!=h&&(l.tabIndex=-1),this._fixScroll(),this._rcBounds=null,this.onUpdatedView(a)}},t.prototype._fixScroll=function(){if(!this._updating){var e=this.hostElement,t=this._root?this._root.parentElement:null;e&&e.scrollTop&&(e.scrollTop=0),t&&t.scrollTop&&(t.scrollTop=0)}},t.prototype._clearCells=function(){for(var e in this)if("_"==e[0]){var t=this[e];t instanceof GridPanel&&t._clearCells()}this.invalidate()},t.prototype._useFrozenDiv=function(){return wjcCore.isBoolean(this._fzClone)?this._fzClone:wjcCore.isIE()||wjcCore.isFirefox()||wjcCore.isSafari()||wjcCore.isMobile()},t.prototype._updateFrozenCells=function(e){var t=this._fCt;if(this.frozenRows||this.frozenColumns){var o=this._eCt.querySelectorAll(".wj-frozen");if(e&&t.children.length==o.length){for(i=0;i<o.length;i++)t.children[i].className=o[i].className;return}if(wjcCore.setText(t,null),!this.activeEditor)for(var i=0;i<o.length;i++){var n=o[i];wjcCore.closest(n,".wj-flexgrid")==this.hostElement&&(n=o[i].cloneNode(!0),t.appendChild(n))}}else wjcCore.setText(t,null)},t.prototype._getMarqueeRect=function(e){var t=this.getMergedRange(this.cells,e.topRow,e.leftCol)||new CellRange(e.topRow,e.leftCol),o=this.getMergedRange(this.cells,e.bottomRow,e.rightCol)||new CellRange(e.bottomRow,e.rightCol),i=this.cells.getCellBoundingRect(t.topRow,t.leftCol,!0),n=this.cells.getCellBoundingRect(o.bottomRow,o.rightCol,!0);if(this.rows.frozen){var r=Math.min(this.rows.length,this.rows.frozen),s=this.cells.getCellBoundingRect(r-1,0,!0);e.topRow>=r&&i.top<s.bottom&&(i.top=s.bottom),e.bottomRow>=r&&n.bottom<s.bottom&&(n.height=s.bottom-n.top)}if(this.columns.frozen){var l=Math.min(this.columns.length,this.columns.frozen),s=this.cells.getCellBoundingRect(0,l-1,!0);this.rightToLeft?(e.leftCol>=l&&i.right>s.left&&(i.left=s.left-i.width),e.rightCol>=l&&n.left>s.left&&(n.left=s.left)):(e.leftCol>=l&&i.left<s.right&&(i.left=s.right),e.rightCol>=l&&n.right<s.right&&(n.width=s.right-n.left))}return this.rightToLeft?new wjcCore.Rect(n.left,i.top,i.right-n.left,n.bottom-i.top):new wjcCore.Rect(i.left,i.top,n.right-i.left,n.bottom-i.top)},t.prototype._bindColumns=function(){for(var e=0;e<this.columns.length;e++)(l=this.columns[e])._getFlag(RowColFlags.AutoGenerated)&&(this.columns.removeAt(e),e--);var t=this._cv,o=t?t.sourceCollection:null,i=o&&o.length?o[0]:null;if(i&&this.autoGenerateColumns)for(var n in i)for(var r=null,s=0;s<o.length&&s<1e3&&null==r;s++)if(r=o[s][n],wjcCore.isPrimitive(r)){var l=new Column;l._setFlag(RowColFlags.AutoGenerated,!0),l.binding=l.name=n,l.header=wjcCore.toHeaderCase(n),l.dataType=wjcCore.getType(r),l.dataType==wjcCore.DataType.Number&&(l.width=80);var a=Object.getOwnPropertyDescriptor(i,n);!a||a.writable||wjcCore.isFunction(a.set)||l._setFlag(RowColFlags.ReadOnly,!0),this.columns.push(l)}this._updateColumnTypes()},t.prototype._updateColumnTypes=function(){var e=this._cv;if(wjcCore.hasItems(e))for(var t=e.items[0],o=this.columns,i=0;i<o.length;i++){var n=o[i];null==n.dataType&&n._binding&&(n.dataType=wjcCore.getType(n._binding.getValue(t)))}},t.prototype._getBindingColumn=function(e,t,o){return o},t.prototype._getRowHeaderPath=function(){return this._rowHdrPath},t.prototype._bindRows=function(){this.rows.clear();var e=this._cv;if(e&&e.items){var t=e.items,o=e.groups;if(this.childItemsPath)for(i=0;i<t.length;i++)this._addNode(t,i,0);else if(null!=o&&o.length>0&&this.showGroups)for(i=0;i<o.length;i++)this._addGroup(o[i]);else for(var i=0;i<t.length;i++)this._addBoundRow(t,i)}},t.prototype._addBoundRow=function(e,t){this.rows.push(new Row(e[t]))},t.prototype._addNode=function(e,t,o){var i=new GroupRow,n=this.childItemsPath,r=wjcCore.isArray(n)?n[o]:n,s=e[t],l=s[r];if(i.dataItem=s,i.level=o,this.rows.push(i),wjcCore.isArray(l))for(var a=0;a<l.length;a++)this._addNode(l,a,o+1)},t.prototype._addGroup=function(e){var t=new GroupRow;if(t.level=e.level,t.dataItem=e,this.rows.push(t),e.isBottomLevel)for(var o=e.items,i=0;i<o.length;i++)this._addBoundRow(o,i);else for(i=0;i<e.groups.length;i++)this._addGroup(e.groups[i])},t._getSerializableProperties=function(e){var t=[];for(e=e.prototype;e!=Object.prototype;e=Object.getPrototypeOf(e))for(var o=Object.getOwnPropertyNames(e),i=0;i<o.length;i++){var n=o[i],r=Object.getOwnPropertyDescriptor(e,n);r&&r.set&&r.get&&"_"!=n[0]&&!n.match(/disabled|required/)&&t.push(n)}return t},t.prototype._copy=function(e,t){if("columns"==e){this.columns.clear();for(var o=wjcCore.asArray(t),i=0;i<o.length;i++){var n=new Column;wjcCore.copy(n,o[i]),this.columns.push(n)}return!0}return!1},t.prototype._isInputElement=function(e){if(e instanceof HTMLElement&&!wjcCore.hasClass(e,"wj-btn-glyph")){if("true"==e.contentEditable)return!0;var t=e.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION)$/i);return t&&t.length>0}return!1},t.prototype._wantsInput=function(e){return this._isInputElement(e)&&!this.activeEditor&&!this._edtHdl._isNativeCheckbox(e)&&!wjcCore.hasClass(e,"wj-grid-ime")&&wjcCore.contains(document.body,e)},t._getMaxSupportedCssHeight=function(){if(!t._maxCssHeight){var e=335e5;wjcCore.isIE()?e=15e5:wjcCore.isFirefox()&&(e=175e5),t._maxCssHeight=e}return t._maxCssHeight},t._getRtlMode=function(){if(!t._rtlMode){var e=wjcCore.createElement('<div dir="rtl" style="visibility:hidden;width:100px;height:100px;overflow:auto"><div style="width:2000px;height:2000px"></div></div>');document.body.appendChild(e);var o=e.scrollLeft;e.scrollLeft=-1e3;var i=e.scrollLeft;wjcCore.removeChild(e),t._rtlMode=i<0?"neg":o>0?"rev":"std"}return t._rtlMode},t._WJS_STICKY="wj-state-sticky",t._WJS_MEASURE="wj-state-measuring",t._WJS_UPDATING="wj-state-updating",t._MIN_VIRT_ROWS=200,t.controlTemplate='<div style="position:relative;width:100%;height:100%;overflow:hidden;max-width:inherit;max-height:inherit"><div wj-part="root" style="position:absolute;width:100%;height:100%;overflow:auto;max-width:inherit;max-height:inherit;-webkit-overflow-scrolling:touch;"><div wj-part="cells" class="wj-cells" style="position:absolute"></div><div wj-part="marquee" class="wj-marquee" style="display:none;pointer-events:none;"><div style="width:100%;height:100%"></div></div></div><div wj-part="fcells" aria-hidden="true" class="wj-cells wj-frozen-clone" style="position:absolute;pointer-events:none;overflow:hidden"></div><div wj-part="rh"><div wj-part="rhcells" class="wj-rowheaders"></div></div><div wj-part="cf"><div wj-part="cfcells" class="wj-colfooters"></div></div><div wj-part="ch"><div wj-part="chcells" class="wj-colheaders"></div></div><div wj-part="bl"><div wj-part="blcells" class="wj-bottomleft"></div></div><div wj-part="tl"><div wj-part="tlcells" class="wj-topleft"></div></div><div wj-part="focus" class="wj-cell" style="position:fixed;left:-32000px">0</div><div wj-part="sz" style="position:relative;visibility:hidden"></div></div>',t}(wjcCore.Control);exports.FlexGrid=FlexGrid;var CellRangeEventArgs=function(e){function t(t,o,i){var n=e.call(this)||this;return n._p=wjcCore.asType(t,GridPanel,!0),n._rng=wjcCore.asType(o,CellRange,!0),n._data=i,n}return __extends(t,e),Object.defineProperty(t.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),t}(wjcCore.CancelEventArgs);exports.CellRangeEventArgs=CellRangeEventArgs;var FormatItemEventArgs=function(e){function t(t,o,i){var n=e.call(this,t,o)||this;return n._cell=wjcCore.asType(i,HTMLElement),n}return __extends(t,e),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),t}(CellRangeEventArgs);exports.FormatItemEventArgs=FormatItemEventArgs;var CellEditEndingEventArgs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stayInEditMode=!1,t._refresh=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(e){this._stayInEditMode=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refresh",{get:function(){return this._refresh},set:function(e){this._refresh=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),t}(CellRangeEventArgs);exports.CellEditEndingEventArgs=CellEditEndingEventArgs;var CellType;!function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.TopLeft=4]="TopLeft",e[e.ColumnFooter=5]="ColumnFooter",e[e.BottomLeft=6]="BottomLeft"}(CellType=exports.CellType||(exports.CellType={}));var GridPanel=function(){function e(e,t,o,i,n){this._offsetY=0,this._g=wjcCore.asType(e,FlexGrid),this._ct=wjcCore.asInt(t),this._rows=wjcCore.asType(o,RowCollection),this._cols=wjcCore.asType(i,ColumnCollection),this._e=wjcCore.asType(n,HTMLElement),this._vrb=new CellRange}return Object.defineProperty(e.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),e.prototype.getCellData=function(e,t,o){var i,n=this._rows[wjcCore.asNumber(e,!1,!0)],r=null;if(wjcCore.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";i=this._cols[wjcCore.asNumber(t,!1,!0)];var s=this._g?this._g._getBindingColumn(this,e,i):i;if(!s.binding||!n.dataItem||n.dataItem instanceof wjcCore.CollectionViewGroup?n._ubv&&(r=n._ubv[i._hash]):r=s._binding.getValue(n.dataItem),null==r)switch(this._ct){case CellType.ColumnHeader:e!=this._rows.length-1&&s==i||(r=s.header);break;case CellType.ColumnFooter:if(s.aggregate!=wjcCore.Aggregate.None&&n instanceof GroupRow){var l=this._g.collectionView;if(l){var a=wjcCore.tryCast(l,wjcCore.CollectionView);r=a?a.getAggregate(s.aggregate,s.binding):wjcCore.getAggregate(s.aggregate,l.items,s.binding)}}break;case CellType.Cell:if(s.aggregate!=wjcCore.Aggregate.None&&n instanceof GroupRow){var c=wjcCore.tryCast(n.dataItem,wjcCore.CollectionViewGroup);c&&(r=c.getAggregate(s.aggregate,s.binding,this._g.collectionView))}}return o&&(this.cellType==CellType.Cell&&s.dataMap&&(r=s.dataMap.getDisplayValue(r)),r=null!=r?wjcCore.Globalize.format(r,s.format):""),r},e.prototype.setCellData=function(e,t,o,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0);var r,s=this._rows[wjcCore.asNumber(e,!1,!0)];if(wjcCore.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";r=this._cols[wjcCore.asNumber(t,!1,!0)];var l=this._g?this._g._getBindingColumn(this,e,r):r;if(this._ct==CellType.Cell){if(l.dataMap&&null!=o&&(l.isRequired||""!=o)){var a=l.dataMap,c=a.getKeyValue(o);if(null==c&&null==a.getDisplayValue(null)){if(a.getDisplayValue(o)!=o);else if(!a.isEditable||a.displayMemberPath!=a.selectedValuePath)return!1}else o=c}var h=wjcCore.DataType.Object;if(l.dataType)h=l.dataType;else{var u=this.getCellData(e,t,!1);h=wjcCore.getType(u)}if(wjcCore.isBoolean(l.isRequired))if(l.isRequired||""!==o&&null!==o){if(l.isRequired&&(""===o||null===o))return!1}else o=null,i=!1;if(i&&(o=wjcCore.changeType(o,h,l.format),h!=wjcCore.DataType.Object&&wjcCore.getType(o)!=h))return!1}if(s.dataItem&&l.binding){var d=l._binding,g=s.dataItem,p=d.getValue(g);if(o!==p&&!wjcCore.DateTime.equals(o,p)){d.setValue(g,o);var f=this._g.collectionView;if(f instanceof wjcCore.CollectionView&&g!=f.currentEditItem){var w=new wjcCore.NotifyCollectionChangedEventArgs(wjcCore.NotifyCollectionChangedAction.Change,g,f.items.indexOf(g));f.onCollectionChanged(w)}}}else s._ubv||(s._ubv={}),s._ubv[r._hash]=o;return n&&this._g&&this._g.invalidate(),!0},e.prototype.getCellBoundingRect=function(e,t,o){var i=this.rows[e],n=this.columns[t],r=new wjcCore.Rect(n.pos,i.pos,n.renderSize,i.renderSize);if(this._g.rightToLeft&&(r.left=this.hostElement.clientWidth-r.right,!wjcCore.isIE()&&!wjcCore.isFirefox())){var s=this.hostElement.parentElement;r.left-=s.offsetWidth-s.clientWidth}if(!o){var l=this.hostElement.getBoundingClientRect();r.left+=l.left,r.top+=l.top-this._offsetY}return e<this.rows.frozen&&(r.top-=this._g.scrollPosition.y),t<this.columns.frozen&&(r.left-=this._g.scrollPosition.x*(this._g.rightToLeft?-1:1)),r},e.prototype.getCellElement=function(t,o){for(var i=this.hostElement.children,n=Math.min(t+2,i.length),r=0;r<n;r++)for(var s=i[r].children,l=Math.min(o+2,s.length),a=0;a<l;a++){var c=s[a],h=c[e._INDEX_KEY];if(h&&(h.row==t&&h.col==o||h.rng&&h.rng.contains(t,o)))return c}return null},e.prototype.getSelectedState=function(e,t,o){var i=this._g,n=i.selectionMode,r=i._selHdl.selection,s=SelectionMode,l=SelectedState;if(n!=s.None)switch(this._ct){case CellType.Cell:if(o||(o=i.getMergedRange(this,e,t)),o){if(o.contains(r.row,r.col))return i.showMarquee?l.None:l.Cursor;if(o.intersects(r))return l.Selected}if(r.row==e&&r.col==t)return i.showMarquee?l.Active:l.Cursor;if(i.rows[e].isSelected||i.columns[t].isSelected)return l.Selected;if(o)switch(n){case s.Row:case s.RowRange:case s.ListBox:if(o.containsRow(r.row))return l.Selected}return r=i._selHdl._adjustSelection(r),n==SelectionMode.ListBox?l.None:r.containsRow(e)&&r.containsColumn(t)?l.Selected:l.None;case CellType.ColumnHeader:if(i.showSelectedHeaders&HeadersVisibility.Column&&(i.columns[t].isSelected||r.containsColumn(t)||r.intersectsColumn(o))&&(o&&(e=o.bottomRow),e==this.rows.length-1))return l.Selected;break;case CellType.RowHeader:if(i.showSelectedHeaders&HeadersVisibility.Row&&(i.rows[e].isSelected||r.containsRow(e)||r.intersectsRow(o))&&(o&&(t=o.rightCol),t==this.columns.length-1))return l.Selected}return l.None},Object.defineProperty(e.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0}),e.prototype._getOffsetY=function(){return this._offsetY},e.prototype._updateContent=function(e,t,o){var i=this._g,n=this._e,r=this._rows,s=this._cols,l=this._ct;if(l==CellType.ColumnHeader||l==CellType.ColumnFooter||l==CellType.RowHeader){var a=i._ptScrl,c=n.style;l==CellType.RowHeader?c.top=a.y+"px":i.rightToLeft?c.right=a.x+"px":c.left=a.x+"px"}this._offsetY!=o&&(e=!1,this._offsetY=o);var h=this._getViewRange(),u=h;if(u.isValid){var d=i.isTouching,g=r.length<=i._vtRows?1e7:d?6:0,p=s.length<=i._vtCols?1e7:d?1:0;u=new CellRange(Math.max(h.row-g,r.frozen),Math.max(h.col-p,s.frozen),Math.min(h.row2+g,r.length-1),Math.min(h.col2+p,s.length-1))}if(e&&!t&&this._vrb.contains(h)&&!r.frozen&&!s.frozen)return this._activeCell;e&&u.equals(this._vrb)||(t=!1),e&&!t&&this._ct!=CellType.TopLeft&&this._reorderCells(u,this._vrb),this._activeCell=null,this._vru=h,this._vrb=u,this._cf=i.cellFactory;var f=0;this._ct==CellType.Cell&&(f=this._renderColHdrRow(u,t));for(w=0;w<r.frozen&&w<r.length;w++)f=this._renderRow(w,u,t,f);for(var w=u.topRow;w<=u.bottomRow&&w>-1;w++)f=this._renderRow(w,u,t,f);for(;n.childElementCount>f;){var _=n.lastElementChild;n.removeChild(_),this._removeExtraCells(_,0)}return this._activeCell},e.prototype._updateScrollPosition=function(){var e=this._g,t=e._ptScrl,o=this.hostElement.style;this.cellType==CellType.RowHeader?o.top=t.y+"px":e.rightToLeft?o.right=t.x+"px":o.left=t.x+"px"},e.prototype._clearCells=function(){for(var e=this.hostElement,t=e.childElementCount-1;t>=0;t--){var o=e.children[t];e.removeChild(o);for(var i=o.childElementCount-1;i>=0;i--)this._cf.disposeCell(o.children[i])}},e.prototype._reorderCells=function(e,t){if(!(this._rows.frozen>0||this._cols.frozen>0||e.columnSpan!=t.columnSpan||e.rowSpan!=t.rowSpan)&&t.isValid&&e.isValid&&e.intersects(t)&&e.row!=t.row){var o=e.row-t.row,i=Math.max(1,e.rowSpan-1),n=this._e;if(0!=o&&Math.abs(o)<i){var r=this._ct==CellType.Cell?1:0,s=n.childElementCount;if(o>0){var l=r,a=Math.min(r+o,s-1);(c=this._createRange(l,a))&&a<s-1&&n.appendChild(c.extractContents())}if(o<0){var a=s,l=Math.max(r,a+o),c=this._createRange(l,a);if(c&&l>r){var h=n.children[r];n.insertBefore(c.extractContents(),h)}}}}},e.prototype._createRange=function(e,t){var o,i=this._e.childElementCount;return t>e&&t<=i&&e>-1&&((o=document.createRange()).setStart(this._e,e),o.setEnd(this._e,t)),o},e.prototype._renderColHdrRow=function(e,t){var o=this._e.children[0];o||(o=wjcCore.createElement('<div class="wj-row" role="row"></div>',this._e));var i=this._g,n=i?i.columnHeaders.rows.ariaLabel:null;wjcCore.setAttribute(o,"aria-label",n),wjcCore.setAttribute(o,"aria-selected",null);var r=0,s=this._g._getRowHeaderPath();s&&(r=this._renderRowHdrCell(o,-1,s.path));for(l=0;l<this.columns.frozen&&l<this.columns.length;l++)r=this._renderColHdrCell(o,l,e,t,r);for(var l=e.leftCol;l<=e.rightCol&&l>-1;l++)r=this._renderColHdrCell(o,l,e,t,r);return this._removeExtraCells(o,r),1},e.prototype._renderColHdrCell=function(t,o,i,n,r){var s=this.columns[o];if(s.renderSize<=0)return r;if(n)return r+1;var l=t.children[r];l||(l=wjcCore.createElement('<div class="wj-cell" tabindex="-1"></div>',t)),wjcCore.setAttribute(l,"role","columnheader"),l.textContent=this.columns[o].header,wjcCore.setCss(l,{position:"fixed",top:-32e3,height:.1,left:s.pos,width:s.renderWidth,overflow:"hidden",opacity:"0",pointerEvents:"none"});var a=[s.describedById,this.columns.describedById].join(" ").trim();wjcCore.setAttribute(l,"aria-describedby",a||null);var c=this.grid;if(c.allowSorting){var h="none";switch(c._getBindingColumn(this,0,s).currentSort){case"+":h="ascending";break;case"-":h="descending"}wjcCore.setAttribute(l,"aria-sort",h)}return c.isReadOnly||(wjcCore.setAttribute(l,"aria-readonly",s.isReadOnly),wjcCore.setAttribute(l,"aria-required",s.getIsRequired())),l[e._INDEX_KEY]={row:-1,col:o,panel:this},r+1},e.prototype._renderRowHdrCell=function(t,o,i){var n=t.children[0];return n||(n=wjcCore.createElement('<div class="wj-cell" tabindex="-1"></div>',t)),n.setAttribute("role",o<0?"columnheader":"rowheader"),n.textContent=i?i.toString():"",wjcCore.setCss(n,{position:"fixed",left:-32e3,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"}),n[e._INDEX_KEY]={row:o,col:-1,panel:this},1},e.prototype._renderRow=function(e,t,o,i){var n=this._g,r=this.rows[e];if(r.renderSize<=0)return i;var s=this._e.children[i];if(s||(s=wjcCore.createElement('<div class="wj-row"></div>',this._e)),this._ct==CellType.Cell){s.setAttribute("role","row");var l=SelectionMode;switch(n.selectionMode){case l.Row:case l.RowRange:case l.ListBox:var a=r.isSelected||this._g._selHdl.selection.containsRow(e);wjcCore.setAttribute(s,"aria-selected",!!a)}wjcCore.setAttribute(s,"aria-level",r instanceof GroupRow?r.level+1:null),wjcCore.setAttribute(s,"aria-expanded",r instanceof GroupRow?!r.isCollapsed:null),this.rows.ariaLabel&&wjcCore.setAttribute(s,"aria-label",this.rows.ariaLabel)}var c=0;if(this._ct==CellType.Cell){var h=this._g._getRowHeaderPath();h&&(c=this._renderRowHdrCell(s,e,h.getValue(r.dataItem)))}for(u=0;u<this.columns.frozen&&u<this.columns.length;u++)c=this._renderCell(s,e,u,t,o,c);for(var u=t.leftCol;u<=t.rightCol&&u>-1;u++)c=this._renderCell(s,e,u,t,o,c);return this._removeExtraCells(s,c),i+1},e.prototype._renderCell=function(t,o,i,n,r,s){var l=this._g,a=l.getMergedRange(this,o,i);if(a){for(c=Math.max(n.row,a.row);c<o;c++)if(this.rows[c].isVisible)return s;for(var c=Math.max(n.col,a.col);c<i;c++)if(this.columns[c].isVisible)return s}var h=this.columns[i];if(h.renderSize<=0&&(!a||a.getRenderSize(this).width<=0))return s;var u=t.children[s],d=SelectedState,g=this.getSelectedState(o,i,a),p=g==d.Cursor||g==d.Active;return u&&r?(wjcCore.toggleClass(u,"wj-state-active",p),wjcCore.toggleClass(u,"wj-state-selected",g==d.Cursor),wjcCore.toggleClass(u,"wj-state-multi-selected",g==d.Selected),wjcCore.setAttribute(u,"aria-selected",g!=d.None||p),p&&(this._activeCell=u),s+1):(u||((u=document.createElement("div")).tabIndex=-1,t.appendChild(u)),p&&(this._activeCell=u),this._ct==CellType.Cell&&(wjcCore.setAttribute(u,"role","gridcell"),wjcCore.setAttribute(u,"aria-selected",g!=d.None||p),wjcCore.setAttribute(u,"aria-readonly",!l.canEditCell(o,i)||null),wjcCore.setAttribute(u,"aria-required",h.getIsRequired())),l.cellFactory.updateCell(this,o,i,u,a),u[e._INDEX_KEY]={row:o,col:i,rng:a,panel:this},s+1)},e.prototype._removeExtraCells=function(e,t){for(;e.childElementCount>t;){var o=e.lastElementChild;e.removeChild(o),this._cf.disposeCell(o)}},e.prototype._getViewRange=function(){var e=this._g,t=e._ptScrl,o=this._rows,i=this._cols,n=new CellRange(0,0,o.length-1,i.length-1);if(this._ct==CellType.Cell||this._ct==CellType.RowHeader){var r=-t.y+this._offsetY,s=e._szClient.height;if((h=Math.min(o.frozen,o.length-1))>0&&(r+=u=o[h-1].pos,s-=u),n.row=Math.min(o.length-1,Math.max(o.frozen,o.getItemAt(r+1))),n.row2=o.getItemAt(r+s),e._clipToScreen){var l=e.hostElement.getBoundingClientRect();l.top<0&&(n.row=Math.max(n.row,o.getItemAt(-l.top-e._ptScrl.y)-1)),l.bottom>innerHeight&&(n.row2=Math.min(n.row2,o.getItemAt(-l.top-e._ptScrl.y+innerHeight)+1))}}if(this._ct==CellType.Cell||this._ct==CellType.ColumnHeader){var a=-t.x,c=e._szClient.width,h=Math.min(i.frozen,i.length-1);if(h>0){var u=i[h-1].pos;a+=u,c-=u}n.col=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(a+1))),n.col2=i.getItemAt(a+c)}return o.length<=o.frozen&&(n.row=n.row2=-1),i.length<=i.frozen&&(n.col=n.col2=-1),n},e.prototype._getFrozenPos=function(){var e=this._rows.frozen,t=this._cols.frozen,o=e>0?this._rows[e-1]:null,i=t>0?this._cols[t-1]:null,n=o?o.pos+o.renderSize:0,r=i?i.pos+i.renderSize:0;return new wjcCore.Point(r,n)},e._INDEX_KEY="wj-cell-index",e}();exports.GridPanel=GridPanel;var CellFactory=function(){function e(){}return e.prototype.updateCell=function(t,o,i,n,r,s){var l=t.grid,a=l.rightToLeft,c=CellType,h=t.rows,u=t.columns,d=h[o],g=u[i],p=o,f=i,w=d instanceof GroupRow?d:null,_=d instanceof _NewRowTemplate?d:null,C=g.renderWidth,m=d.renderHeight,y=t.cellType,v="wj-cell",b="",j={display:""};if(0!=s&&n.firstElementChild&&(1==n.childNodes.length&&"checkbox"==n.firstElementChild.type||(n.textContent="")),r&&!r.isSingleCell){o=r.row,i=r.col,p=r.row2,f=r.col2,d=h[o],g=u[i],w=d instanceof GroupRow?d:null;var R=r.getRenderSize(t);m=R.height,C=R.width}var S=l._getBindingColumn(t,o,g),E=S.dataType==wjcCore.DataType.Boolean&&!S.dataMap,x=g.pos,z=d.pos;if(l._useFrozenDiv()&&y==c.Cell&&!l.editRange?(o<h.frozen&&i>=u.frozen&&(x+=l._ptScrl.x),i<u.frozen&&o>=h.frozen&&(z+=l._ptScrl.y)):(o<h.frozen&&(z-=l._ptScrl.y),i<u.frozen&&(x-=l._ptScrl.x)),a?j.right=x+"px":j.left=x+"px",j.top=z-t._getOffsetY()+"px",j.width=C+"px",j.height=m+"px",j.zIndex="",(o<h.frozen||i<u.frozen)&&(j.zIndex=o<h.frozen&&i<u.frozen?2:1),y==c.Cell?(w&&(v+=" wj-group"),l.showAlternatingRows&&d.visibleIndex%2!=0&&(r&&r.row!=r.row2||(v+=" wj-alt")),(o<h.frozen||i<u.frozen)&&(v+=" wj-frozen"),_&&(v+=" wj-new"),d.cssClass&&(v+=" "+d.cssClass),S.cssClass&&(v+=" "+S.cssClass)):(v+=" wj-header",l.showAlternatingRows&&o%2!=0&&(v+=" wj-header-alt")),(y==c.Cell||y==c.RowHeader)&&l._getShowErrors()){var T=l._getError(t,o,i);wjcCore.setAttribute(n,"title",T),T&&(v+=" wj-state-invalid")}var M=SelectedState,H=t.getSelectedState(o,i,r);switch(H!=M.None&&y==c.Cell&&!E&&l.editRange&&l.editRange.contains(o,i)&&(H=M.None),H){case M.Active:v+=" wj-state-active";break;case M.Cursor:v+=" wj-state-selected wj-state-active";break;case M.Selected:v+=" wj-state-multi-selected"}switch(p==h.frozen-1&&(v+=" wj-frozen-row"),f==u.frozen-1&&(v+=" wj-frozen-col"),(S.wordWrap||d.wordWrap)&&(v+=" wj-wrap"),(S.multiLine||d.multiLine)&&(v+=" wj-multiline"),S.getAlignment()){case"right":b=" wj-align-right";break;case"center":b=" wj-align-center";break;case"justify":b=" wj-align-justify"}if(j.paddingLeft=j.paddingRight=j.paddingTop=j.paddingBottom="",y==c.Cell&&l.rows.maxGroupLevel>-1&&i==l.columns.firstVisibleIndex&&l.treeIndent){var P=w?Math.max(0,w.level):l.rows.maxGroupLevel+1,A=l.treeIndent*P+l._cellPadding;a?j.paddingRight=A+"px":j.paddingLeft=A+"px"}if(0!=s){var L=t.getCellData(o,i,!1),D=t.getCellData(o,i,!0);if(y==c.Cell&&i==l.columns.firstVisibleIndex&&w&&w.hasChildren&&!this._isEditingCell(l,o,i)){q=this._getTreeBtn(w);D=wjcCore.escapeHtml(D)||w.getGroupHeader(),n.innerHTML=q.outerHTML+" "+D,b=""}else if(y==c.ColumnHeader&&S.currentSort&&l.showSort&&(p==l._getSortRowIndex()||S!=g))v+=" wj-sort-"+("+"==S.currentSort?"asc":"desc"),n.innerHTML=wjcCore.escapeHtml(D)+"&nbsp;"+this._getSortIcon(S);else if(y!=c.RowHeader||i!=l.rowHeaders.columns.length-1||D)if(y!=c.Cell||S.dataType!=wjcCore.DataType.Boolean||S.dataMap||w&&!wjcCore.isBoolean(L))if(y==c.Cell&&this._isEditingCell(l,o,i)){var I=S.inputType;if(S.inputType||(I=S.dataType!=wjcCore.DataType.Number||S.dataMap?"text":"tel"),!S.dataMap&&!S.mask){var O=t.getCellData(o,i,!1);if(wjcCore.isNumber(O)){var N=O.toString(),F=S.format;if(F&&O!=Math.round(O)){var B=N.match(/\.(\d+)/)[1].length;F=F.replace(/([a-z])(\d*)(.*)/gi,"$01"+B+"$3")}D=wjcCore.Globalize.formatNumber(O,F,!0)}}n.innerHTML=(S.multiLine||d.multiLine)&&"checkbox"!=I?'<textarea wrap="soft"></textarea>':'<input type="'+I+'"/>';var k=n.children[0];wjcCore.addClass(k,"wj-grid-editor wj-form-control"),wjcCore.disableAutoComplete(k),k.value=D,k.required=S.getIsRequired(),wjcCore.setAttribute(k,"aria-required",k.required),S.maxLength&&(k.maxLength=S.maxLength),k.style.textAlign=S.getAlignment(),S.mask&&new wjcCore._MaskProvider(k,S.mask),l._edtHdl._edt=k}else y==c.Cell&&(d.isContentHtml||S.isContentHtml)?n.innerHTML=D:n.textContent=D||"";else{var V=n.firstChild;V instanceof HTMLInputElement&&"checkbox"==V.type||(n.innerHTML='<input type="checkbox" class="wj-cell-check" tabindex="-1"/>',V=n.firstChild),V.checked=1==L,V.indeterminate=null==L,V.disabled=!l.canEditCell(o,i),V.disabled&&(V.style.cursor="default"),l.editRange&&l.editRange.contains(o,i)&&(l._edtHdl._edt=V)}else{var G=l.editableCollectionView,K=G?G.currentEditItem:null;K&&d.dataItem==K?n.innerHTML='<span class="wj-glyph-pencil"></span>':d instanceof _NewRowTemplate&&(n.innerHTML='<span class="wj-glyph-asterisk"></span>')}if(y==c.Cell&&tryGetModuleWijmoInput()&&S.dataMap&&l.showDropDown&&0!=S.showDropDown&&l.canEditCell(o,i)){if(!e._ddBtn){var W=e._WJC_DROPDOWN,q=wjcCore.createElement('<button class="wj-btn wj-btn-glyph wj-right '+W+'" type="button" tabindex="-1"><span class="wj-glyph-down"></span></button>');wjcCore.setAriaLabel(q,wjcCore.culture.FlexGrid.ariaLabels.toggleDropDown),wjcCore.setAttribute(q,"aria-expanded",!1),e._ddBtn=q}var U=e._ddBtn.cloneNode(!0);n.appendChild(U)}}var Y=!1;switch(y){case c.RowHeader:Y=!w&&!_&&d.allowDragging&&0!=(l.allowDragging&AllowDragging.Rows),wjcCore.setAttribute(n,"draggable",Y?"true":null);break;case c.ColumnHeader:Y=g.allowDragging&&0!=(l.allowDragging&AllowDragging.Columns),wjcCore.setAttribute(n,"draggable",Y?"true":null)}v+=b,n.className!=v&&(n.className=v);var J=n.style;for(var X in j)J[X]!==j[X]&&(J[X]=j[X]);if(l._edtHdl._edt&&l._edtHdl._edt.parentElement==n){var Z=l._root,Q=Z.getBoundingClientRect(),$=n.getBoundingClientRect(),ee=Q.top+Z.clientHeight-$.top,te=Q.left+Z.clientWidth-$.left;$.height>ee&&(n.style.height=ee+"px"),$.width>te&&(n.style.width=te+"px")}if(l.itemFormatter&&l.itemFormatter(t,o,i,n),l.formatItem.hasHandlers){var oe=e._fmtRng;oe?oe.setRange(o,i,p,f):oe=e._fmtRng=new CellRange(o,i,p,f);var ie=new FormatItemEventArgs(t,oe,n);l.onFormatItem(ie)}},e.prototype.disposeCell=function(e){},e.prototype.getEditorValue=function(e){var t=e._edtHdl._edt;if(t instanceof HTMLInputElement&&"checkbox"==t.type)return t.checked;if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){var o=t.maxLength;return wjcCore.isNumber(o)&&o>-1&&t.value.length>o?t.value.substr(0,o):t.value}return null},e.prototype._isEditingCell=function(e,t,o){return e.editRange&&e.editRange.contains(t,o)},e.prototype._getTreeBtn=function(t){var o=e._WJC_COLLAPSE,i=(t.isCollapsed?"":"down-")+(t.grid.rightToLeft?"left":"right"),n=wjcCore.createElement('<button class="wj-btn wj-btn-glyph '+o+'" type="button" tabindex="-1"><span class="wj-glyph-'+i+'"></span></button>');return wjcCore.setAriaLabel(n,wjcCore.culture.FlexGrid.ariaLabels.toggleGroup),wjcCore.setAttribute(n,"aria-expanded",!t.isCollapsed),n},e.prototype._getSortIcon=function(e){return'<span class="wj-glyph-'+("+"==e.currentSort?"up":"down")+'"></span>'},e._WJC_COLLAPSE="wj-elem-collapse",e._WJC_DROPDOWN="wj-elem-dropdown",e}();exports.CellFactory=CellFactory;var CellRange=function(){function e(e,t,o,i){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===o&&(o=e),void 0===i&&(i=t),this.setRange(e,t,o,i)}return e.prototype.setRange=function(e,t,o,i){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===o&&(o=e),void 0===i&&(i=t),this._row=wjcCore.asInt(e),this._col=wjcCore.asInt(t),this._row2=wjcCore.asInt(o),this._col2=wjcCore.asInt(i)},Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=wjcCore.asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=wjcCore.asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row2",{get:function(){return this._row2},set:function(e){this._row2=wjcCore.asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col2",{get:function(){return this._col2},set:function(e){this._col2=wjcCore.asInt(e)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._row,this._col,this._row2,this._col2)},Object.defineProperty(e.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,o){var i=wjcCore.tryCast(t,e);if(i)return i.topRow>=this.topRow&&i.bottomRow<=this.bottomRow&&i.leftCol>=this.leftCol&&i.rightCol<=this.rightCol;if(wjcCore.isInt(t)&&wjcCore.isInt(o))return t>=this.topRow&&t<=this.bottomRow&&o>=this.leftCol&&o<=this.rightCol;throw"contains expects a CellRange or row/column indices."},e.prototype.containsRow=function(e){return wjcCore.asInt(e)>=this.topRow&&e<=this.bottomRow},e.prototype.containsColumn=function(e){return wjcCore.asInt(e)>=this.leftCol&&e<=this.rightCol},e.prototype.intersects=function(e){return this.intersectsRow(e)&&this.intersectsColumn(e)},e.prototype.intersectsRow=function(e){return e&&!(this.bottomRow<e.topRow||this.topRow>e.bottomRow)},e.prototype.intersectsColumn=function(e){return e&&!(this.rightCol<e.leftCol||this.leftCol>e.rightCol)},e.prototype.getRenderSize=function(e){var t=new wjcCore.Size(0,0);if(this.isValid){for(var o=this.topRow;o<=this.bottomRow;o++)t.height+=e.rows[o].renderSize;for(var i=this.leftCol;i<=this.rightCol;i++)t.width+=e.columns[i].renderSize}return t},e.prototype.equals=function(t){return t instanceof e&&this._row==t._row&&this._col==t._col&&this._row2==t._row2&&this._col2==t._col2},e}();exports.CellRange=CellRange;var RowColFlags;!function(e){e[e.Visible=1]="Visible",e[e.AllowResizing=2]="AllowResizing",e[e.AllowDragging=4]="AllowDragging",e[e.AllowMerging=8]="AllowMerging",e[e.AllowSorting=16]="AllowSorting",e[e.AutoGenerated=32]="AutoGenerated",e[e.Collapsed=64]="Collapsed",e[e.ParentCollapsed=128]="ParentCollapsed",e[e.Selected=256]="Selected",e[e.ReadOnly=512]="ReadOnly",e[e.HtmlContent=1024]="HtmlContent",e[e.WordWrap=2048]="WordWrap",e[e.MultiLine=4096]="MultiLine",e[e.HasTemplate=8192]="HasTemplate",e[e.RowDefault=3]="RowDefault",e[e.ColumnDefault=23]="ColumnDefault"}(RowColFlags=exports.RowColFlags||(exports.RowColFlags={}));var RowCol=function(){function e(){this._list=null,this._pos=0,this._idx=-1,this._vidx=-1}return Object.defineProperty(e.prototype,"visible",{get:function(){return this._getFlag(RowColFlags.Visible)},set:function(e){this._setFlag(RowColFlags.Visible,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return!!this._getFlag(RowColFlags.Visible)&&(!this._getFlag(RowColFlags.ParentCollapsed)||this instanceof _NewRowTemplate)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this._idx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleIndex",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this.isVisible?this._vidx:-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._sz},set:function(e){e!=this._sz&&(this._sz=wjcCore.asNumber(e,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderSize",{get:function(){if(!this.isVisible)return 0;var e=this._sz,t=this._list;return t&&((null==e||e<0)&&(e=Math.round(t.defaultSize)),null!=t.minSize&&e<t.minSize&&(e=t.minSize),null!=t.maxSize&&e>t.maxSize&&(e=t.maxSize)),null!=this._szMin&&e<this._szMin&&(e=this._szMin),null!=this._szMax&&e>this._szMax&&(e=this._szMax),Math.round(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowResizing",{get:function(){return this._getFlag(RowColFlags.AllowResizing)},set:function(e){this._setFlag(RowColFlags.AllowResizing,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowDragging",{get:function(){return this._getFlag(RowColFlags.AllowDragging)},set:function(e){this._setFlag(RowColFlags.AllowDragging,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowMerging",{get:function(){return this._getFlag(RowColFlags.AllowMerging)},set:function(e){this._setFlag(RowColFlags.AllowMerging,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){return this._getFlag(RowColFlags.Selected)},set:function(e){if(this._setFlag(RowColFlags.Selected,e,!0)){var t=this.grid;t&&t.refreshCells(!1,!0,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReadOnly",{get:function(){return this._getFlag(RowColFlags.ReadOnly)},set:function(e){this._setFlag(RowColFlags.ReadOnly,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isContentHtml",{get:function(){return this._getFlag(RowColFlags.HtmlContent)},set:function(e){this.isContentHtml!=e&&(this._setFlag(RowColFlags.HtmlContent,e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._getFlag(RowColFlags.WordWrap)},set:function(e){this._setFlag(RowColFlags.WordWrap,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiLine",{get:function(){return this._getFlag(RowColFlags.MultiLine)},set:function(e){this._setFlag(RowColFlags.MultiLine,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssClass",{get:function(){return this._cssClass},set:function(e){e!=this._cssClass&&(this._cssClass=wjcCore.asString(e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0}),e.prototype.onPropertyChanged=function(){this._list&&(this._list._dirty=!0,this.grid.invalidate())},e.prototype._getFlag=function(e){return 0!=(this._f&e)},e.prototype._setFlag=function(e,t,o){return t!=this._getFlag(e)&&(this._f=t?this._f|e:this._f&~e,o||this.onPropertyChanged(),!0)},e}();exports.RowCol=RowCol;var Column=function(e){function t(o){var i=e.call(this)||this;return i._f=RowColFlags.ColumnDefault,i._hash=t._ctr.toString(36),t._ctr++,o&&wjcCore.copy(i,o),i}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return this._type},set:function(e){e=wjcCore.asEnum(e,wjcCore.DataType),this._type!=e&&(this._type=e,this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRequired",{get:function(){return this._required},set:function(e){this._required=wjcCore.asBoolean(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._showDropDown},set:function(e){e!=this._showDropDown&&(this._showDropDown=wjcCore.asBoolean(e,!0),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(e){this._ddCssClass=wjcCore.asString(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputType",{get:function(){return this._inpType},set:function(e){this._inpType=wjcCore.asString(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=wjcCore.asString(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLength",{get:function(){return this._maxLen},set:function(e){this._maxLen=wjcCore.asNumber(e,!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(e){if(e!=this.binding){var t=wjcCore.asString(e);if(this._binding=t?new wjcCore.Binding(t):null,!this._type&&this.grid&&this._binding){var o=this.grid.collectionView;if(o&&o.sourceCollection&&o.sourceCollection.length){var i=o.sourceCollection[0];this._type=wjcCore.getType(this._binding.getValue(i))}}this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(e){if(e!=this.sortMemberPath){var t=wjcCore.asString(e);this._bindingSort=t?new wjcCore.Binding(t):null,this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return null!=this._szStar?this._szStar:this.size},set:function(e){null!=t._parseStarSize(e)?(this._szStar=e,this.onPropertyChanged()):(this._szStar=null,this.size=wjcCore.asNumber(e,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minWidth",{get:function(){return this._szMin},set:function(e){e!=this._szMin&&(this._szMin=wjcCore.asNumber(e,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._szMax},set:function(e){e!=this._szMax&&(this._szMax=wjcCore.asNumber(e,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=wjcCore.asBoolean(e,!0)},enumerable:!0,configurable:!0}),t.prototype._getQuickAutoSize=function(){return!!this.grid._getQuickAutoSize()&&(wjcCore.isBoolean(this._quickSize)?this._quickSize:!(this.isContentHtml||this.wordWrap||this.multiLine||this._getFlag(RowColFlags.HasTemplate)))},Object.defineProperty(t.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(e){this._align!=e&&(this._align=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype.getAlignment=function(){var e=this._align;if(null==e&&(e="",!this._map))switch(this._type){case wjcCore.DataType.Boolean:e="center";break;case wjcCore.DataType.Number:e="right"}return e},t.prototype.getIsRequired=function(){return null!=this._required?this._required:this.dataType!=wjcCore.DataType.String||(null!=this.dataMap||null!=this._mask&&this._mask.length>0)},Object.defineProperty(t.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(e){this._hdr!=e&&(this._hdr=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this._map},set:function(e){this._map!=e&&(this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this),wjcCore.isArray(e)&&(e=new DataMap(e,null,null)),this._map=wjcCore.asType(e,DataMap,!0),this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._fmt},set:function(e){this._fmt!=e&&(this._fmt=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._getFlag(RowColFlags.AllowSorting)},set:function(e){this._setFlag(RowColFlags.AllowSorting,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSort",{get:function(){var e=this.grid?this.grid.collectionView:null,t=e?e.sortDescriptions:null,o=t&&t.length?this._getBindingSort():null;if(o)for(var i=0;i<t.length;i++)if(t[i].property==o)return t[i].ascending?"+":"-";return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregate",{get:function(){return null!=this._agg?this._agg:wjcCore.Aggregate.None},set:function(e){(e=wjcCore.asEnum(e,wjcCore.Aggregate))!=this._agg&&(this._agg=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"describedById",{get:function(){return this._descById},set:function(e){e!=this._descById&&(this._descById=wjcCore.asString(e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),t.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null},t._parseStarSize=function(e){if(wjcCore.isString(e)&&e.length>0&&"*"==e[e.length-1]){var t=1==e.length?1:1*e.substr(0,e.length-1);if(t>0&&!isNaN(t))return t}return null},t._ctr=0,t}(RowCol);exports.Column=Column;var Row=function(e){function t(t){var o=e.call(this)||this;return o._f=RowColFlags.ColumnDefault,o._data=t,o}return __extends(t,e),Object.defineProperty(t.prototype,"dataItem",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size},set:function(e){this.size=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),t}(RowCol);exports.Row=Row;var GroupRow=function(e){function t(){var t=e.call(this)||this;return t._level=-1,t.isReadOnly=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(e){wjcCore.asInt(e),e!=this._level&&(this._level=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){if(null!=this.grid&&null!=this._list){this._list._update();var e=this.index<this._list.length-1?this._list[this.index+1]:null,o=wjcCore.tryCast(e,t),i=wjcCore.tryCast(e,_NewRowTemplate);return null!=e&&null==i&&(null==o||o.level>this.level)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return this._getFlag(RowColFlags.Collapsed)},set:function(e){wjcCore.asBoolean(e),e!=this.isCollapsed&&null!=this._list&&this._setCollapsed(e)},enumerable:!0,configurable:!0}),t.prototype.getGroupHeader=function(){var e=this.grid,t=e.groupHeaderFormat||wjcCore.culture.FlexGrid.groupHeaderFormat,o=wjcCore.tryCast(this.dataItem,wjcCore.CollectionViewGroup);if(o&&t){var i=o.groupDescription.propertyName,n=o.name,r=e.getColumn(i),s=this.isContentHtml;r&&(s=s||r.isContentHtml,r.header&&(i=r.header),r.dataMap?n=r.dataMap.getDisplayValue(n):r.format&&(n=wjcCore.Globalize.format(n,r.format)));var l=o.getAggregate(wjcCore.Aggregate.CntAll,null,e.collectionView);return wjcCore.format(t,{name:wjcCore.escapeHtml(i),value:s?n:wjcCore.escapeHtml(n),level:o.level,count:l})}return""},t.prototype._setCollapsed=function(e){var o=this,i=this.grid,n=i.rows,r=this.getCellRange(),s=new CellRangeEventArgs(i.cells,new CellRange(this.index,-1));i.onGroupCollapsedChanging(s)&&(i.deferUpdate(function(){n.deferUpdate(function(){o._setFlag(RowColFlags.Collapsed,e,!0);for(var i=r.topRow+1;i<=r.bottomRow&&i>-1&&i<n.length;i++){n[i]._setFlag(RowColFlags.ParentCollapsed,e,!0);var s=n[i];s instanceof t&&s.isCollapsed&&(i=s.getCellRange().bottomRow)}})}),i.onGroupCollapsedChanged(s))},t.prototype.getCellRange=function(){for(var e=this._list,o=this.index,i=e.length-1,n=o+1;n<=i;n++){var r=wjcCore.tryCast(e[n],t);if(null!=r&&r.level<=this.level){i=n-1;break}}return new CellRange(o,0,i,this.grid.columns.length-1)},t}(Row);exports.GroupRow=GroupRow;var RowColCollection=function(e){function t(t,o){var i=e.call(this)||this;return i._frozen=0,i._vlen=0,i._szDef=28,i._szTot=0,i._szCustom=!1,i._dirty=!1,i._g=wjcCore.asType(t,FlexGrid),i._szDef=wjcCore.asNumber(o,!1,!0),i}return __extends(t,e),Object.defineProperty(t.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultSize",{get:function(){return this._szDef},set:function(e){this._szCustom=!0,this._szDef!=e&&(this._szDef=wjcCore.asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozen",{get:function(){return this._frozen},set:function(e){e!=this._frozen&&(this._frozen=wjcCore.asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.isFrozen=function(e){return e<this.frozen},Object.defineProperty(t.prototype,"minSize",{get:function(){return this._szMin},set:function(e){e!=this._szMin&&(this._szMin=wjcCore.asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._szMax},set:function(e){e!=this._szMax&&(this._szMax=wjcCore.asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getTotalSize=function(){return this._dirty&&this._update(),this._szTot},Object.defineProperty(t.prototype,"visibleLength",{get:function(){return this._dirty&&this._update(),this._vlen},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(e){if(this._dirty&&this._update(),e<=0&&this.length>0&&this[0].renderSize)return 0;e=Math.round(e);for(var t,o,i=this.length,n=0,r=i-1;n<=r;)if(t=n+r>>>1,(o=this[t])._pos>e&&t>0)r=t-1;else{if(!(o._pos+o.renderSize<=e&&t<i-1)){for(;t>0&&!this[t].renderSize;)t--;for(;t<i-1&&!this[t].renderSize;)t++;return t}n=t+1}return r},t.prototype.getNextCell=function(e,t,o){var i,n=SelMove;switch(t){case n.Next:for(i=e+1;i<this.length;i++)if(this[i].renderSize>0)return i;break;case n.Prev:for(i=e-1;i>=0;i--)if(this[i].renderSize>0)return i;break;case n.End:for(i=this.length-1;i>=0;i--)if(this[i].renderSize>0)return i;break;case n.Home:for(i=0;i<this.length;i++)if(this[i].renderSize>0)return i;break;case n.NextPage:return(i=this.getItemAt(this[e].pos+o))<0?this.getNextCell(e,SelMove.End,o):i==e&&i<this.length-1&&this[i+1].renderSize?i+1:i;case n.PrevPage:return(i=this.getItemAt(this[e].pos-o))<0?this.getNextCell(e,SelMove.Home,o):i==e&&i>0&&this[i-1].renderSize?i-1:i}return e},t.prototype.canMoveElement=function(e,t){if(t==e)return!1;if(e<0||e>=this.length||t>=this.length)return!1;t<0&&(t=this.length-1);for(var o=Math.min(e,t),i=Math.max(e,t),n=o;n<=i;n++)if(!this[n].allowDragging)return!1;return!(this[t]instanceof _NewRowTemplate)},t.prototype.moveElement=function(e,t){if(this.canMoveElement(e,t)){var o=this[e];this.removeAt(e),t<0&&(t=this.length),this.insert(t,o)}},t.prototype.onCollectionChanged=function(t){void 0===t&&(t=wjcCore.NotifyCollectionChangedEventArgs.reset),this._dirty=!0,this._g.invalidate(),e.prototype.onCollectionChanged.call(this,t)},t.prototype.push=function(t){return t._list=this,e.prototype.push.call(this,t)},t.prototype.splice=function(t,o,i){return i&&(i._list=this),e.prototype.splice.call(this,t,o,i)},t.prototype.beginUpdate=function(){this._update(),e.prototype.beginUpdate.call(this)},t.prototype._setDefaultSize=function(e){this._szCustom||(this.defaultSize=e,this._szCustom=!1)},t.prototype._update=function(){if(this._dirty&&!this.isUpdating){this._dirty=!1;for(var e=0,t=0,o=void 0,i=void 0,n=0;n<this.length;n++)(i=this[n])._idx=n,i._vidx=e,i._list=this,i._pos=t,(o=i.renderSize)>0&&(t+=o,e++);return this._vlen=e,this._szTot=t,!0}return!1},t}(wjcCore.ObservableArray);exports.RowColCollection=RowColCollection;var ColumnCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._firstVisible=-1,t}return __extends(t,e),t.prototype.getColumn=function(e){var t=wjcCore.isNumber(e)?e:this.indexOf(e);return t>-1?this[t]:null},t.prototype.indexOf=function(t){if(t instanceof Column)return e.prototype.indexOf.call(this,t);for(o=0;o<this.length;o++)if(this[o].name==t)return o;for(var o=0;o<this.length;o++)if(this[o].binding==t)return o;return-1},Object.defineProperty(t.prototype,"describedById",{get:function(){return this._descById},set:function(e){e!=this._descById&&(this._descById=wjcCore.asString(e),this._g&&this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstVisibleIndex",{get:function(){return this._dirty&&this._update(),this._firstVisible},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(e.prototype._update.call(this)){this._firstVisible=-1;for(var t=0;t<this.length;t++)if(this[t].visible){this._firstVisible=t;break}return!0}return!1},t.prototype._updateStarSizes=function(e){for(var t,o=0,i=0;i<this.length;i++)(r=this[i]).isVisible&&(r._szStar?(o+=Column._parseStarSize(r._szStar),t=r):e-=r.renderWidth);if(t){for(var n=e,i=0;i<this.length;i++){var r=this[i];r.isVisible&&r._szStar&&(r==t&&n>0?r._sz=n:(r._sz=Math.max(0,Math.round(Column._parseStarSize(r._szStar)/o*e)),n-=r.renderWidth))}return this._dirty=!0,this._update(),!0}return!1},t}(RowColCollection);exports.ColumnCollection=ColumnCollection;var RowCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._maxLevel=-1,t}return __extends(t,e),Object.defineProperty(t.prototype,"ariaLabel",{get:function(){return this._ariaLabel},set:function(e){e!=this.ariaLabel&&(this._ariaLabel=wjcCore.asString(e),this._g&&this._g.refresh())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxGroupLevel",{get:function(){return this._dirty&&this._update(),this._maxLevel},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(e.prototype._update.call(this)){this._maxLevel=-1;for(var t=0;t<this.length;t++){var o=wjcCore.tryCast(this[t],GroupRow);o&&o.level>this._maxLevel&&(this._maxLevel=o.level)}return!0}return!1},t}(RowColCollection);exports.RowCollection=RowCollection;var HitTestInfo=function(){function e(t,o){this._row=-1,this._col=-1,this._edge=0;var i;if(o instanceof Element){if(wjcCore.closest(o,".wj-flexgrid")!=t.hostElement)return;t=o}if(!(t instanceof Element)||t instanceof FlexGrid){if(t instanceof FlexGrid)i=this._g=t;else{if(!(t instanceof GridPanel))throw"First parameter should be a FlexGrid or GridPanel.";this._p=t,i=this._g=this._p.grid}var n;o instanceof MouseEvent&&(n=o,"mousedown"==o.type&&(i._rcBounds=null)),o=wjcCore.mouseToPage(o),this._pt=o.clone();var r=i.controlRect,s=i._szClient,l=i.topLeftCells,a=i._eTL,c=i.headersVisibility,h=HeadersVisibility,u=c&h.Row?l.columns.getTotalSize():0,d=c&h.Column?l.rows.getTotalSize():0,g=c&h.Column?d+a.offsetTop:0,p=i._eBL,f=p.offsetHeight;if(o.x-=r.left,o.y-=r.top,this._g.rightToLeft&&(o.x=r.width-o.x),!this._p&&o.x>=0&&o.y>=a.offsetTop&&s&&o.x<=s.width+u&&o.y<=s.height+g&&(o.y<g?this._p=o.x<u?i.topLeftCells:i.columnHeaders:o.y<p.offsetTop?this._p=o.x<u?i.rowHeaders:i.cells:this._p=o.x<u?i.bottomLeftCells:i.columnFooters),null!=this._p){var w=this._p.rows,_=this._p.columns,C=this._p.cellType,m=CellType,y=this._p._getFrozenPos(),v=C==m.TopLeft||C==m.ColumnHeader?d:C==m.BottomLeft||C==m.ColumnFooter?f:w.getTotalSize(),b=C==m.TopLeft||C==m.BottomLeft||C==m.RowHeader?u:_.getTotalSize();C==m.RowHeader||C==m.Cell?(o.y-=d,(o.y>y.y||y.y<=0)&&(o.y-=i._ptScrl.y,o.y+=this._p._getOffsetY())):C!=m.BottomLeft&&C!=m.ColumnFooter||(o.y-=p.offsetTop),C!=m.ColumnHeader&&C!=m.Cell&&C!=m.ColumnFooter||(o.x-=u,(o.x>y.x||y.x<=0)&&(o.x-=i._ptScrl.x)),C!=m.ColumnHeader&&C!=m.TopLeft||(o.y-=g-d),this._edge=0;var j=e._SZEDGE[this._g.isTouching?1:0];if(this._g.isTouching&&(j=e._SZEDGE[1],o.x-=j/2),this._row=o.y>v?-1:w.getItemAt(o.y),this._col=o.x>b?-1:_.getItemAt(o.x),this._row<0||this._col<0)return void(this._p=null);if(this._col>-1){var R=_[this._col];o.x-R.pos<=j&&(this._edge|=1),R.pos+R.renderSize-o.x<=j&&(this._edge|=4)}if(this._row>-1){var S=w[this._row];o.y-S.pos<=j&&(this._edge|=2),S.pos+S.renderSize-o.y<=j&&(this._edge|=8)}}if(!(8&this._edge)&&n instanceof MouseEvent){var E=wjcCore.closest(n.target,".wj-cell"),x=E?E[GridPanel._INDEX_KEY]:null;x&&!x.rng&&x.panel==this._p&&this._row!=x.row&&(this._row=x.row)}}else(x=(E=wjcCore.closest(t,".wj-cell"))?E[GridPanel._INDEX_KEY]:null)&&(this._row=x.row,this._col=x.col,this._rng=x.rng,this._p=x.panel,this._g=x.panel.grid)}return Object.defineProperty(e.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellType",{get:function(){return this._p?this._p.cellType:CellType.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._rng||(this._rng=new CellRange(this._row,this._col)),this._rng},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeLeft",{get:function(){return 0!=(1&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeTop",{get:function(){return 0!=(2&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeRight",{get:function(){return 0!=(4&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeBottom",{get:function(){return 0!=(8&this._edge)},enumerable:!0,configurable:!0}),e._SZEDGE=[5,30],e}();exports.HitTestInfo=HitTestInfo;var AllowMerging;!function(e){e[e.None=0]="None",e[e.Cells=1]="Cells",e[e.ColumnHeaders=2]="ColumnHeaders",e[e.RowHeaders=4]="RowHeaders",e[e.AllHeaders=6]="AllHeaders",e[e.All=7]="All"}(AllowMerging=exports.AllowMerging||(exports.AllowMerging={}));var MergeManager=function(){function e(e){this._g=e}return e.prototype.getMergedRange=function(e,t,o,i){void 0===i&&(i=!0);var n=this._g,r=e.cellType,s=e.columns,l=e.rows,a=l[t],c=s[o];if(a instanceof _NewRowTemplate)return null;if(a instanceof GroupRow&&a.dataItem instanceof wjcCore.CollectionViewGroup){u=new CellRange(t,o);if(c.aggregate==wjcCore.Aggregate.None){for(;u.col>0&&s[u.col-1].aggregate==wjcCore.Aggregate.None&&u.col!=s.frozen;)u.col--;for(;u.col2<s.length-1&&s[u.col2+1].aggregate==wjcCore.Aggregate.None&&u.col2+1!=s.frozen;)u.col2++}for(;u.col<o&&!s[u.col].visible;)u.col++;return u.isSingleCell?null:u}var h=!1;switch(this._g.allowMerging){case AllowMerging.None:h=!0;break;case AllowMerging.Cells:h=r!=CellType.Cell;break;case AllowMerging.ColumnHeaders:h=r!=CellType.ColumnHeader&&r!=CellType.TopLeft;break;case AllowMerging.RowHeaders:h=r!=CellType.RowHeader&&r!=CellType.TopLeft;break;case AllowMerging.AllHeaders:h=r==CellType.Cell}if(h)return null;if(s[o].allowMerging){var u=new CellRange(t,o),d=0,g=l.length-1;t>=l.frozen?!i||r!=CellType.Cell&&r!=CellType.RowHeader||n._vtRows<l.length&&(d=(C=e._getViewRange()).topRow,g=C.bottomRow):g=l.frozen-1;for(var p=t-1;p>=d&&this._mergeCell(e,p,o,t,o);p--)u.row=p;for(var f=t+1;f<=g&&this._mergeCell(e,t,o,f,o);f++)u.row2=f;for(;u.row<t&&!l[u.row].visible;)u.row++;if(!u.isSingleCell)return u}if(l[t].allowMerging){var u=new CellRange(t,o),w=0,_=s.length-1;if(o>=s.frozen){if(i&&(r==CellType.Cell||r==CellType.ColumnHeader)&&n._vtCols<s.length){var C=e._getViewRange();w=C.leftCol,_=C.rightCol}}else _=s.frozen-1;for(var m=o-1;m>=w&&this._mergeCell(e,t,m,t,o);m--)u.col=m;for(var y=o+1;y<=_&&this._mergeCell(e,t,o,t,y);y++)u.col2=y;for(;u.col<o&&!s[u.col].visible;)u.col++;if(!u.isSingleCell)return u}return null},e.prototype._mergeCell=function(e,t,o,i,n){var r=e.rows[t],s=e.rows[i];if(r instanceof GroupRow||r instanceof _NewRowTemplate||s instanceof GroupRow||s instanceof _NewRowTemplate)return!1;if(t!=i&&e.rows.isFrozen(t)!=e.rows.isFrozen(i))return!1;if(o!=n&&e.columns.isFrozen(o)!=e.columns.isFrozen(n))return!1;if(t!=i){if(o>0&&(r.allowMerging&&this._mergeCell(e,t,o-1,t,o)||s.allowMerging&&this._mergeCell(e,i,o-1,i,o)))return!1;if(n<e.columns.length-1&&(r.allowMerging&&this._mergeCell(e,t,n,t,n+1)||s.allowMerging&&this._mergeCell(e,i,n,i,n+1)))return!1}return e.getCellData(t,o,!0)==e.getCellData(i,n,!0)},e}();exports.MergeManager=MergeManager;var DataMap=function(){function e(e,t,o){if(this.mapChanged=new wjcCore.Event,wjcCore.isArray(e)&&!t&&!o){for(var i=[],n=0;n<e.length;n++)i.push({value:e[n]});e=i,t=o="value"}this._cv=wjcCore.asCollectionView(e),this._keyPath=wjcCore.asString(t,!1),this._displayPath=wjcCore.asString(o,!1),this._cv.collectionChanged.addHandler(this.onMapChanged,this)}return Object.defineProperty(e.prototype,"sortByDisplayValues",{get:function(){return 1!=this._sortByKey},set:function(e){this._sortByKey=!wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0}),e.prototype.getKeyValue=function(e){var t=this._displayPath,o=this._indexOf(e,t,!0);return o<0&&(o=this._indexOf(e,t,!1)),o>-1?this._cv.sourceCollection[o][this._keyPath]:null},e.prototype.getDisplayValue=function(e){if(!this._hash){this._hash={};var t=this._cv.sourceCollection;if(t&&this._keyPath&&this._displayPath)for(var o=t.length-1;o>=0;o--){var i=t[o],n=i[this._keyPath],r=i[this._displayPath];this._hash[n]=r}}var s=this._hash[e];return null!=s?s:e},e.prototype.getDisplayValues=function(e){var t=[];if(this._cv&&this._displayPath)for(var o=this._cv.items,i=0;i<o.length;i++)t.push(o[i][this._displayPath]);return t},e.prototype.getKeyValues=function(){var e=[];if(this._cv&&this._keyPath)for(var t=this._cv.items,o=0;o<t.length;o++)e.push(t[o][this._keyPath]);return e},Object.defineProperty(e.prototype,"isEditable",{get:function(){return this._editable},set:function(e){this._editable=wjcCore.asBoolean(e)},enumerable:!0,configurable:!0}),e.prototype.onMapChanged=function(e){this._hash=null,this.mapChanged.raise(this,e)},e.prototype._indexOf=function(e,t,o){var i=-1,n=-1;if(this._cv&&t)for(var r=null!=e?e.toString():"",s=o?r:r.toLowerCase(),l=this._cv.sourceCollection,a=0;a<l.length;a++){var c=l[a],h=c[t];if(h==e?i=a:o||h.length!=s.length||h.toLowerCase()!=s?null!=h&&h.toString()==r&&(i=a):i=a,i==a){if(!this._cv.filter||this._cv.filter(c))return i;n<0&&(n=i)}}return n},e}();exports.DataMap=DataMap;var SelectionMode;!function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.CellRange=2]="CellRange",e[e.Row=3]="Row",e[e.RowRange=4]="RowRange",e[e.ListBox=5]="ListBox"}(SelectionMode=exports.SelectionMode||(exports.SelectionMode={}));var SelectedState;!function(e){e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Cursor=2]="Cursor",e[e.Active=3]="Active"}(SelectedState=exports.SelectedState||(exports.SelectedState={}));var SelMove;!function(e){e[e.None=0]="None",e[e.Next=1]="Next",e[e.Prev=2]="Prev",e[e.NextPage=3]="NextPage",e[e.PrevPage=4]="PrevPage",e[e.Home=5]="Home",e[e.End=6]="End",e[e.NextCell=7]="NextCell",e[e.PrevCell=8]="PrevCell"}(SelMove=exports.SelMove||(exports.SelMove={}));var _SelectionHandler=function(){function e(e){this._sel=new CellRange(0,0),this._mode=SelectionMode.CellRange,this._g=e}return Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this._mode},set:function(e){if(e!=this._mode){var t=SelectionMode;if(e==t.ListBox||this._mode==t.ListBox)for(var o=this._g.rows,i=0;i<o.length;i++){var n=o[i],r=e==SelectionMode.ListBox&&this._sel.containsRow(i);n._setFlag(RowColFlags.Selected,r,!0)}switch(e){case t.None:this._sel.setRange(-1,-1);break;case t.Cell:this._sel.row2=this._sel.row,this._sel.col2=this._sel.col;break;case t.Row:this._sel.row2=this._sel.row}this._mode=e,this._g.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._sel},set:function(e){this.select(e)},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){void 0===t&&(t=!0),wjcCore.isNumber(e)&&wjcCore.isNumber(t)&&(e=new CellRange(e,t),t=!0),e=wjcCore.asType(e,CellRange);var o=this._g,i=this._sel,n=e,r=!1,s=SelectionMode;switch(o.selectionMode){case s.Cell:e.row2=e.row,e.col2=e.col;break;case s.Row:e.row2=e.row;break;case s.ListBox:r=!0}var l=n.equals(i);if(r&&n.row>-1&&!o.rows[n.row].isSelected&&(l=!1),l)t&&o.scrollIntoView(n.row,n.col);else{var a=new CellRangeEventArgs(o.cells,n);if(o.onSelectionChanging(a)){if(r&&(n.row!=i.row||n.rowSpan>1||i.rowSpan>1)){for(var c=0;c<o.rows.length;c++)o.rows[c]._setFlag(RowColFlags.Selected,n.containsRow(c),!0);o.refreshCells(!1,!0,!0)}if(n.row=Math.min(n.row,o.rows.length-1),n.row2=Math.min(n.row2,o.rows.length-1),this._sel=n,o.refreshCells(!1,!0,!0),t&&o.scrollIntoView(n.row,n.col),o.collectionView){var h=o._getCvIndex(n.row);o.collectionView.moveCurrentToPosition(h)}o.onSelectionChanged(a)}}},e.prototype.moveSelection=function(e,t,o){var i,n,r=this._g,s=r.rows,l=r.columns,a=this._getReferenceCell(e,t,o),c=Math.max(0,r._szClient.height-r.columnHeaders.height);if(t==SelMove.NextCell)n=l.getNextCell(a.col,SelMove.Next,c),i=a.row,n==a.col&&(i=s.getNextCell(i,SelMove.Next,c))>a.row&&(n=l.getNextCell(0,SelMove.Next,c),n=l.getNextCell(n,SelMove.Prev,c)),r.select(i,n);else if(t==SelMove.PrevCell)n=l.getNextCell(a.col,SelMove.Prev,c),i=a.row,n==a.col&&(i=s.getNextCell(i,SelMove.Prev,c))<a.row&&(n=l.getNextCell(l.length-1,SelMove.Prev,c),n=l.getNextCell(n,SelMove.Next,c)),r.select(i,n);else if(i=s.getNextCell(a.row,e,c),n=l.getNextCell(a.col,t,c),o){var h=r._selHdl._sel;r.select(new CellRange(i,n,h.row2,h.col2))}else r.select(i,n)},e.prototype._getReferenceCell=function(e,t,o){var i=this._g,n=i._selHdl._sel,r=i.getMergedRange(i.cells,n.row,n.col);if(!r||r.isSingleCell)return n;switch(r=r.clone(),e){case SelMove.Next:case SelMove.NextCell:r.row=r.bottomRow;break;case SelMove.None:r.row=n.row}switch(t){case SelMove.Next:case SelMove.NextCell:r.col=r.rightCol;break;case SelMove.None:r.col=n.col}return r},e.prototype._adjustSelection=function(e){switch(this._mode){case SelectionMode.Cell:return new CellRange(e.row,e.col,e.row,e.col);case SelectionMode.Row:return new CellRange(e.row,0,e.row,this._g.columns.length-1);case SelectionMode.RowRange:case SelectionMode.ListBox:return new CellRange(e.row,0,e.row2,this._g.columns.length-1)}return e},e}();exports._SelectionHandler=_SelectionHandler;var KeyAction;!function(e){e[e.None=0]="None",e[e.MoveDown=1]="MoveDown",e[e.MoveAcross=2]="MoveAcross",e[e.Cycle=3]="Cycle",e[e.CycleOut=4]="CycleOut"}(KeyAction=exports.KeyAction||(exports.KeyAction={}));var _KeyboardHandler=function(){function e(e){this._kaTab=KeyAction.None,this._kaEnter=KeyAction.MoveDown,this._g=e;var t=e.hostElement;e.addEventListener(t,"keypress",this._keypress.bind(this)),e.addEventListener(t,"keydown",this._keydown.bind(this))}return e.prototype._keydown=function(e){var t=this._g,o=t._edtHdl,i=t.selection,n=e.ctrlKey||e.metaKey,r=e.shiftKey,s=(e.target,!0);if(this._altDown=!1,!t._wantsInput(e.target)){var l=e.defaultPrevented&&!(e.target instanceof HTMLInputElement);if(t.isRangeValid(i)&&!l&&(!t.activeEditor||!o._keydown(e))){var a=wjcCore.tryCast(t.rows[i.row],GroupRow),c=t.editableCollectionView,h=t._getKeyCode(e);if(t.autoClipboard){if(n&&(67==h||45==h)){var u=new CellRangeEventArgs(t.cells,i);if(t.onCopying(u)){var d=t.getClipString()+"\r\n";wjcCore.Clipboard.copy(d),t.onCopied(u)}return void e.stopPropagation()}if(n&&86==h||r&&45==h)return t.isReadOnly||wjcCore.Clipboard.paste(function(e){t.setClipString(e)}),void e.stopPropagation()}var g=SelMove,p=SelectionMode;switch(h){case wjcCore.Key.Space:if(r&&i.isValid)switch(t.selectionMode){case p.CellRange:case p.Row:case p.RowRange:case p.ListBox:t.select(new CellRange(i.row,0,i.row,t.columns.length-1))}else if(n&&i.isValid)switch(t.selectionMode){case p.CellRange:t.select(new CellRange(0,i.col,t.rows.length-1,i.col))}else(s=this._startEditing(!0,e))&&setTimeout(function(){var e=t.activeEditor;e&&(e.disabled||e.readOnly?t.finishEditing():"checkbox"==e.type?(e.checked=!e.checked,t.finishEditing()):wjcCore.setSelectionRange(e,e.value.length))});break;case 65:if(n)switch(t.selectionMode){case p.CellRange:case p.Row:case p.RowRange:case p.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}else s=!1;break;case wjcCore.Key.Left:n||e.altKey?s=!1:i.isValid&&0==i.col&&null!=a&&!a.isCollapsed&&a.hasChildren?a.isCollapsed=!0:this._moveSel(g.None,n?g.Home:g.Prev,r);break;case wjcCore.Key.Right:n||e.altKey?s=!1:i.isValid&&0==i.col&&null!=a&&a.isCollapsed?a.isCollapsed=!1:this._moveSel(g.None,n?g.End:g.Next,r);break;case wjcCore.Key.Up:n?s=!1:(this._altDown=e.altKey,e.altKey?s=o._toggleListBox(e):this._moveSel(g.Prev,g.None,r));break;case wjcCore.Key.Down:n?s=!1:(this._altDown=e.altKey,e.altKey?s=o._toggleListBox(e):this._moveSel(g.Next,g.None,r));break;case wjcCore.Key.PageUp:if(this._altDown=e.altKey,this._moveSel(e.altKey?g.Home:g.PrevPage,g.None,r),t.rows.frozen&&t.selection.row<t.rows.frozen){var f=t.scrollPosition;f.y&&(t.scrollPosition=new wjcCore.Point(f.x,0))}break;case wjcCore.Key.PageDown:this._altDown=e.altKey,this._moveSel(e.altKey?g.End:g.NextPage,g.None,r);break;case wjcCore.Key.Home:this._moveSel(n?g.Home:g.None,g.Home,r);break;case wjcCore.Key.End:this._moveSel(n?g.End:g.None,g.End,r);break;case wjcCore.Key.Tab:s=this._performKeyAction(t.keyActionTab,r);break;case wjcCore.Key.Enter:s=this._performKeyAction(t.keyActionEnter,r),!r&&c&&null!=c.currentEditItem&&o._commitRowEdits();break;case wjcCore.Key.Escape:if(s=!1,c&&(c.currentAddItem||c.currentEditItem)){var w=new CellRangeEventArgs(t.cells,t.selection);w.cancel=!0,t.onRowEditEnding(w),c.currentAddItem&&c.cancelNew(),c.currentEditItem&&c.cancelEdit(),t.onRowEditEnded(w),s=!0}t._mouseHdl.resetMouseState();break;case wjcCore.Key.Delete:case wjcCore.Key.Back:s=this._deleteSel(e);break;case wjcCore.Key.F2:s=this._startEditing(!0,e);break;case wjcCore.Key.F4:s=o._toggleListBox(e);break;default:s=!1}s&&(t.containsFocus()||t.focus(),e.preventDefault(),e.stopPropagation())}}},e.prototype._performKeyAction=function(e,t){var o=KeyAction,i=SelMove;switch(e){case o.MoveDown:return this._moveSel(t?i.Prev:i.Next,i.None,!1),!0;case o.MoveAcross:return this._moveSel(i.None,t?i.Prev:i.Next,!1),!0;case o.Cycle:return this._moveSel(i.None,t?i.PrevCell:i.NextCell,!1),!0;case o.CycleOut:var n=this._g.selection;return this._moveSel(i.None,t?i.PrevCell:i.NextCell,!1),!n.equals(this._g.selection)}return!1},e.prototype._keypress=function(e){var t=this,o=this._g,i=o._edtHdl;if(!o._wantsInput(e.target)&&!e.defaultPrevented)if(this._altDown)e.preventDefault();else if(o.activeEditor)i._keypress(e);else if(e.charCode>wjcCore.Key.Space)if(this._startEditing(!1,e)&&o.activeEditor){var n=wjcCore.getActiveElement();if(n instanceof HTMLInputElement&&"checkbox"!=n.type||n instanceof HTMLTextAreaElement){var r=o._selHdl.selection,s=o.getCellData(r.row,r.col,!0),l=o.getCellData(r.row,r.col,!1);n.value=String.fromCharCode(e.charCode),wjcCore.isNumber(l)&&s.indexOf("%")>-1&&(n.value+="%"),wjcCore.setSelectionRange(n,1),n.dispatchEvent(i._evtInput),i._keypress(e),i._edtValue=n.value!=s?n.value:null,e.preventDefault()}}else if(o.autoSearch){var a=!1,r=o._selHdl.selection;if(e.charCode>32||32==e.charCode&&this._search){e.preventDefault(),this._search+=String.fromCharCode(e.charCode).toLowerCase(),this._toSearch&&clearTimeout(this._toSearch),this._toSearch=setTimeout(function(){t._toSearch=null,t._search=""},wjcCore.Control._SEARCH_DELAY);var c=this._findNext(r.row,r.col);c<0&&this._search.length>1&&(this._search=this._search[this._search.length-1],c=this._findNext(r.row,r.col)),c>-1&&(a=!0,o.select(c,r.col))}a||(this._search="")}},e.prototype._findNext=function(e,t){var o=this._g,i=o.rows.length;(e<0||1==this._search.length)&&e++;for(var n=0;n<i;n++){var r=(e+n)%i;if(0==o.getCellData(r,t,!0).trim().toLowerCase().indexOf(this._search))return r}return-1},e.prototype._moveSel=function(e,t,o){this._g.selectionMode!=SelectionMode.None&&this._g._selHdl.moveSelection(e,t,o)},e.prototype._deleteSel=function(e){var t=this._g,o=t.editableCollectionView,i=t.selection,n=t.rows,r=[],s=new CellRange,l=new CellEditEndingEventArgs(t.cells,s,e),a=SelectionMode;if(t.allowDelete&&!t.isReadOnly&&(null==o||o.canRemove&&!o.isAddingNew&&!o.isEditingItem))switch(t.selectionMode){case a.CellRange:if(0==i.leftCol&&i.rightCol==t.columns.length-1)for(c=i.topRow;c>-1&&c<=i.bottomRow;c++)r.push(n[c]);break;case a.ListBox:for(c=0;c<n.length;c++)n[c].isSelected&&r.push(n[c]);break;case a.Row:i.topRow>-1&&r.push(n[i.topRow]);break;case a.RowRange:for(var c=i.topRow;c>-1&&c<=i.bottomRow;c++)r.push(n[c])}if(r.length>0){if(t.deferUpdate(function(){o&&o.beginUpdate();for(var e=r.length-1;e>=0;e--){var i=r[e];s.setRange(i.index,-1),t.onDeletingRow(l)&&(o&&i.dataItem?o.remove(i.dataItem):t.rows.removeAt(i.index),t.onDeletedRow(l))}o&&o.endUpdate()}),t.selectionMode==a.ListBox){var h=t.selection.row;h>-1&&h<t.rows.length&&(t.rows[h].isSelected=!0)}return t.childItemsPath&&t.collectionView&&t.collectionView.refresh(),!0}if(!t.isReadOnly&&0==r.length){var u=!1,d=t.scrollPosition;return t.deferUpdate(function(){for(var e=i.topRow;e<=i.bottomRow;e++){var n=t.rows[e];if(!n.isReadOnly)for(var r=i.leftCol;r<=i.rightCol;r++){var a=t._getBindingColumn(t.cells,e,t.columns[r]);if(!a.getIsRequired()&&!a.isReadOnly&&t.getCellData(e,r,!0)&&(s.setRange(e,r),l.cancel=!1,t.onBeginningEdit(l))){if(o){var c=o.currentEditItem;!u&&c&&c!=n.dataItem&&(u=!0,o.beginUpdate()),c=n.dataItem,o.editItem(c),t._edtHdl._edItem=c}t.setCellData(e,r,"",!0,!1),t.onCellEditEnding(l),t.onCellEditEnded(l)}}}t.selection=i,t.scrollPosition=d,u&&o.endUpdate()}),!0}return!1},e.prototype._startEditing=function(e,t,o,i){return this._g._edtHdl.startEditing(e,o,i,!0,t)},e}();exports._KeyboardHandler=_KeyboardHandler;var _AR_ALLCELLS=4,_WJC_DRAGSRC="wj-state-dragsrc",AllowResizing;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both",e[e.ColumnsAllCells=e.Columns|_AR_ALLCELLS]="ColumnsAllCells",e[e.RowsAllCells=e.Rows|_AR_ALLCELLS]="RowsAllCells",e[e.BothAllCells=e.Both|_AR_ALLCELLS]="BothAllCells"}(AllowResizing=exports.AllowResizing||(exports.AllowResizing={}));var AutoSizeMode;!function(e){e[e.None=0]="None",e[e.Headers=1]="Headers",e[e.Cells=2]="Cells",e[e.Both=3]="Both"}(AutoSizeMode=exports.AutoSizeMode||(exports.AutoSizeMode={}));var AllowDragging;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both"}(AllowDragging=exports.AllowDragging||(exports.AllowDragging={}));var _MouseHandler=function(){function e(e){var t=this;this._tsLast=0;var o=e.hostElement,i=e.addEventListener.bind(e),n=e.removeEventListener.bind(e);this._g=e,this._dvMarker=wjcCore.createElement('<div class="wj-marker">&nbsp;</div>'),i(o,"mousedown",function(o){if(e._rcBounds=null,!o.defaultPrevented&&0==o.button){var l=o.target;if(!e.containsFocus()){var a=l instanceof HTMLElement&&l.tabIndex>-1?l:e._eFocus;e._setFocusNoScroll(a)}if(setTimeout(function(){o.defaultPrevented||e.focus()}),wjcCore.closest(l,".wj-flexgrid")!=e.hostElement||!e.activeEditor&&e._isInputElement(l)){var c=e.hitTest(o);switch(c.cellType){case CellType.Cell:e.select(c.range,!1),l.focus();break;case CellType.ColumnHeader:case CellType.ColumnFooter:e.scrollIntoView(-1,c.col);break;case CellType.RowHeader:e.scrollIntoView(c.row,-1)}return}var h=document;n(h,"mousemove"),n(h,"mouseup"),i(h,"mousemove",r),i(h,"mouseup",s),t._isDown=!0,t._mousedown(o)}});var r=function(e){t._mousemove(e)},s=function(e){t._isDown=!1,n(document,"mousemove"),n(document,"mouseup"),t._mouseup(e)};i(o,"mouseup",function(e){t._tsLast=Date.now()}),i(o,"mouseenter",function(t){e._rcBounds=null}),i(o,"mousemove",this._hover.bind(this)),i(o,"dblclick",this._dblclick.bind(this)),i(o,"click",this._click.bind(this)),i(o,"selectstart",function(t){e._isInputElement(t.target)||t.preventDefault()}),i(o,"wheel",function(t){if(!t.defaultPrevented&&t.deltaY&&!t.ctrlKey&&!t.metaKey){var o=e.cells.hostElement.parentElement,i=t.deltaY,n=0;if(o.scrollHeight>o.offsetHeight&&wjcCore.closest(t.target,".wj-flexgrid")==e.hostElement){switch(t.deltaMode){case 1:n=e.rows.defaultSize*(i<0?-1:1);break;case 2:n=o.clientHeight*(i<0?-1:1);break;case 0:default:wjcCore.isSafari()&&(i=wjcCore.clamp(i,-150,150)),n=i}o.scrollTop+=n,t.preventDefault()}}}),i(o,"dragstart",this._dragstart.bind(this)),i(o,"dragover",this._dragover.bind(this)),i(o,"dragleave",this._dragover.bind(this)),i(o,"drop",this._drop.bind(this)),i(o,"dragend",this._dragend.bind(this)),this._enableTouchResizing()}return e.prototype.resetMouseState=function(){this._updating&&(this._updating=!1,this._g.endUpdate()),this._dragSrc&&wjcCore.removeClass(this._dragSrc,_WJC_DRAGSRC),this._showDragMarker(null);var e=this._g.hostElement;e&&(e.style.cursor="");var t=this._g;t.removeEventListener(document,"mousemove"),t.removeEventListener(document,"mouseup"),this._tsLast=Date.now(),this._eMouse=null,this._isDown=null,this._htDown=null,this._lbSelRows=null,this._szRowCol=null,this._szArgs=null},e.prototype._enableTouchResizing=function(){var e=this,t=this._g,o=t.hostElement,i="ontouchstart"in window?["touchstart","touchmove","touchend"]:"onpointerdown"in window?["pointerdown","pointermove","pointerup"]:null;i&&(t.addEventListener(o,i[0],function(i){if((null==i.pointerType||"touch"==i.pointerType)&&!wjcCore.closest(i.target,".wj-elem-filter")){var n=wjcCore.closest(i.target,".wj-cell");n instanceof HTMLElement&&(t._rcBounds=null,e._htDown=null,e._hover(i),e._szRowCol&&(n.removeAttribute("draggable"),o.style.touchAction="none",e._mousedown(i),i.preventDefault()))}}),t.addEventListener(o,i[1],function(t){null!=t.pointerType&&"touch"!=t.pointerType||e._szRowCol&&(e._mousemove(t),t.preventDefault())}),t.addEventListener(o,i[2],function(t){if((null==t.pointerType||"touch"==t.pointerType)&&e._szRowCol){if(e._szArgs)e._finishResizing(e._eMouse);else{var i=wjcCore.closest(t.target,".wj-cell");i instanceof HTMLElement&&i.click()}e.resetMouseState(),o.style.touchAction=""}}))},e.prototype._mousedown=function(e){var t=this._g,o=t.hitTest(e),i=o.cellType,n=e.ctrlKey||e.metaKey,r=e.target;if(this._selDown=t.selection,o.panel==t.cells){if(wjcCore.closestClass(r,CellFactory._WJC_DROPDOWN))return t._edtHdl._toggleListBox(e,o.range),void e.preventDefault();if(t.editRange&&t.editRange.contains(o.range))return}var s=wjcCore.getActiveElement();if(r!=s||!t._isInputElement(r)){if(i==CellType.None)return t.finishEditing(),void(r!=t._root&&r!=t._fCt&&t._edtHdl._commitRowEdits());if(this._htDown=o,this._eMouse=e,null!=this._szRowCol)return s!=t._eFocus&&(t._eFocus.tabIndex=0,t._eFocus.focus()),void this._handleResizing(e);switch(i){case CellType.Cell:n&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(o.row),this._mouseSelect(e,e.shiftKey);break;case CellType.RowHeader:0==(this._g.allowDragging&AllowDragging.Rows)&&(n&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(o.row),this._mouseSelect(e,e.shiftKey),e.preventDefault(),t.focus())}if(i==CellType.Cell&&t.rows.maxGroupLevel>-1&&wjcCore.closestClass(r,CellFactory._WJC_COLLAPSE)){var l=wjcCore.tryCast(t.rows[o.row],GroupRow);if(l)return n?t.collapseGroupsToLevel(l.isCollapsed?l.level+1:l.level):l.isCollapsed=!l.isCollapsed,void this.resetMouseState()}}},e.prototype._mousemove=function(e){if(null!=this._htDown){if(0==e.buttons&&this._eMouse&&e.timeStamp-this._eMouse.timeStamp>600)return void this.resetMouseState();if(this._eMouse=e,this._szRowCol)this._handleResizing(e);else switch(this._htDown.cellType){case CellType.Cell:this._mouseSelect(e,!0);break;case CellType.RowHeader:0==(this._g.allowDragging&AllowDragging.Rows)&&this._mouseSelect(e,!0)}}},e.prototype._mouseup=function(e){if(!this._g.isTouching||!(this._dragSrc||e.target instanceof HTMLHtmlElement)){var t=this._g,o=t.hitTest(e),i=this._htDown,n=SelectionMode;if(i&&!e.defaultPrevented)if(this._szArgs)this._finishResizing(e);else if(i.panel!=t.topLeftCells||this._szArgs)i.panel!=t.columnHeaders||e.dataTransfer?i.panel==t.cells&&(this._szRowCol||e.ctrlKey||e.metaKey||e.shiftKey||o.panel==i.panel&&o.range.equals(i.range)&&t.selection.equals(this._selDown)&&t._edtHdl.startEditing(!0,o.row,o.col,!0,e)):o.panel==i.panel&&o.col==i.col&&!o.edgeRight&&o.col>-1&&this._clickSort(e,o);else if(o.panel==i.panel&&o.row==i.row&&o.col==i.col&&t.rows.length&&t.columns.length)switch(t.selectionMode){case n.CellRange:case n.RowRange:case n.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}this.resetMouseState()}},e.prototype._click=function(e){Date.now()-this._tsLast>50&&!e.pointerType&&this._handleClick(e)},e.prototype._handleClick=function(e){var t=this._g,o=e.target,i=new HitTestInfo(o,null),n=i.panel;if(!e.defaultPrevented&&i.grid==t&&!t._isInputElement(o))if(n==t.topLeftCells)t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1));else if(n==t.columnHeaders)this._clickSort(e,i);else if(n==t.rowHeaders)t.select(new CellRange(i.row,0,i.row,t.columns.length-1));else if(n==t.cells)if(i.row<0)this._clickSort(e,i);else if(wjcCore.closestClass(o,CellFactory._WJC_COLLAPSE)){var r=t.rows[i.row];r instanceof GroupRow&&(e.ctrlKey?t.collapseGroupsToLevel(r.isCollapsed?r.level+1:r.level):r.isCollapsed=!r.isCollapsed)}else wjcCore.closestClass(o,CellFactory._WJC_DROPDOWN)?t._edtHdl._toggleListBox(e,i.range):t.select(i.range)},e.prototype._clickSort=function(e,t){var o=this._g,i=o.collectionView,n=e.ctrlKey||e.metaKey;if(i&&i.canSort&&o.allowSorting){t.range.bottomRow;var r=t.panel.columns[t.col],s=o._getBindingColumn(t.panel,t.row,r),l=s?s._getBindingSort():null;if(s.allowSorting&&l){for(var a=t.grid.collectionView.sortDescriptions,c=null,h=0;h<a.length;h++)if(a[h].property==l){c=!a[h].ascending;break}if(null==c){if(n)return;c=!0}var u=new CellRangeEventArgs(t.panel,t.range,e);o.onSortingColumn(u)&&(o._edtHdl._commitRowEdits(),n?a.clear():a.splice(0,a.length,new wjcCore.SortDescription(l,c)),o.onSortedColumn(u))}}},e.prototype._dblclick=function(e){var t,o=this._g,i=o.hitTest(e),n=i.cellType,r=o.selection,s=i.range;if(!e.defaultPrevented)if(i.edgeRight&&o.allowResizing&AllowResizing.Columns){if(n==CellType.ColumnHeader||n==CellType.Cell&&o.allowResizing&_AR_ALLCELLS){e.preventDefault(),e.ctrlKey&&r.containsColumn(i.col)&&(s=r);for(var l=s.leftCol;l<=s.rightCol;l++)o.columns[l].allowResizing&&(t=new CellRangeEventArgs(o.cells,new CellRange(-1,l)),o.onAutoSizingColumn(t)&&o.onResizingColumn(t)&&(o.autoSizeColumn(l),o.onResizedColumn(t),o.onAutoSizedColumn(t)))}else n==CellType.TopLeft&&i.panel.columns[i.col].allowResizing&&(e.preventDefault(),t=new CellRangeEventArgs(i.panel,new CellRange(-1,i.col)),o.onAutoSizingColumn(t)&&o.onResizingColumn(t)&&(o.autoSizeColumn(i.col,!0),o.onAutoSizedColumn(t),o.onResizedColumn(t)));this.resetMouseState()}else if(i.edgeBottom&&o.allowResizing&AllowResizing.Rows){if(n==CellType.RowHeader||n==CellType.Cell&&o.allowResizing&_AR_ALLCELLS){e.ctrlKey&&r.containsRow(i.row)&&(s=r);for(var a=s.topRow;a<=s.bottomRow;a++)o.rows[a].allowResizing&&(t=new CellRangeEventArgs(o.cells,new CellRange(a,-1)),o.onAutoSizingRow(t)&&o.onResizingRow(t)&&(o.autoSizeRow(a),o.onResizedRow(t),o.onAutoSizedRow(t)))}else n==CellType.TopLeft&&i.panel.rows[i.row].allowResizing&&(t=new CellRangeEventArgs(i.panel,new CellRange(i.row,-1)),o.onAutoSizingRow(t)&&o.onResizingRow(t)&&(o.autoSizeRow(i.row,!0),o.onResizedRow(t),o.onAutoSizedRow(t)));this.resetMouseState()}else;},e.prototype._hover=function(e){if(!this._isDown){var t=this._g,o=t.hitTest(e),i=(o.panel,o.cellType),n="";return this._szRowCol=null,(i==CellType.ColumnHeader||i==CellType.TopLeft||i==CellType.Cell&&t.allowResizing&_AR_ALLCELLS)&&o.edgeRight&&0!=(t.allowResizing&AllowResizing.Columns)&&(this._szRowCol=this._getResizeCol(o)),(i==CellType.RowHeader||i==CellType.TopLeft||i==CellType.Cell&&t.allowResizing&_AR_ALLCELLS)&&o.edgeBottom&&0!=(t.allowResizing&AllowResizing.Rows)&&(this._szRowCol=this._getResizeRow(o)),this._szRowCol instanceof Column?n="col-resize":this._szRowCol instanceof Row&&(n="row-resize"),this._szStart=this._szRowCol?this._szRowCol.renderSize:0,t.hostElement.style.cursor=n,o}return null},e.prototype._getResizeCol=function(e){for(var t=e.panel.columns,o=t[e.col],i=e.col+1;i<t.length;i++)if((n=t[i]).visible){n.renderSize<1&&(o=n);break}if(e.col==t.length-1&&(e.cellType==CellType.TopLeft||e.cellType==CellType.RowHeader)){t=this._g.columns;for(i=0;i<t.length;i++){var n=t[i];if(n.visible){n.renderSize<1&&(o=n);break}}}return o.allowResizing?o:null},e.prototype._getResizeRow=function(e){for(var t=e.panel.rows,o=t[e.row],i=e.row+1;i<t.length;i++)if((n=t[i]).visible){n.renderSize<1&&(o=n);break}if(e.row==t.length-1&&(e.cellType==CellType.TopLeft||e.cellType==CellType.ColumnHeader)){t=this._g.rows;for(i=0;i<t.length;i++){var n=t[i];if(n.visible){n.renderSize<1&&(o=n);break}}}return o.allowResizing?o:null},e.prototype._mouseSelect=function(e,t){var o=this,i=this._g;if(e&&this._htDown&&this._htDown.panel&&i.selectionMode!=SelectionMode.None){var n=new HitTestInfo(this._htDown.panel,e);this._handleSelection(n,t),!wjcCore.isIE9()&&e.button>=0&&e.target!=i._root&&(n=new HitTestInfo(i,e)).cellType!=CellType.Cell&&n.cellType!=CellType.RowHeader&&this._eMouse&&setTimeout(function(){o._eMouse&&o._mouseSelect(o._eMouse,t)},100)}},e.prototype._handleResizing=function(t){if(t.preventDefault(),this._szRowCol instanceof Column){var o=this._g,i=wjcCore.mouseToPage(t).x,n=Math.round(Math.max(e._SZ_MIN,this._szStart+(i-this._htDown.point.x)*(o.rightToLeft?-1:1)));if(this._szRowCol.renderSize!=n){if(null==this._szArgs){s=o.rowHeaders.columns.indexOf(this._szRowCol)>-1?o.rowHeaders:o.cells;this._szArgs=new CellRangeEventArgs(s,new CellRange(-1,this._szRowCol.index))}this._szArgs.cancel=!1,o.onResizingColumn(this._szArgs)&&(o.deferResizing?this._showResizeMarker(n):this._szRowCol.width=n)}}if(this._szRowCol instanceof Row){var o=this._g,r=wjcCore.mouseToPage(t).y,n=Math.round(Math.max(e._SZ_MIN,this._szStart+(r-this._htDown.point.y)));if(this._szRowCol.renderSize!=n){if(null==this._szArgs){var s=o.columnHeaders.rows.indexOf(this._szRowCol)>-1?o.columnHeaders:o.cells;this._szArgs=new CellRangeEventArgs(s,new CellRange(this._szRowCol.index,-1))}this._szArgs.cancel=!1,o.onResizingRow(this._szArgs)&&(o.deferResizing?this._showResizeMarker(n):this._szRowCol.height=n)}}},e.prototype._dragstart=function(e){var t=this._g,o=this._htDown,i=AllowDragging;if(o){if(this._dragSrc=null,this._htDrag=null,!this._szRowCol){var n=new CellRangeEventArgs(o.panel,o.range);if(o.cellType==CellType.ColumnHeader&&t.allowDragging&i.Columns&&o.col>-1&&t.columns[o.col].allowDragging)t.onDraggingColumn(n)?this._dragSrc=e.target:e.preventDefault();else if(o.cellType==CellType.RowHeader&&t.allowDragging&i.Rows&&o.row>-1&&t.rows[o.row].allowDragging){var r=t.rows[o.row];r instanceof GroupRow||r instanceof _NewRowTemplate||(t.onDraggingRow(n)?this._dragSrc=e.target:e.preventDefault())}else o.cellType==CellType.TopLeft&&t.allowDragging&i.Columns&&o.col>-1&&t.topLeftCells.columns[o.col].allowDragging&&(t.onDraggingColumn(n)?this._dragSrc=e.target:e.preventDefault())}this._dragSrc&&e.dataTransfer&&!e.defaultPrevented&&(this._htDrag=o,wjcCore._startDrag(e.dataTransfer,"move"),e.stopPropagation(),wjcCore.addClass(this._dragSrc,_WJC_DRAGSRC),t.beginUpdate(),this._updating=!0)}},e.prototype._dragend=function(e){this._dragSrc=null,this._htDrag=null,this.resetMouseState()},e.prototype._dragover=function(e){var t=this._g,o=t.hitTest(e),i=this._dragSrc?this._htDrag:null,n=CellType,r=!1;if(i&&o.cellType==i.cellType){var s=new CellRangeEventArgs(o.panel,o.range,i);o.cellType==n.ColumnHeader?(s.cancel=!t.columns.canMoveElement(i.col,o.col),r=t.onDraggingColumnOver(s)):o.cellType==n.RowHeader?(s.cancel=!t.rows.canMoveElement(i.row,o.row),r=t.onDraggingRowOver(s)):o.cellType==n.TopLeft&&(s.cancel=!t.topLeftCells.columns.canMoveElement(i.col,o.col),r=t.onDraggingColumnOver(s))}if(r?(e.dataTransfer.dropEffect="move",this._showDragMarker(o),e.preventDefault(),e.stopPropagation()):this._showDragMarker(null),i&&t.autoScroll){var l=t._rcBounds,a=t.scrollPosition,c=wjcCore.Control._DRAG_SCROLL_EDGE,h=wjcCore.Control._DRAG_SCROLL_STEP;i.panel==t.columnHeaders?(e.pageX-l.left<c&&(a.x+=h),l.right-e.pageX<c&&(a.x-=h)):i.panel==t.rowHeaders&&(e.pageY-l.top<c&&(a.y+=h),l.bottom-e.pageY<c&&(a.y-=h)),a.equals(t._ptScrl)||(t.scrollPosition=a)}},e.prototype._drop=function(e){var t=this._g,o=t.hitTest(e),i=this._dragSrc?this._htDrag:null,n=CellType;if(i&&o.cellType==i.cellType){var r=t.selection,s=new CellRangeEventArgs(o.panel,o.range,i);o.cellType==n.ColumnHeader?(t.columns.moveElement(i.col,o.col),t.select(r.row,o.col),t.onDraggedColumn(s)):o.cellType==n.RowHeader?(t.rows.moveElement(i.row,o.row),t.select(o.row,r.col),t.onDraggedRow(s)):o.cellType==n.TopLeft&&(t.topLeftCells.columns.moveElement(i.col,o.col),t.onDraggedColumn(s))}this.resetMouseState()},e.prototype._showResizeMarker=function(e){var t=this._g,o=this._dvMarker,i=t.cells.hostElement;o.parentElement!=i&&i.appendChild(o);var n,r=this._szArgs.panel.cellType,s=CellType;this._szRowCol instanceof Column?(n={left:this._szRowCol.pos+e-1,top:-1e3,right:"",bottom:0,width:3,height:""},t.rightToLeft&&(n.left=i.clientWidth-n.left-n.width),r!=s.TopLeft&&r!=s.RowHeader||(n.left-=t._eTL.offsetWidth)):(n={left:-1e3,top:this._szRowCol.pos+e-1,right:0,bottom:"",width:"",height:3},r!=s.TopLeft&&r!=s.ColumnHeader||(n.top-=t._eTL.offsetHeight)),wjcCore.setCss(o,n)},e.prototype._showDragMarker=function(e){var t=this._g,o=this._dvMarker;if(!e||!e.panel)return wjcCore.removeChild(o),void(this._rngTarget=null);if(!e.range.equals(this._rngTarget)){this._rngTarget=e.range;var i=e.panel.hostElement;o.parentElement!=i&&i.appendChild(o);var n=CellType,r={left:0,top:0,width:6,height:6,right:"",bottom:""};switch(e.cellType){case n.TopLeft:case n.ColumnHeader:r.height=e.panel.height;var s=e.panel.columns[e.col];r.left=s.pos-r.width/2,this._htDown&&e.col>this._htDown.col&&(r.left+=s.renderWidth),t.rightToLeft&&(r.left=o.parentElement.clientWidth-r.left-r.width);break;case n.RowHeader:r.width=e.panel.width;var l=e.panel.rows[e.row];r.top=l.pos-r.height/2,e.row>this._htDown.row&&(r.top+=l.renderHeight)}wjcCore.setCss(o,r)}},e.prototype._finishResizing=function(t){var o=this._g,i=o.selection,n=this._szArgs,r=this._eMouse&&this._eMouse.ctrlKey,s=CellType;if(n&&!n.cancel){if(n.col>-1){var l=n.col,a=wjcCore.mouseToPage(t).x,c=Math.round(Math.max(e._SZ_MIN,this._szStart+(a-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));if(n.panel.columns[l].width=Math.round(c),o.onResizedColumn(n),r&&this._htDown.cellType==s.ColumnHeader&&i.containsColumn(l))for(var h=i.leftCol;h<=i.rightCol;h++)o.columns[h].allowResizing&&h!=l&&(n=new CellRangeEventArgs(o.cells,new CellRange(-1,h)),o.onResizingColumn(n)&&(o.columns[h].size=o.columns[l].size,o.onResizedColumn(n)))}if(n.row>-1){var l=n.row,u=wjcCore.mouseToPage(t).y,c=Math.round(Math.max(e._SZ_MIN,this._szStart+(u-this._htDown.point.y)));if(n.panel.rows[l].height=Math.round(c),o.onResizedRow(n),r&&this._htDown.cellType==s.RowHeader&&i.containsRow(l))for(var d=i.topRow;d<=i.bottomRow;d++)o.rows[d].allowResizing&&d!=l&&(n=new CellRangeEventArgs(o.cells,new CellRange(d,-1)),o.onResizingRow(n)&&(o.rows[d].size=o.rows[l].size,o.onResizedRow(n)))}}},e.prototype._startListBoxSelection=function(e){var t=this._g.rows;this._lbSelState=!t[e].isSelected,this._lbSelRows={};for(var o=0;o<t.length;o++)t[o].isSelected&&(this._lbSelRows[o]=!0)},e.prototype._handleSelection=function(e,t){var o=this._g,i=o.rows,n=o._selHdl.selection,r=new CellRange(e.row,e.col);if(e.row>-1&&e.col>-1)if(null!=this._lbSelRows){var s=!1;r=new CellRange(e.row,e.col,this._htDown.row,this._htDown.col);for(var l=0;l<i.length;l++){var a=r.containsRow(l)?this._lbSelState:null!=this._lbSelRows[l];if(a!=i[l].isSelected){var c=new CellRangeEventArgs(o.cells,new CellRange(l,n.col,l,n.col2));o.onSelectionChanging(c)&&(i[l]._setFlag(RowColFlags.Selected,a,!0),s=!0,o.onSelectionChanged(c))}}s&&o.refreshCells(!1,!0,!0),o.scrollIntoView(e.row,e.col)}else e.cellType==CellType.RowHeader&&(r.col=0,r.col2=o.columns.length-1),t&&(r.row2=n.row2,r.col2=n.col2),o.select(r)},e._SZ_MIN=0,e}();exports._MouseHandler=_MouseHandler;var _WJC_CHECKBOX="wj-cell-check",_PAGE_SIZE=4,_EditHandler=function(){function e(e){var t=this;this._fullEdit=!1,this._list=null,this._g=e,this._evtInput=document.createEvent("HTMLEvents"),this._evtInput.initEvent("input",!0,!1),this._evtChange=document.createEvent("HTMLEvents"),this._evtChange.initEvent("change",!0,!1),e.selectionChanging.addHandler(function(o,i){if(t.finishEditing()){var n=e._selHdl.selection.row;if(n!=i.row){var r=e.rows.length;(n>-1&&n<r?e.rows[n].dataItem:null)!=(i.row>-1&&i.row<r?e.rows[i.row].dataItem:null)&&t._commitRowEdits()}}else i.cancel=!0}),e.lostFocus.addHandler(function(){if(!e.containsFocus()){var o=wjcCore.getActiveElement();o&&"fixed"==getComputedStyle(o).position||t._commitRowEdits()}});var o=e.hostElement;e.addEventListener(o,"mousedown",function(o){if(!o.defaultPrevented&&0==o.button&&!e._mouseHdl._szRowCol){e.selection;var i=e.hitTest(o);if(i.cellType!=CellType.Cell&&i.cellType!=CellType.None)t.finishEditing();else if(i.cellType!=CellType.None){var n=wjcCore.tryCast(o.target,HTMLInputElement);t._isNativeCheckbox(n)&&(n!=t.activeEditor&&(o.preventDefault(),t.startEditing(!1,i.row,i.col,!0,o)&&(n=t.activeEditor)),!n||"checkbox"!=n.type||n.disabled||n.readOnly||(n.checked=!n.checked,n.focus(),t.finishEditing()))}}},!0),e.addEventListener(o,"click",function(e){t._isNativeCheckbox(e.target)&&e.preventDefault()}),e.addEventListener(o,"compositionend",this._keypress.bind(this))}return e.prototype.startEditing=function(e,t,o,i,n){void 0===e&&(e=!0);var r=this._g;if(t=wjcCore.asNumber(t,!0,!0),o=wjcCore.asNumber(o,!0,!0),null==t&&(t=r.selection.row),null==o&&(o=r.selection.col),null==i&&(i=!0),!this._allowEditing(t,o))return!1;var s=r.getMergedRange(r.cells,t,o,!1);s||(s=new CellRange(t,o));var l=r.rows[t].dataItem;if(r.scrollIntoView(s.row,s.col,!0),r.select(s,!0),!r.rows[t]||l!=r.rows[t].dataItem)return!1;if(s.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing())return!1;var a=new CellRangeEventArgs(r.cells,s,n);if(!r.onBeginningEdit(a))return!1;var c=r.editableCollectionView,h=!1;c&&((h=(l=r.rows[t].dataItem)!=c.currentEditItem)&&r.onRowEditStarting(a),c.editItem(l),h&&(r.onRowEditStarted(a),this._edItem=l)),this._fullEdit=wjcCore.asBoolean(e),this._rng=s,this._list=null;var u=r.columns[o].dataMap;u&&(this._list=u.getDisplayValues(l)),s.isSingleCell?this._updateEditorCell(t,o,h):r.refresh(!1);var d=this._edt;if(d){if("checkbox"==d.type)this._fullEdit=!1;else if(i){r._setFocusNoScroll(d);var g=wjcCore.culture.Globalize.numberFormat["%"]||"%";if(wjcCore.isNumber(r.getCellData(t,o,!1))&&d.value.indexOf(g)>-1){for(var p=d.value,f=0,w=p.length;w>0&&p[w-1]==g;)w--;for(;f<w&&p[f]==g;)f++;wjcCore.setSelectionRange(d,f,w)}else wjcCore.setSelectionRange(d,0,d.value.length)}if(r.onPrepareCellForEdit(a),d.disabled||d.readOnly)return!1}return null!=d&&!d.disabled&&!d.readOnly},e.prototype.finishEditing=function(e){var t=this._edt;if(!t)return this._removeListBox(),!0;var o=this._g,i=this._rng,n=new CellEditEndingEventArgs(o.cells,i),r=o.containsFocus(),s=o.hostElement.querySelector(".wj-control.wj-state-focused");if(s){var l=wjcCore.Control.getControl(s);l&&l.onLostFocus(n)}if(n.cancel=e,!e&&o.validateEdits){var a=this._getValidationError();if(a){n.cancel=!0;var c=t.parentElement;c&&(wjcCore.toggleClass(c,"wj-state-invalid",!0),c.title=a,n.stayInEditMode=!0)}}if(!o.onCellEditEnding(n)&&n.stayInEditMode)return r?setTimeout(function(){t.select()}):t.select(),!1;if(!n.cancel){n.data=o.cells.getCellData(i.topRow,i.leftCol,!1);for(var h=o.cellFactory.getEditorValue(o),u=i.topRow;u<=i.bottomRow&&u<o.rows.length;u++)for(var d=i.leftCol;d<=i.rightCol&&d<o.columns.length;d++)o.cells.setCellData(u,d,h,!0,!1);t.value==this._edtValue&&t.dispatchEvent(this._evtChange)}this._edt=null,this._rng=null,this._list=null,this._edtValue=null,this._removeListBox();var g=wjcCore.closest(t,".wj-cell");return wjcCore.contains(g,wjcCore.getActiveElement())&&g.focus(),n.cancel||!n.refresh?this._updateEditorCell(i.row,i.col,!1):o.refresh(!1),r&&o.focus(),o.onCellEditEnded(n),!0},Object.defineProperty(e.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0}),e.prototype.getClipString=function(e){var t=this._g,o="",i=!0,n=SelectionMode;if(!e)switch(e=t.selection,t.selectionMode){case n.Row:case n.RowRange:e.col=0,e.col2=t.columns.length-1;break;case n.ListBox:e.col=0,e.col2=t.columns.length-1;for(var r=0;r<t.rows.length;r++)t.rows[r].isSelected&&t.rows[r].isVisible&&(e.row=e.row2=r,o&&(o+="\n"),o+=this.getClipString(e));return o}for(var s=(e=wjcCore.asType(e,CellRange)).topRow;s<=e.bottomRow;s++)if(t.rows[s].isVisible){i||(o+="\n"),i=!1;for(var l=e.leftCol,a=!0;l<=e.rightCol;l++)if(t.columns[l].isVisible){a||(o+="\t"),a=!1;var c=t.getCellData(s,l,!0);(c=c.replace(/\t/g," ")).indexOf("\n")>-1&&(c='"'+c.replace(/"/g,'""')+'"'),o+=c}}return o},e.prototype.setClipString=function(e,t){var o=this,i=this._g,n=null==t,r=SelectionMode;if(!t)switch(t=i.selection,i.selectionMode){case r.Row:case r.RowRange:case r.ListBox:t.col=0,t.col2=i.columns.length-1}t=wjcCore.asType(t,CellRange);var s=this._parseClipString(wjcCore.asString(e));n&&!t.isSingleCell&&s.length&&this._expandClipRows(s,t);var l=new CellRange(t.topRow,t.leftCol,t.topRow+s.length-1,t.leftCol+s[0].length-1),a=new CellRangeEventArgs(i.cells,l);if(!i.onPasting(a))return!1;l=new CellRange(t.topRow,t.leftCol);var c=i.editableCollectionView,h=t.topRow,u=!1;i.deferUpdate(function(){c&&s.length>1&&c.beginUpdate();for(var e=0;e<s.length&&h<i.rows.length;e++,h++)if(i.rows[h].isVisible){for(var n=s[e],r=t.leftCol,d=0;d<n.length&&r<i.columns.length;d++,r++){var g=i.columns[r];if(g.isVisible){if(o._allowEditing(h,r)){var p=n[d];g.maxLength&&(p=p.substr(0,g.maxLength));var f=new CellRangeEventArgs(i.cells,new CellRange(h,r),p);i.onPastingCell(f)&&(c&&(c.editItem(i.rows[h].dataItem),o._edItem=c.currentEditItem),i.cells.setCellData(h,r,f.data)&&(i.onPastedCell(f),u=!0)),l.row2=Math.max(l.row2,h),l.col2=Math.max(l.col2,r)}}else d--}if(o._edItem&&c instanceof wjcCore.CollectionView){var w=new wjcCore.NotifyCollectionChangedEventArgs(wjcCore.NotifyCollectionChangedAction.Change,o._edItem,h);c.onCollectionChanged(w)}}else e--;if(c&&s.length>1&&c.endUpdate(),i.select(l),i.onPasted(a),u&&wjcCore.closest(i.hostElement,"form")){var _=wjcCore.createElement("<input>",i.hostElement),C=document.createEvent("HTMLEvents");C.initEvent("change",!0,!1),_.dispatchEvent(C),wjcCore.removeChild(_)}})},e.prototype._isNativeCheckbox=function(e){return e instanceof HTMLInputElement&&"checkbox"==e.type&&!e.disabled&&!e.readOnly&&wjcCore.hasClass(e,_WJC_CHECKBOX)&&wjcCore.closest(e,".wj-flexgrid")==this._g.hostElement},e.prototype._parseClipString=function(e){var t=[];e=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).replace(/\n$/,"");var o=0,i=0;for(o=0;o<e.length;o++){var n='"'==e[o]&&e[o+1]>=" ",r=!1,s=!1;for(i=o;i<e.length&&!s;i++){var l=e[i];switch(l){case'"':n&&(r=!r);break;case"\t":case"\n":r||(this._parseClipCell(t,e,o,i,"\n"==l),o=i,s=!0)}}if(i==e.length){this._parseClipCell(t,e,o,i,!1);break}}return 0==t.length&&t.push([""]),t},e.prototype._parseClipCell=function(e,t,o,i,n){e.length||e.push([]);var r=t.substr(o,i-o),s=r.length;s>1&&'"'==r[0]&&'"'==r[s-1]?r=(r=r.substr(1,s-2)).replace(/""/g,'"'):"\t"==r&&(r=""),e[e.length-1].push(r),n&&e.push([])},e.prototype._expandClipRows=function(e,t){for(var o=e.length,i=0,n=0;n<o;n++)i=Math.max(i,e[n].length);for(var r=this._g,s=0,l=0,a=t.topRow;a<=t.bottomRow;a++)r.rows[a].isVisible&&s++;for(c=t.leftCol;c<=t.rightCol;c++)r.columns[c].isVisible&&l++;if((s>1||l>1)&&(1==s&&(s=o),1==l&&(l=i),l%i==0&&s%o==0)){for(var c=i;c<l;c++)for(a=0;a<o;a++)e[a].push(e[a%o][c%i]);for(a=o;a<s;a++)e.push(e[a%o])}},e.prototype._updateEditorCell=function(e,t,o){var i=this._g,n=i.cells.getCellElement(e,t),r=i._useFrozenDiv()&&(e<i.frozenRows||t<i.frozenColumns);if(!n||r||i._hasPendingUpdates())i.refresh(!1);else if(this._updateCell(n),(o=o||i._getHasValidation())&&i.headersVisibility&HeadersVisibility.Row){var s=i.rowHeaders,l=s.columns.length-1,a=s.getCellElement(e,l);a&&this._updateCell(a)}},e.prototype._updateCell=function(e){var t=new HitTestInfo(e,null),o=FlexGrid._WJS_UPDATING;t.panel&&(wjcCore.addClass(e,o),t.grid.cellFactory.updateCell(t.panel,t.row,t.col,e,t.range),wjcCore.removeClass(e,o))},e.prototype._getValidationError=function(){var e=this._g;if(e._getHasValidation()){var t=this._rng.row,o=this._rng.col,i=e.cellFactory.getEditorValue(e),n=e.getCellData(t,o,!1);if(e.setCellData(t,o,i,!0,!1)){var r=e._getError(e.cells,t,o);return e.setCellData(t,o,n,!0,!1),r}}return null},e.prototype._allowEditing=function(e,t){var o=this._g;if(o.isReadOnly||o.selectionMode==SelectionMode.None)return!1;if(e<0||e>=o.rows.length||o.rows[e].isReadOnly||!o.rows[e].isVisible)return!1;if(t<0||t>=o.columns.length)return!1;var i=o._getBindingColumn(o.cells,e,o.columns[t]);return!(!i||i.isReadOnly||!i.isVisible)},e.prototype._commitRowEdits=function(){var e=this._g;if(this.finishEditing()&&this._edItem){var t=e.editableCollectionView;if(t&&(t.currentEditItem||t.currentAddItem)){var o=new CellRangeEventArgs(e.cells,e.selection);e.onRowEditEnding(o),t.commitEdit(),e.onRowEditEnded(o)}this._edItem=null}},e.prototype._keydown=function(e){var t=this._edt;switch(e.keyCode){case wjcCore.Key.F2:return this._fullEdit=!this._fullEdit,e.preventDefault(),!0;case wjcCore.Key.F4:return this._toggleListBox(e),e.preventDefault(),!0;case wjcCore.Key.Space:return!t||"checkbox"!=t.type||t.disabled||t.readOnly||(t.checked=!t.checked,this.finishEditing(),e.preventDefault()),!0;case wjcCore.Key.Enter:if(e.preventDefault(),t&&e.altKey){var o=e.target;if(o instanceof HTMLTextAreaElement&&"soft"==o.wrap){var i=o.value,n=o.selectionStart,r=o.selectionEnd;o.value=i.substr(0,n)+"\n"+i.substr(r),wjcCore.setSelectionRange(o,n+1)}return!0}return!this.finishEditing();case wjcCore.Key.Tab:return e.preventDefault(),!this.finishEditing();case wjcCore.Key.Escape:return e.preventDefault(),this.finishEditing(!0),!0;case wjcCore.Key.Up:case wjcCore.Key.Down:case wjcCore.Key.Left:case wjcCore.Key.Right:case wjcCore.Key.PageUp:case wjcCore.Key.PageDown:case wjcCore.Key.Home:case wjcCore.Key.End:if(this._lbx)return this._keydownListBox(e);if(e.altKey)switch(e.keyCode){case wjcCore.Key.Up:case wjcCore.Key.Down:return this._toggleListBox(e),e.preventDefault(),!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0},e.prototype._keydownListBox=function(e){var t=!0;if(this._lbx)switch(e.keyCode){case wjcCore.Key.Up:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case wjcCore.Key.Down:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex++;break;case wjcCore.Key.Home:case wjcCore.Key.PageUp:this._lbx.selectedIndex=0;break;case wjcCore.Key.End:case wjcCore.Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}return!!t&&(e.preventDefault(),!0)},e.prototype._keypress=function(e){var t=this._edt,o=e.charCode||32;if(t&&"checkbox"!=t.type&&wjcCore.getActiveElement()==t&&this._list&&this._list.length>0&&o>=32){var i=t.selectionStart,n=t.value.substr(0,i);e.target==t&&e.charCode&&(n+=String.fromCharCode(e.charCode),i++);var r=this._findString(this._list,n,!0);r<0&&(r=this._findString(this._list,n,!1)),r>-1&&(t.value=this._list[r],wjcCore.setSelectionRange(t,i,t.value.length),t.dispatchEvent(this._evtInput),e.preventDefault&&e.preventDefault())}},e.prototype._findString=function(e,t,o){o||(t=t.toLowerCase());for(var i=0;i<e.length;i++){var n=e[i];if(o||(n=n.toLowerCase()),0==n.indexOf(t))return i}return-1},e.prototype._toggleListBox=function(e,t){var o=this._g,i=o._selHdl.selection,n=o.isTouching;if(t||(t=i),this._lbx&&(this._removeListBox(),i.contains(t)))return o.activeEditor?o.activeEditor.focus():o.containsFocus()||o.focus(),!0;var r=o._getBindingColumn(o.cells,t.row,o.columns[t.col]);return!(!tryGetModuleWijmoInput()||!r.dataMap||!1===r.showDropDown)&&(!(!tryGetModuleWijmoInput()||!this.startEditing(!0,t.row,t.col,!n,e))&&(this._lbx=this._createListBox(),this._lbx.showSelection(),n&&this._lbx.focus(),!0))},e.prototype._createListBox=function(){var e=this,t=this._g,o=t.activeEditor,i=this._rng,n=t.rows[i.row],r=t._getBindingColumn(t.cells,i.row,t.columns[i.col]),s=document.createElement("div");this._removeListBox(),wjcCore.addClass(s,"wj-dropdown-panel wj-grid-listbox"),wjcCore.addClass(s,r.dropDownCssClass);var l=new(tryGetModuleWijmoInput().ListBox)(s,{maxHeight:4*n.renderHeight,isContentHtml:r.isContentHtml,itemsSource:r.dataMap.getDisplayValues(n.dataItem),selectedValue:o?o.value:t.getCellData(i.row,i.col,!0)});l.addEventListener(l.hostElement,"click",function(){e._removeListBox(),t.focus(),e.finishEditing()}),l.lostFocus.addHandler(function(){e._removeListBox()}),l.selectedIndexChanged.addHandler(function(){var o=t.activeEditor;o&&(o.value=l.selectedValue,o.dispatchEvent(e._evtInput),wjcCore.setSelectionRange(o,0,o.value.length))});var a=t.cells.getCellElement(i.row,i.col);if(a){wjcCore.showPopup(s,a,!1,!1,!1);var c=a.querySelector("."+CellFactory._WJC_DROPDOWN);wjcCore.setAttribute(c,"aria-expanded",!0)}else wjcCore.showPopup(s,t.getCellBoundingRect(i.row,i.col)),s[wjcCore.Control._OWNR_KEY]=t.hostElement;return l},e.prototype._removeListBox=function(){var e=this._lbx;e&&(this._lbx=null,wjcCore.hidePopup(e.hostElement,function(){e.dispose()}))},e}();exports._EditHandler=_EditHandler;var _AddNewHandler=function(){function e(e){this._nrt=new _NewRowTemplate,this._g=e,this._keydownBnd=this._keydown.bind(this),this._attach()}return Object.defineProperty(e.prototype,"newRowAtTop",{get:function(){return this._top},set:function(e){e!=this.newRowAtTop&&(this._top=wjcCore.asBoolean(e),this.updateNewRowTemplate())},enumerable:!0,configurable:!0}),e.prototype.updateNewRowTemplate=function(){var e=this._g,t=e.editableCollectionView,o=e.rows,i=t&&t.canAddNew&&e.allowAddNew&&!e.isReadOnly,n=o.indexOf(this._nrt),r=this._top?0:o.length-1,s=!1;if(!i&&n>-1){var l=e.selection;l.row==n&&e.select(l.row-1,l.col),o.removeAt(n)}else i&&(n<0?s=!0:n!=r&&(o.removeAt(n),s=!0),s&&(this._top?o.insert(0,this._nrt):o.push(this._nrt)),this._nrt&&this._nrt._setFlag(RowColFlags.ParentCollapsed,!1))},e.prototype._attach=function(){var e=this._g;e&&(e.beginningEdit.addHandler(this._beginningEdit,this),e.pastingCell.addHandler(this._beginningEdit,this),e.rowEditEnded.addHandler(this._rowEditEnded,this),e.loadedRows.addHandler(this.updateNewRowTemplate,this),e.hostElement.addEventListener("keydown",this._keydownBnd,!0))},e.prototype._detach=function(){var e=this._g;e&&(e.beginningEdit.removeHandler(this._beginningEdit),e.pastingCell.removeHandler(this._beginningEdit),e.rowEditEnded.removeHandler(this._rowEditEnded),e.loadedRows.removeHandler(this.updateNewRowTemplate),e.hostElement.removeEventListener("keydown",this._keydownBnd,!0))},e.prototype._keydown=function(e){e.defaultPrevented||e.keyCode!=wjcCore.Key.Escape||null==this._g.activeEditor&&this._top&&this._nrt.dataItem&&(this._nrt.dataItem=null,this._g.invalidate())},e.prototype._beginningEdit=function(e,t){if(!t.cancel){var o=this._g.rows[t.row];if(wjcCore.tryCast(o,_NewRowTemplate)){var i=this._g.editableCollectionView;if(i&&i.canAddNew)if(this._top){if(null==this._nrt.dataItem){var n=null,r=i.sourceCollection,s=i.newItemCreator;n=wjcCore.isFunction(s)?s():r&&r.length?new r[0].constructor:{},this._nrt.dataItem=n}}else{n=i.currentAddItem&&i.currentAddItem==o.dataItem?i.currentAddItem:i.addNew();i.moveCurrentTo(n),this.updateNewRowTemplate(),this._g.refresh(!0),this._g.onRowAdded(t),t.cancel&&i.cancelNew()}}}},e.prototype._rowEditEnded=function(e,t){var o=this,i=this._g,n=i.editableCollectionView,r=this._nrt.dataItem;if(n&&!this._committing)if(n.isAddingNew)n.commitNew();else if(r&&!t.cancel){this._committing=!0,this._nrt.dataItem=null;var s=n.addNew();for(var l in r)s[l]=r[l];i.onRowAdded(t),t.cancel?n.cancelNew():n.commitNew(),setTimeout(function(){i.select(0,i.columns.firstVisibleIndex),o.updateNewRowTemplate()},20),this._committing=!1}},e}();exports._AddNewHandler=_AddNewHandler;var _NewRowTemplate=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Row);exports._NewRowTemplate=_NewRowTemplate;var _ImeHandler=function(){function e(t){this._updateImeFocusBnd=this._updateImeFocus.bind(this),this._cmpstartBnd=this._compositionstart.bind(this),this._mousedownBnd=this._mousedown.bind(this),this._mouseupBnd=this._mouseup.bind(this),this._keypressBnd=this._keypress.bind(this),this._g=t;var o=wjcCore.createElement('<textarea class="wj-grid-editor wj-form-control wj-grid-ime" aria-hidden="true"/>');wjcCore.disableAutoComplete(o),wjcCore.setCss(o,e._cssHidden),this._tbx=o,t.cells.hostElement.parentElement.appendChild(o),this._updateImeFocus();var i=t.hostElement,n=t.addEventListener.bind(t);n(o,"compositionstart",this._cmpstartBnd),n(i,"blur",this._updateImeFocusBnd),n(i,"focus",this._updateImeFocusBnd),n(i,"mousedown",this._mousedownBnd,!0),n(i,"mouseup",this._mouseupBnd,!0),n(i,"keypress",this._keypressBnd,!0),t.cellEditEnded.addHandler(this._cellEditEnded,this),t.selectionChanged.addHandler(this._updateImeFocus,this)}return e.prototype.dispose=function(){var e=this._g,t=e.hostElement,o=this._tbx,i=e.removeEventListener.bind(e);i(o,"compositionstart",this._cmpstartBnd),i(t,"blur",this._updateImeFocusBnd),i(t,"focus",this._updateImeFocusBnd),i(t,"mousedown",this._mousedownBnd),i(t,"mouseup",this._mouseupBnd),i(t,"keypress",this._keypressBnd),e.cellEditEnded.removeHandler(this._cellEditEnded),e.selectionChanged.removeHandler(this._updateImeFocus),wjcCore.removeChild(o)},e.prototype._compositionstart=function(){var e=this._g;if(null==e.activeEditor){var t=e._selHdl.selection;if(e.startEditing(!1,t.row,t.col,!1)&&e.activeEditor){t=e.editRange;var o=e.activeEditor,i=this._tbx,n=e.cells.hostElement,r=e.columns[t.col].pos+n.offsetLeft,s=e.rows[t.row].pos+n.offsetTop,l=e.getCellBoundingRect(t.row,t.col),a=o.parentElement,c=getComputedStyle(a),h=a.style.zIndex;t.isSingleCell||(l.width=a.offsetWidth,l.height=a.offsetHeight),t.row<e.frozenRows&&(s+=n.parentElement.scrollTop),t.col<e.frozenColumns&&(r+=n.parentElement.scrollLeft);var u=a.querySelector(".wj-btn.wj-right");u&&(l.width-=u.offsetWidth),"minLength,maxLength,pattern".split(",").forEach(function(e){wjcCore.setAttribute(i,e,o.getAttribute(e))}),wjcCore.setAttribute(i,"wrap",o instanceof HTMLTextAreaElement?"soft":"off"),wjcCore.setCss(i,{position:"absolute",left:r,top:s,width:l.width-1,height:l.height-1,paddingLeft:c.paddingLeft,paddingTop:c.paddingTop,zIndex:h}),e._edtHdl._edt=i,o.value=""}}},e.prototype._cellEditEnded=function(){var t=this;wjcCore.setCss(this._tbx,e._cssHidden),setTimeout(function(){t._tbx.value=""})},e.prototype._mousedown=function(e){this._isMouseDown=!0,this._updateImeFocus()},e.prototype._mouseup=function(e){this._isMouseDown=!1,this._updateImeFocus()},e.prototype._keypress=function(e){null==this._g.activeEditor&&(this._tbx.value="",this._compositionstart(),e.stopPropagation())},e.prototype._updateImeFocus=function(){var e=this._g,t=wjcCore.getActiveElement();if(!e.activeEditor&&wjcCore.closest(t,".wj-flexgrid")==e.hostElement){var o=this._tbx;this._enableIme()?t!=o&&(o.disabled=!1,o.select(),o.focus()):o.disabled=!0}},e.prototype._enableIme=function(){var e=this._g,t=e.selection,o=t.isValid?e._getBindingColumn(e.cells,t.row,e.columns[t.col]):null;return!!e.canEditCell(t.row,t.col)&&!(!o||o.dataType==wjcCore.DataType.Boolean)},e._cssHidden={position:"fixed",left:-10,top:-10,width:"1px",overflow:"hidden"},e}();exports._ImeHandler=_ImeHandler;